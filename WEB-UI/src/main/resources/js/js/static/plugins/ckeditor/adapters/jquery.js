(function(a){if("undefined"==typeof a){throw Error("jQuery should be loaded before CKEditor jQuery adapter.")}if("undefined"==typeof CKEDITOR){throw Error("CKEditor should be loaded before CKEditor jQuery adapter.")}CKEDITOR.config.jqueryOverrideVal="undefined"==typeof CKEDITOR.config.jqueryOverrideVal?!0:CKEDITOR.config.jqueryOverrideVal;a.extend(a.fn,{ckeditorGet:function(){var b=this.eq(0).data("ckeditorInstance");if(!b){throw"CKEditor is not initialized yet, use ckeditor() with a callback."}return b},ckeditor:function(g,d){if(!CKEDITOR.env.isCompatible){throw Error("The environment is incompatible.")}if(!a.isFunction(g)){var b=d;d=g;g=b}var j=[];d=d||{};this.each(function(){var l=a(this),c=l.data("ckeditorInstance"),e=l.data("_ckeditorInstanceLock"),h=this,i=new a.Deferred;j.push(i.promise());if(c&&!e){g&&g.apply(c,[this]),i.resolve()}else{if(e){c.once("instanceReady",function(){setTimeout(function(){c.element?(c.element.$==h&&g&&g.apply(c,[h]),i.resolve()):setTimeout(arguments.callee,100)},0)},null,null,9999)}else{if(d.autoUpdateElement||"undefined"==typeof d.autoUpdateElement&&CKEDITOR.config.autoUpdateElement){d.autoUpdateElementJquery=!0}d.autoUpdateElement=!1;l.data("_ckeditorInstanceLock",!0);c=a(this).is("textarea")?CKEDITOR.replace(h,d):CKEDITOR.inline(h,d);l.data("ckeditorInstance",c);c.on("instanceReady",function(k){var m=k.editor;setTimeout(function(){if(m.element){k.removeListener();m.on("dataReady",function(){l.trigger("dataReady.ckeditor",[m])});m.on("setData",function(n){l.trigger("setData.ckeditor",[m,n.data])});m.on("getData",function(n){l.trigger("getData.ckeditor",[m,n.data])},999);m.on("destroy",function(){l.trigger("destroy.ckeditor",[m])});m.on("save",function(){a(h.form).submit();return !1},null,null,20);if(m.config.autoUpdateElementJquery&&l.is("textarea")&&a(h.form).length){var o=function(){l.ckeditor(function(){m.updateElement()})};a(h.form).submit(o);a(h.form).bind("form-pre-serialize",o);l.bind("destroy.ckeditor",function(){a(h.form).unbind("submit",o);a(h.form).unbind("form-pre-serialize",o)})}m.on("destroy",function(){l.removeData("ckeditorInstance")});l.removeData("_ckeditorInstanceLock");l.trigger("instanceReady.ckeditor",[m]);g&&g.apply(m,[h]);i.resolve()}else{setTimeout(arguments.callee,100)}},0)},null,null,9999)}}});var f=new a.Deferred;this.promise=f.promise();a.when.apply(this,j).then(function(){f.resolve()});this.editor=this.eq(0).data("ckeditorInstance");return this}});CKEDITOR.config.jqueryOverrideVal&&(a.fn.val=CKEDITOR.tools.override(a.fn.val,function(b){return function(d){if(arguments.length){var m=this,k=[],f=this.each(function(){var h=a(this),e=h.data("ckeditorInstance");if(h.is("textarea")&&e){var g=new a.Deferred;e.setData(d,function(){g.resolve()});k.push(g.promise());return !0}return b.call(h,d)});if(k.length){var n=new a.Deferred;a.when.apply(this,k).done(function(){n.resolveWith(m)});return n.promise()}return f}var f=a(this).eq(0),c=f.data("ckeditorInstance");return f.is("textarea")&&c?c.getData():b.call(f)}}))})(window.jQuery);
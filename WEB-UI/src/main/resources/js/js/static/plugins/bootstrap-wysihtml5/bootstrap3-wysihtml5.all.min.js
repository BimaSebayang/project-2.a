/*! bootstrap3-wysihtml5-bower 2014-09-26 */
var wysihtml5,Base,Handlebars;Object.defineProperty&&Object.getOwnPropertyDescriptor&&Object.getOwnPropertyDescriptor(Element.prototype,"textContent")&&!Object.getOwnPropertyDescriptor(Element.prototype,"textContent").get&&!function(){var a=Object.getOwnPropertyDescriptor(Element.prototype,"innerText");Object.defineProperty(Element.prototype,"textContent",{get:function(){return a.get.call(this)},set:function(b){return a.set.call(this,b)}})}(),Array.isArray||(Array.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)}),wysihtml5={version:"0.4.15",commands:{},dom:{},quirks:{},toolbar:{},lang:{},selection:{},views:{},INVISIBLE_SPACE:"",EMPTY_FUNCTION:function(){},ELEMENT_NODE:1,TEXT_NODE:3,BACKSPACE_KEY:8,ENTER_KEY:13,ESCAPE_KEY:27,SPACE_KEY:32,DELETE_KEY:46},function(a,b){"function"==typeof define&&define.amd?define(a):b.rangy=a()}(function(){function t(J,K){var I=typeof J[K];return I==q||!(I!=o||!J[K])||"unknown"==I}function u(I,J){return !(typeof I[J]!=o||!I[J])}function v(I,J){return typeof I[J]!=r}function w(I){return function(J,K){for(var L=K.length;L--;){if(!I(J,K[L])){return !1}}return !0}}function x(I){return I&&h(I,f)&&l(I,d)}function y(I){return u(I,"body")?I.body:I.getElementsByTagName("body")[0]}function z(I){u(window,"console")&&t(window.console,"log")&&window.console.log(I)}function A(I,J){J?window.alert(I):z(I)}function B(I){p.initialized=!0,p.supported=!1,A("Rangy is not supported on this page in your browser. Reason: "+I,p.config.alertOnFail)}function C(I){A("Rangy warning: "+I,p.config.alertOnWarn)}function D(I){return I.message||I.description||I+""}function E(){var Q,R,I,J,K,L,M,N,O;if(!p.initialized){if(R=!1,I=!1,t(document,"createRange")&&(Q=document.createRange(),h(Q,a)&&l(Q,s)&&(R=!0)),J=y(document),!J||"body"!=J.nodeName.toLowerCase()){return B("No body element found"),void 0}if(J&&t(J,"createTextRange")&&(Q=J.createTextRange(),x(Q)&&(I=!0)),!R&&!I){return B("Neither Range nor TextRange are available"),void 0}p.initialized=!0,p.features={implementsDomRange:R,implementsTextRange:I};for(M in n){(K=n[M]) instanceof G&&K.init(K,p)}for(N=0,O=g.length;O>N;++N){try{g[N](p)}catch(P){L="Rangy init listener threw an exception. Continuing. Detail: "+D(P),z(L)}}}}function F(J){J=J||window,E();for(var K=0,I=i.length;I>K;++K){i[K](J)}}function G(J,K,I){this.name=J,this.dependencies=K,this.initialized=!1,this.supported=!1,this.initializer=I}function H(L,M,I,J){var K=new G(M,I,function(N){if(!N.initialized){N.initialized=!0;try{J(p,N),N.supported=!0}catch(O){var P="Module '"+M+"' failed to load: "+D(O);z(P)}}});n[M]=K}function ab(){}function b(){}var e,g,i,k,m,o="object",q="function",r="undefined",s=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],a=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],d=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],f=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],h=w(t),j=w(u),l=w(v),n={},p={version:"1.3alpha.20140804",initialized:!1,supported:!0,util:{isHostMethod:t,isHostObject:u,isHostProperty:v,areHostMethods:h,areHostObjects:j,areHostProperties:l,isTextRange:x,getBody:y},features:{},modules:n,config:{alertOnFail:!0,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==r?!0:rangyAutoInitialize}};return p.fail=B,p.warn=C,{}.hasOwnProperty?p.util.extend=function(M,N,I){var J,K,L;for(L in N){N.hasOwnProperty(L)&&(J=M[L],K=N[L],I&&null!==J&&"object"==typeof J&&null!==K&&"object"==typeof K&&p.util.extend(J,K,!0),M[L]=K)}return N.hasOwnProperty("toString")&&(M.toString=N.toString),M}:B("hasOwnProperty not supported"),function(){var K,L,I=document.createElement("div");I.appendChild(document.createElement("span")),K=[].slice;try{1==K.call(I.childNodes,0)[0].nodeType&&(L=function(M){return K.call(M,0)})}catch(J){}L||(L=function(O){var P,M,N=[];for(P=0,M=O.length;M>P;++P){N[P]=O[P]}return N}),p.util.toArray=L}(),t(document,"addEventListener")?e=function(J,K,I){J.addEventListener(K,I,!1)}:t(document,"attachEvent")?e=function(J,K,I){J.attachEvent("on"+K,I)}:B("Document does not have required addEventListener or attachEvent method"),p.util.addListener=e,g=[],p.init=E,p.addInitListener=function(I){p.initialized?I(p):g.push(I)},i=[],p.addShimListener=function(I){i.push(I)},p.shim=p.createMissingNativeApi=F,G.prototype={init:function(){var L,M,I,J,K=this.dependencies||[];for(L=0,M=K.length;M>L;++L){if(J=K[L],I=n[J],!(I&&I instanceof G)){throw Error("required module '"+J+"' not found")}if(I.init(),!I.supported){throw Error("required module '"+J+"' not supported")}}this.initializer(this)},fail:function(I){throw this.initialized=!0,this.supported=!1,Error("Module '"+this.name+"' failed to load: "+I)},warn:function(I){p.warn("Module "+this.name+": "+I)},deprecationNotice:function(I,J){p.warn("DEPRECATED: "+I+" in module "+this.name+"is deprecated. Please use "+J+" instead")},createError:function(I){return Error("Error in Rangy "+this.name+" module: "+I)}},p.createModule=function(K){var L,I,J;2==arguments.length?(L=arguments[1],I=[]):(L=arguments[2],I=arguments[1]),J=H(!1,K,I,L),p.initialized&&J.init()},p.createCoreModule=function(J,K,I){H(!0,J,K,I)},p.RangePrototype=ab,p.rangePrototype=new ab,p.selectionPrototype=new b,k=!1,m=function(){k||(k=!0,!p.initialized&&p.config.autoInitialize&&E())},typeof window==r?(B("No window found"),void 0):typeof document==r?(B("No document found"),void 0):(t(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",m,!1),e(window,"load",m),p.createCoreModule("DomUtil",[],function(at,R){function S(au){var av;return typeof au.namespaceURI==P||null===(av=au.namespaceURI)||"http://www.w3.org/1999/xhtml"==av}function T(au){var av=au.parentNode;return 1==av.nodeType?av:null}function U(au){for(var av=0;au=au.previousSibling;){++av}return av}function V(au){switch(au.nodeType){case 7:case 10:return 0;case 3:case 8:return au.length;default:return au.childNodes.length}}function W(aw,ax){var au,av=[];for(au=aw;au;au=au.parentNode){av.push(au)}for(au=ax;au;au=au.parentNode){if(M(av,au)){return au}}return null}function X(aw,ax,au){for(var av=au?ax:ax.parentNode;av;){if(av===aw){return !0}av=av.parentNode}return !1}function Y(au,av){return X(au,av,!0)}function Z(ax,ay,au){for(var av,aw=au?ax:ax.parentNode;aw;){if(av=aw.parentNode,av===ay){return aw}aw=av}return null}function aa(au){var av=au.nodeType;return 3==av||4==av||8==av}function ac(au){if(!au){return !1}var av=au.nodeType;return 3==av||8==av}function ad(aw,ax){var au=ax.nextSibling,av=ax.parentNode;return au?av.insertBefore(aw,au):av.appendChild(aw),aw}function ae(ay,az,au){var av,aw,ax=ay.cloneNode(!1);if(ax.deleteData(0,az),ay.deleteData(az,ay.length-az),ad(ax,ay),au){for(av=0;aw=au[av++];){aw.node==ay&&aw.offset>az?(aw.node=ax,aw.offset-=az):aw.node==ay.parentNode&&aw.offset>U(ay)&&++aw.offset}}return ax}function af(au){if(9==au.nodeType){return au}if(typeof au.ownerDocument!=P){return au.ownerDocument}if(typeof au.document!=P){return au.document}if(au.parentNode){return af(au.parentNode)}throw R.createError("getDocument: no document found for node")}function ag(au){var av=af(au);if(typeof av.defaultView!=P){return av.defaultView}if(typeof av.parentWindow!=P){return av.parentWindow}throw R.createError("Cannot get a window object for node")}function ah(au){if(typeof au.contentDocument!=P){return au.contentDocument}if(typeof au.contentWindow!=P){return au.contentWindow.document}throw R.createError("getIframeDocument: No Document object found for iframe element")}function ai(au){if(typeof au.contentWindow!=P){return au.contentWindow}if(typeof au.contentDocument!=P){return au.contentDocument.defaultView}throw R.createError("getIframeWindow: No Window object found for iframe element")}function aj(au){return au&&Q.isHostMethod(au,"setTimeout")&&Q.isHostObject(au,"document")}function ak(aw,ax,au){var av;if(aw?Q.isHostProperty(aw,"nodeType")?av=1==aw.nodeType&&"iframe"==aw.tagName.toLowerCase()?ah(aw):af(aw):aj(aw)&&(av=aw.document):av=document,!av){throw ax.createError(au+"(): Parameter must be a Window object or DOM node")}return av}function al(au){for(var av;av=au.parentNode;){au=av}return au}function am(au,av,aw,ax){var ay,az,aA,aB,aC;if(au==aw){return av===ax?0:ax>av?-1:1}if(ay=Z(aw,au,!0)){return av<=U(ay)?-1:1}if(ay=Z(au,aw,!0)){return U(ay)<ax?-1:1}if(az=W(au,aw),!az){throw Error("comparePoints error: nodes have no common ancestor")}if(aA=au===az?az:Z(au,az,!0),aB=aw===az?az:Z(aw,az,!0),aA===aB){throw R.createError("comparePoints got to case 4 and childA and childB are the same!")}for(aC=az.firstChild;aC;){if(aC===aA){return -1}if(aC===aB){return 1}aC=aC.nextSibling}}function an(av){var aw;try{return aw=av.parentNode,!1}catch(au){return !0}}function ao(au){if(!au){return"[No node]"}if(N&&an(au)){return"[Broken node]"}if(aa(au)){return'"'+au.data+'"'}if(1==au.nodeType){var av=au.id?' id="'+au.id+'"':"";return"<"+au.nodeName+av+">[index:"+U(au)+",length:"+au.childNodes.length+"]["+(au.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return au.nodeName}function ap(av){for(var aw,au=af(av).createDocumentFragment();aw=av.firstChild;){au.appendChild(aw)}return au}function aq(au){this.root=au,this._next=au}function ar(au){return new aq(au)}function I(au,av){this.node=au,this.offset=av}function J(au){this.code=this[au],this.codeName=au,this.message="DOMException: "+this.codeName}var K,L,M,N,O,P="undefined",Q=at.util;Q.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||R.fail("document missing a Node creation method"),Q.isHostMethod(document,"getElementsByTagName")||R.fail("document missing getElementsByTagName method"),K=document.createElement("div"),Q.areHostMethods(K,["insertBefore","appendChild","cloneNode"]||!Q.areHostObjects(K,["previousSibling","nextSibling","childNodes","parentNode"]))||R.fail("Incomplete Element implementation"),Q.isHostProperty(K,"innerHTML")||R.fail("Element is missing innerHTML property"),L=document.createTextNode("test"),Q.areHostMethods(L,["splitText","deleteData","insertData","appendData","cloneNode"]||!Q.areHostObjects(K,["previousSibling","nextSibling","childNodes","parentNode"])||!Q.areHostProperties(L,["data"]))||R.fail("Incomplete Text Node implementation"),M=function(av,aw){for(var au=av.length;au--;){if(av[au]===aw){return !0}}return !1},N=!1,function(){var au,av=document.createElement("b");av.innerHTML="1",au=av.firstChild,av.innerHTML="<br>",N=an(au),at.features.crashyTextNodes=N}(),typeof window.getComputedStyle!=P?O=function(au,av){return ag(au).getComputedStyle(au,null)[av]}:typeof document.documentElement.currentStyle!=P?O=function(au,av){return au.currentStyle[av]}:R.fail("No means of obtaining computed style properties found"),aq.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){var av,aw,au=this._current=this._next;if(this._current){if(av=au.firstChild,av){this._next=av}else{for(aw=null;au!==this.root&&!(aw=au.nextSibling);){au=au.parentNode}this._next=aw}}return this._current},detach:function(){this._current=this._next=this.root=null}},I.prototype={equals:function(au){return !!au&&this.node===au.node&&this.offset==au.offset},inspect:function(){return"[DomPosition("+ao(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},J.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},J.prototype.toString=function(){return this.message},at.dom={arrayContains:M,isHtmlNamespace:S,parentElement:T,getNodeIndex:U,getNodeLength:V,getCommonAncestor:W,isAncestorOf:X,isOrIsAncestorOf:Y,getClosestAncestorIn:Z,isCharacterDataNode:aa,isTextOrCommentNode:ac,insertAfter:ad,splitDataNode:ae,getDocument:af,getWindow:ag,getIframeWindow:ai,getIframeDocument:ah,getBody:Q.getBody,isWindow:aj,getContentDocument:ak,getRootContainer:al,comparePoints:am,isBrokenNode:an,inspectNode:ao,getComputedStyleProperty:O,fragmentFromNodeChildren:ap,createIterator:ar,DomPosition:I},at.DOMException=J}),p.createCoreModule("DomRange",["DomUtil"],function(ax){function az(aA,aB){return 3!=aA.nodeType&&(T(aA,aB.startContainer)||T(aA,aB.endContainer))}function aS(aA){return aA.document||P(aA.startContainer)}function aU(aA){return new aZ(aA.parentNode,aX(aA))}function aW(aA){return new aZ(aA.parentNode,aX(aA)+1)}function aY(aC,aD,aA){var aB=11==aC.nodeType?aC.firstChild:aC;return Q(aD)?aA==aD.length?W.insertAfter(aC,aD):aD.parentNode.insertBefore(aC,0==aA?aD:S(aD,aA)):aA>=aD.childNodes.length?aD.appendChild(aC):aD.insertBefore(aC,aD.childNodes[aA]),aB}function bb(aD,aE,aA){if(ay(aD),ay(aE),aS(aE)!=aS(aD)){throw new U("WRONG_DOCUMENT_ERR")}var aB=aV(aD.startContainer,aD.startOffset,aE.endContainer,aE.endOffset),aC=aV(aD.endContainer,aD.endOffset,aE.startContainer,aE.startOffset);return aA?0>=aB&&aC>=0:0>aB&&aC>0}function bB(aD){var aE,aA,aB,aC;for(aB=aS(aD.range).createDocumentFragment();aA=aD.next();){if(aE=aD.isPartiallySelectedSubtree(),aA=aA.cloneNode(!aE),aE&&(aC=aD.getSubtreeIterator(),aA.appendChild(bB(aC)),aC.detach()),10==aA.nodeType){throw new U("HIERARCHY_REQUEST_ERR")}aB.appendChild(aA)}return aB}function bD(aE,aF,aG){var aA,aB,aC,aD;for(aG=aG||{stop:!1};aC=aE.next();){if(aE.isPartiallySelectedSubtree()){if(aF(aC)===!1){return aG.stop=!0,void 0}if(aD=aE.getSubtreeIterator(),bD(aD,aF,aG),aD.detach(),aG.stop){return}}else{for(aA=W.createIterator(aC);aB=aA.next();){if(aF(aB)===!1){return aG.stop=!0,void 0}}}}}function bE(aA){for(var aB;aA.next();){aA.isPartiallySelectedSubtree()?(aB=aA.getSubtreeIterator(),bE(aB),aB.detach()):aA.remove()}}function bF(aC){for(var aD,aA,aB=aS(aC.range).createDocumentFragment();aD=aC.next();){if(aC.isPartiallySelectedSubtree()?(aD=aD.cloneNode(!1),aA=aC.getSubtreeIterator(),aD.appendChild(bF(aA)),aA.detach()):aC.remove(),10==aD.nodeType){throw new U("HIERARCHY_REQUEST_ERR")}aB.appendChild(aD)}return aB}function bG(aE,aF,aG){var aA,aB,aC=!(!aF||!aF.length),aD=!!aG;return aC&&(aA=RegExp("^("+aF.join("|")+")$")),aB=[],bD(new bI(aE,!1),function(aH){var aI,aJ;(!aC||aA.test(aH.nodeType))&&(!aD||aG(aH))&&(aI=aE.startContainer,aH==aI&&Q(aI)&&aE.startOffset==aI.length||(aJ=aE.endContainer,aH==aJ&&Q(aJ)&&0==aE.endOffset||aB.push(aH)))}),aB}function bH(aA){var aB=void 0===aA.getName?"Range":aA.getName();return"["+aB+"("+W.inspectNode(aA.startContainer)+":"+aA.startOffset+", "+W.inspectNode(aA.endContainer)+":"+aA.endOffset+")]"}function bI(aB,aC){if(this.range=aB,this.clonePartiallySelectedTextNodes=aC,!aB.collapsed){this.sc=aB.startContainer,this.so=aB.startOffset,this.ec=aB.endContainer,this.eo=aB.endOffset;var aA=aB.commonAncestorContainer;this.sc===this.ec&&Q(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==aA||Q(this.sc)?O(this.sc,aA,!0):this.sc.childNodes[this.so],this._last=this.ec!==aA||Q(this.ec)?O(this.ec,aA,!0):this.ec.childNodes[this.eo-1])}}function bJ(aA){return function(aB,aC){for(var aD,aE=aC?aB:aB.parentNode;aE;){if(aD=aE.nodeType,R(aA,aD)){return aE}aE=aE.parentNode}return null}}function bK(aA,aB){if(am(aA,aB)){throw new U("INVALID_NODE_TYPE_ERR")}}function bL(aA,aB){if(!R(aB,aA.nodeType)){throw new U("INVALID_NODE_TYPE_ERR")}}function bM(aA,aB){if(0>aB||aB>(Q(aA)?aA.length:aA.childNodes.length)){throw new U("INDEX_SIZE_ERR")}}function bN(aA,aB){if(ak(aA,!0)!==ak(aB,!0)){throw new U("WRONG_DOCUMENT_ERR")}}function bO(aA){if(al(aA,!0)){throw new U("NO_MODIFICATION_ALLOWED_ERR")}}function bP(aA,aB){if(!aA){throw new U(aB)}}function bQ(aA){return au&&W.isBrokenNode(aA)||!R(ag,aA.nodeType)&&!ak(aA,!0)}function bR(aA,aB){return aB<=(Q(aA)?aA.length:aA.childNodes.length)}function aw(aA){return !!aA.startContainer&&!!aA.endContainer&&!bQ(aA.startContainer)&&!bQ(aA.endContainer)&&bR(aA.startContainer,aA.startOffset)&&bR(aA.endContainer,aA.endOffset)}function ay(aA){if(!aw(aA)){throw Error("Range error: Range is no longer valid after DOM mutation ("+aA.inspect()+")")}}function aT(aE,aF){var aG,aA,aB,aC,aD;ay(aE),aG=aE.startContainer,aA=aE.startOffset,aB=aE.endContainer,aC=aE.endOffset,aD=aG===aB,Q(aB)&&aC>0&&aC<aB.length&&S(aB,aC,aF),Q(aG)&&aA>0&&aA<aG.length&&(aG=S(aG,aA,aF),aD?(aC-=aA,aB=aG):aB==aG.parentNode&&aC>=aX(aG)&&aC++,aA=0),aE.setStartAndEnd(aG,aA,aB,aC)}function V(aA){ay(aA);var aB=aA.commonAncestorContainer.parentNode.cloneNode(!1);return aB.appendChild(aA.cloneContents()),aB.innerHTML}function X(aA){aA.START_TO_START=ar,aA.START_TO_END=I,aA.END_TO_END=J,aA.END_TO_START=K,aA.NODE_BEFORE=M,aA.NODE_AFTER=N,aA.NODE_BEFORE_AND_AFTER=bA,aA.NODE_INSIDE=at}function Y(aA){X(aA),X(aA.prototype)}function Z(aA,aB){return function(){var aH,aI,aD,aF,aG,aC,aE;return ay(this),aH=this.startContainer,aI=this.startOffset,aD=this.commonAncestorContainer,aF=new bI(this,!0),aH!==aD&&(aG=O(aH,aD,!0),aC=aW(aG),aH=aC.node,aI=aC.offset),bD(aF,bO),aF.reset(),aE=aA(aF),aF.detach(),aB(this,aH,aI,aH,aI),aE}}function aa(aC,aD){function aE(aG,aH){return function(aI){bL(aI,af),bL(L(aI),ag);var aJ=(aG?aU:aW)(aI);(aH?aF:aA)(this,aJ.node,aJ.offset)}}function aF(aJ,aK,aG){var aH=aJ.endContainer,aI=aJ.endOffset;(aK!==aJ.startContainer||aG!==aJ.startOffset)&&((L(aK)!=L(aH)||1==aV(aK,aG,aH,aI))&&(aH=aK,aI=aG),aD(aJ,aK,aG,aH,aI))}function aA(aJ,aK,aG){var aH=aJ.startContainer,aI=aJ.startOffset;(aK!==aJ.endContainer||aG!==aJ.endOffset)&&((L(aK)!=L(aH)||-1==aV(aK,aG,aH,aI))&&(aH=aK,aI=aG),aD(aJ,aH,aI,aK,aG))}var aB=function(){};aB.prototype=ax.rangePrototype,aC.prototype=new aB,av.extend(aC.prototype,{setStart:function(aG,aH){bK(aG,!0),bM(aG,aH),aF(this,aG,aH)},setEnd:function(aG,aH){bK(aG,!0),bM(aG,aH),aA(this,aG,aH)},setStartAndEnd:function(){var aJ=arguments,aK=aJ[0],aG=aJ[1],aH=aK,aI=aG;switch(aJ.length){case 3:aI=aJ[2];break;case 4:aH=aJ[2],aI=aJ[3]}aD(this,aK,aG,aH,aI)},setBoundary:function(aH,aI,aG){this["set"+(aG?"Start":"End")](aH,aI)},setStartBefore:aE(!0,!0),setStartAfter:aE(!1,!0),setEndBefore:aE(!0,!1),setEndAfter:aE(!1,!1),collapse:function(aG){ay(this),aG?aD(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):aD(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(aG){bK(aG,!0),aD(this,aG,0,aG,aR(aG))},selectNode:function(aH){bK(aH,!1),bL(aH,af);var aI=aU(aH),aG=aW(aH);aD(this,aI.node,aI.offset,aG.node,aG.offset)},extractContents:Z(bF,aD),deleteContents:Z(bE,aD),canSurroundContents:function(){var aH,aG;return ay(this),bO(this.startContainer),bO(this.endContainer),aH=new bI(this,!0),aG=aH._first&&az(aH._first,this)||aH._last&&az(aH._last,this),aH.detach(),!aG},splitBoundaries:function(){aT(this)},splitBoundariesPreservingPositions:function(aG){aT(this,aG)},normalizeBoundaries:function(){var aO,aG,aH,aI,aJ,aK,aL,aM,aN;ay(this),aO=this.startContainer,aG=this.startOffset,aH=this.endContainer,aI=this.endOffset,aJ=function(aP){var aQ=aP.nextSibling;aQ&&aQ.nodeType==aP.nodeType&&(aH=aP,aI=aP.length,aP.appendData(aQ.data),aQ.parentNode.removeChild(aQ))},aK=function(aP){var aQ,a1,a0=aP.previousSibling;a0&&a0.nodeType==aP.nodeType&&(aO=aP,aQ=aP.length,aG=a0.length,aP.insertData(0,a0.data),a0.parentNode.removeChild(a0),aO==aH?(aI+=aG,aH=aO):aH==aP.parentNode&&(a1=aX(aP),aI==a1?(aH=aP,aI=aQ):aI>a1&&aI--))},aL=!0,Q(aH)?aH.length==aI&&aJ(aH):(aI>0&&(aM=aH.childNodes[aI-1],aM&&Q(aM)&&aJ(aM)),aL=!this.collapsed),aL?Q(aO)?0==aG&&aK(aO):aG<aO.childNodes.length&&(aN=aO.childNodes[aG],aN&&Q(aN)&&aK(aN)):(aO=aH,aG=aI),aD(this,aO,aG,aH,aI)},collapseToPoint:function(aG,aH){bK(aG,!0),bM(aG,aH),this.setStartAndEnd(aG,aH)}}),Y(aC)}function ac(aA){aA.collapsed=aA.startContainer===aA.endContainer&&aA.startOffset===aA.endOffset,aA.commonAncestorContainer=aA.collapsed?aA.startContainer:W.getCommonAncestor(aA.startContainer,aA.endContainer)}function ad(aD,aE,aA,aB,aC){aD.startContainer=aE,aD.startOffset=aA,aD.endContainer=aB,aD.endOffset=aC,aD.document=W.getDocument(aE),ac(aD)}function ae(aA){this.startContainer=aA,this.startOffset=0,this.endContainer=aA,this.endOffset=0,this.document=aA,ac(this)}var af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,I,J,K,M,N,bA,at,W=ax.dom,av=ax.util,aZ=W.DomPosition,U=ax.DOMException,Q=W.isCharacterDataNode,aX=W.getNodeIndex,T=W.isOrIsAncestorOf,P=W.getDocument,aV=W.comparePoints,S=W.splitDataNode,O=W.getClosestAncestorIn,aR=W.getNodeLength,R=W.arrayContains,L=W.getRootContainer,au=ax.features.crashyTextNodes;bI.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return !!this._next},next:function(){var aA=this._current=this._next;return aA&&(this._next=aA!==this._last?aA.nextSibling:null,Q(aA)&&this.clonePartiallySelectedTextNodes&&(aA===this.ec&&(aA=aA.cloneNode(!0)).deleteData(this.eo,aA.length-this.eo),this._current===this.sc&&(aA=aA.cloneNode(!0)).deleteData(0,this.so))),aA},remove:function(){var aB,aC,aA=this._current;!Q(aA)||aA!==this.sc&&aA!==this.ec?aA.parentNode&&aA.parentNode.removeChild(aA):(aB=aA===this.sc?this.so:0,aC=aA===this.ec?this.eo:aA.length,aB!=aC&&aA.deleteData(aB,aC-aB))},isPartiallySelectedSubtree:function(){var aA=this._current;return az(aA,this.range)},getSubtreeIterator:function(){var aE,aF,aA,aB,aC,aD;return this.isSingleCharacterDataNode?(aE=this.range.cloneRange(),aE.collapse(!1)):(aE=new ae(aS(this.range)),aF=this._current,aA=aF,aB=0,aC=aF,aD=aR(aF),T(aF,this.sc)&&(aA=this.sc,aB=this.so),T(aF,this.ec)&&(aC=this.ec,aD=this.eo),ad(aE,aA,aB,aC,aD)),new bI(aE,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}},af=[1,3,4,5,7,8,10],ag=[2,9,11],ah=[5,6,10,12],ai=[1,3,4,5,7,8,10,11],aj=[1,3,4,5,7,8],ak=bJ([9,11]),al=bJ(ah),am=bJ([6,10,12]),an=document.createElement("style"),ao=!1;try{an.innerHTML="<b>x</b>",ao=3==an.firstChild.nodeType}catch(bC){}ax.features.htmlParsingConforms=ao,ap=ao?function(aC){var aD,aA=this.startContainer,aB=P(aA);if(!aA){throw new U("INVALID_STATE_ERR")}return aD=null,1==aA.nodeType?aD=aA:Q(aA)&&(aD=W.parentElement(aA)),aD=null===aD||"HTML"==aD.nodeName&&W.isHtmlNamespace(P(aD).documentElement)&&W.isHtmlNamespace(aD)?aB.createElement("body"):aD.cloneNode(!1),aD.innerHTML=aC,W.fragmentFromNodeChildren(aD)}:function(aB){var aC=aS(this),aA=aC.createElement("body");return aA.innerHTML=aB,W.fragmentFromNodeChildren(aA)},aq=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ar=0,I=1,J=2,K=3,M=0,N=1,bA=2,at=3,av.extend(ax.rangePrototype,{compareBoundaryPoints:function(aD,aE){var aF,aG,aH,aA,aB,aC;return ay(this),bN(this.startContainer,aE.startContainer),aB=aD==K||aD==ar?"start":"end",aC=aD==I||aD==ar?"start":"end",aF=this[aB+"Container"],aG=this[aB+"Offset"],aH=aE[aC+"Container"],aA=aE[aC+"Offset"],aV(aF,aG,aH,aA)},insertNode:function(aA){if(ay(this),bL(aA,ai),bO(this.startContainer),T(aA,this.startContainer)){throw new U("HIERARCHY_REQUEST_ERR")}var aB=aY(aA,this.startContainer,this.startOffset);this.setStartBefore(aB)},cloneContents:function(){var aB,aC,aA;return ay(this),this.collapsed?aS(this).createDocumentFragment():this.startContainer===this.endContainer&&Q(this.startContainer)?(aB=this.startContainer.cloneNode(!0),aB.data=aB.data.slice(this.startOffset,this.endOffset),aC=aS(this).createDocumentFragment(),aC.appendChild(aB),aC):(aA=new bI(this,!0),aB=bB(aA),aA.detach(),aB)},canSurroundContents:function(){var aA,aB;return ay(this),bO(this.startContainer),bO(this.endContainer),aA=new bI(this,!0),aB=aA._first&&az(aA._first,this)||aA._last&&az(aA._last,this),aA.detach(),!aB},surroundContents:function(aA){if(bL(aA,aj),!this.canSurroundContents()){throw new U("INVALID_STATE_ERR")}var aB=this.extractContents();if(aA.hasChildNodes()){for(;aA.lastChild;){aA.removeChild(aA.lastChild)}}aY(aA,this.startContainer,this.startOffset),aA.appendChild(aB),this.selectNode(aA)},cloneRange:function(){var aB,aC,aA;for(ay(this),aB=new ae(aS(this)),aC=aq.length;aC--;){aA=aq[aC],aB[aA]=this[aA]}return aB},toString:function(){var aB,aC,aA;return ay(this),aB=this.startContainer,aB===this.endContainer&&Q(aB)?3==aB.nodeType||4==aB.nodeType?aB.data.slice(this.startOffset,this.endOffset):"":(aC=[],aA=new bI(this,!0),bD(aA,function(aD){(3==aD.nodeType||4==aD.nodeType)&&aC.push(aD.data)}),aA.detach(),aC.join(""))},compareNode:function(aD){var aE,aA,aB,aC;if(ay(this),aE=aD.parentNode,aA=aX(aD),!aE){throw new U("NOT_FOUND_ERR")}return aB=this.comparePoint(aE,aA),aC=this.comparePoint(aE,aA+1),0>aB?aC>0?bA:M:aC>0?N:at},comparePoint:function(aA,aB){return ay(this),bP(aA,"HIERARCHY_REQUEST_ERR"),bN(aA,this.startContainer),aV(aA,aB,this.startContainer,this.startOffset)<0?-1:aV(aA,aB,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:ap,toHtml:function(){return V(this)},intersectsNode:function(aE,aF){var aA,aB,aC,aD;return ay(this),bP(aE,"NOT_FOUND_ERR"),P(aE)!==aS(this)?!1:(aA=aE.parentNode,aB=aX(aE),bP(aA,"NOT_FOUND_ERR"),aC=aV(aA,aB,this.endContainer,this.endOffset),aD=aV(aA,aB+1,this.startContainer,this.startOffset),aF?0>=aC&&aD>=0:0>aC&&aD>0)},isPointInRange:function(aA,aB){return ay(this),bP(aA,"HIERARCHY_REQUEST_ERR"),bN(aA,this.startContainer),aV(aA,aB,this.startContainer,this.startOffset)>=0&&aV(aA,aB,this.endContainer,this.endOffset)<=0},intersectsRange:function(aA){return bb(this,aA,!1)},intersectsOrTouchesRange:function(aA){return bb(this,aA,!0)},intersection:function(aC){var aD,aA,aB;return this.intersectsRange(aC)?(aD=aV(this.startContainer,this.startOffset,aC.startContainer,aC.startOffset),aA=aV(this.endContainer,this.endOffset,aC.endContainer,aC.endOffset),aB=this.cloneRange(),-1==aD&&aB.setStart(aC.startContainer,aC.startOffset),1==aA&&aB.setEnd(aC.endContainer,aC.endOffset),aB):null},union:function(aA){if(this.intersectsOrTouchesRange(aA)){var aB=this.cloneRange();return -1==aV(aA.startContainer,aA.startOffset,this.startContainer,this.startOffset)&&aB.setStart(aA.startContainer,aA.startOffset),1==aV(aA.endContainer,aA.endOffset,this.endContainer,this.endOffset)&&aB.setEnd(aA.endContainer,aA.endOffset),aB}throw new U("Ranges do not intersect")},containsNode:function(aA,aB){return aB?this.intersectsNode(aA,!1):this.compareNode(aA)==at},containsNodeContents:function(aA){return this.comparePoint(aA,0)>=0&&this.comparePoint(aA,aR(aA))<=0},containsRange:function(aA){var aB=this.intersection(aA);return null!==aB&&aA.equals(aB)},containsNodeText:function(aC){var aD,aA,aB=this.cloneRange();return aB.selectNode(aC),aD=aB.getNodes([3]),aD.length>0?(aB.setStart(aD[0],0),aA=aD.pop(),aB.setEnd(aA,aA.length),this.containsRange(aB)):this.containsNodeContents(aC)},getNodes:function(aA,aB){return ay(this),bG(this,aA,aB)},getDocument:function(){return aS(this)},collapseBefore:function(aA){this.setEndBefore(aA),this.collapse(!1)},collapseAfter:function(aA){this.setStartAfter(aA),this.collapse(!0)},getBookmark:function(aC){var aA,aB,aD,aE=aS(this),aF=ax.createRange(aE);return aC=aC||W.getBody(aE),aF.selectNodeContents(aC),aA=this.intersection(aF),aB=0,aD=0,aA&&(aF.setEnd(aA.startContainer,aA.startOffset),aB=(""+aF).length,aD=aB+(""+aA).length),{start:aB,end:aD,containerNode:aC}},moveToBookmark:function(aI){var aJ,aA,aB,aC,aD,aE,aF,aG=aI.containerNode,aH=0;for(this.setStart(aG,0),this.collapse(!0),aJ=[aG],aB=!1,aC=!1;!aC&&(aA=aJ.pop());){if(3==aA.nodeType){aD=aH+aA.length,!aB&&aI.start>=aH&&aI.start<=aD&&(this.setStart(aA,aI.start-aH),aB=!0),aB&&aI.end>=aH&&aI.end<=aD&&(this.setEnd(aA,aI.end-aH),aC=!0),aH=aD}else{for(aF=aA.childNodes,aE=aF.length;aE--;){aJ.push(aF[aE])}}}},getName:function(){return"DomRange"},equals:function(aA){return ae.rangesEqual(this,aA)},isValid:function(){return aw(this)},inspect:function(){return bH(this)},detach:function(){}}),aa(ae,ad),av.extend(ae,{rangeProperties:aq,RangeIterator:bI,copyComparisonConstants:Y,createPrototypeRange:aa,inspect:bH,toHtml:V,getRangeDocument:aS,rangesEqual:function(aA,aB){return aA.startContainer===aB.startContainer&&aA.startOffset===aB.startOffset&&aA.endContainer===aB.endContainer&&aA.endOffset===aB.endOffset}}),ax.DomRange=ae}),p.createCoreModule("WrappedRange",["DomRange"],function(S,U){var W,Y,J,K,L,M,N,O,P=S.dom,Q=S.util,R=P.DomPosition,T=S.DomRange,V=P.getBody,X=P.getContentDocument,I=P.isCharacterDataNode;S.features.implementsDomRange&&!function(){function af(an){for(var ao,am=Z.length;am--;){ao=Z[am],an[ao]=an.nativeRange[ao]}an.collapsed=an.startContainer===an.endContainer&&an.startOffset===an.endOffset}function ag(an,ao,ap,aq,at){var au=an.startContainer!==ao||an.startOffset!=ap,ar=an.endContainer!==aq||an.endOffset!=at,am=!an.equals(an.nativeRange);(au||ar||am)&&(an.setEnd(aq,at),an.setStart(ao,ap))}var ai,aa,ad,ae,ah,aj,ak,al,Z=T.rangeProperties;W=function(am){if(!am){throw U.createError("WrappedRange: Range must be specified")}this.nativeRange=am,af(this)},T.createPrototypeRange(W,ag),ai=W.prototype,ai.selectNode=function(am){this.nativeRange.selectNode(am),af(this)},ai.cloneContents=function(){return this.nativeRange.cloneContents()},ai.surroundContents=function(am){this.nativeRange.surroundContents(am),af(this)},ai.collapse=function(am){this.nativeRange.collapse(am),af(this)},ai.cloneRange=function(){return new W(this.nativeRange.cloneRange())},ai.refresh=function(){af(this)},ai.toString=function(){return""+this.nativeRange},ad=document.createTextNode("test"),V(document).appendChild(ad),ae=document.createRange(),ae.setStart(ad,0),ae.setEnd(ad,0);try{ae.setStart(ad,1),ai.setStart=function(am,an){this.nativeRange.setStart(am,an),af(this)},ai.setEnd=function(am,an){this.nativeRange.setEnd(am,an),af(this)},aa=function(am){return function(an){this.nativeRange[am](an),af(this)}}}catch(ac){ai.setStart=function(an,ao){try{this.nativeRange.setStart(an,ao)}catch(am){this.nativeRange.setEnd(an,ao),this.nativeRange.setStart(an,ao)}af(this)},ai.setEnd=function(an,ao){try{this.nativeRange.setEnd(an,ao)}catch(am){this.nativeRange.setStart(an,ao),this.nativeRange.setEnd(an,ao)}af(this)},aa=function(am,an){return function(ao){try{this.nativeRange[am](ao)}catch(ap){this.nativeRange[an](ao),this.nativeRange[am](ao)}af(this)}}}ai.setStartBefore=aa("setStartBefore","setEndBefore"),ai.setStartAfter=aa("setStartAfter","setEndAfter"),ai.setEndBefore=aa("setEndBefore","setStartBefore"),ai.setEndAfter=aa("setEndAfter","setStartAfter"),ai.selectNodeContents=function(am){this.setStartAndEnd(am,0,P.getNodeLength(am))},ae.selectNodeContents(ad),ae.setEnd(ad,3),ah=document.createRange(),ah.selectNodeContents(ad),ah.setEnd(ad,4),ah.setStart(ad,2),ai.compareBoundaryPoints=-1==ae.compareBoundaryPoints(ae.START_TO_END,ah)&&1==ae.compareBoundaryPoints(ae.END_TO_START,ah)?function(am,an){return an=an.nativeRange||an,am==an.START_TO_END?am=an.END_TO_START:am==an.END_TO_START&&(am=an.START_TO_END),this.nativeRange.compareBoundaryPoints(am,an)}:function(am,an){return this.nativeRange.compareBoundaryPoints(am,an.nativeRange||an)},aj=document.createElement("div"),aj.innerHTML="123",ak=aj.firstChild,al=V(document),al.appendChild(aj),ae.setStart(ak,1),ae.setEnd(ak,2),ae.deleteContents(),"13"==ak.data&&(ai.deleteContents=function(){this.nativeRange.deleteContents(),af(this)},ai.extractContents=function(){var am=this.nativeRange.extractContents();return af(this),am}),al.removeChild(aj),al=null,Q.isHostMethod(ae,"createContextualFragment")&&(ai.createContextualFragment=function(am){return this.nativeRange.createContextualFragment(am)}),V(document).removeChild(ad),ai.getName=function(){return"WrappedRange"},S.WrappedRange=W,S.createNativeRange=function(am){return am=X(am,U,"createNativeRange"),am.createRange()}}(),S.features.implementsTextRange&&(J=function(ae){var af,Z,aa,ac=ae.parentElement(),ad=ae.duplicate();return ad.collapse(!0),af=ad.parentElement(),ad=ae.duplicate(),ad.collapse(!1),Z=ad.parentElement(),aa=af==Z?af:P.getCommonAncestor(af,Z),aa==ac?aa:P.getCommonAncestor(ac,aa)},K=function(Z){return 0==Z.compareEndPoints("StartToEnd",Z)},L=function(ac,ad,af,ah,aj){var al,an,az,aL,aM,Z,aa,ae,ag,ai,ak,am,ap,aK,ao,aN,aO=ac.duplicate();if(aO.collapse(af),al=aO.parentElement(),P.isOrIsAncestorOf(ad,al)||(al=ad),!al.canHaveHTML){return an=new R(al.parentNode,P.getNodeIndex(al)),{boundaryPosition:an,nodeInfo:{nodeIndex:an.offset,containerElement:an.node}}}for(az=P.getDocument(al).createElement("span"),az.parentNode&&az.parentNode.removeChild(az),aM=af?"StartToStart":"StartToEnd",ai=aj&&aj.containerElement==al?aj.nodeIndex:0,ak=al.childNodes.length,am=ak,ap=am;;){if(ap==ak?al.appendChild(az):al.insertBefore(az,al.childNodes[ap]),aO.moveToElementText(az),aL=aO.compareEndPoints(aM,ac),0==aL||ai==am){break}if(-1==aL){if(am==ai+1){break}ai=ap}else{am=am==ai+1?ai:ap}ap=Math.floor((ai+am)/2),al.removeChild(az)}if(ag=az.nextSibling,-1==aL&&ag&&I(ag)){if(aO.setEndPoint(af?"EndToStart":"EndToEnd",ac),/[\r\n]/.test(ag.data)){for(ao=aO.duplicate(),aN=ao.text.replace(/\r\n/g,"\r").length,aK=ao.moveStart("character",aN);-1==(aL=ao.compareEndPoints("StartToEnd",ao));){aK++,ao.moveStart("character",1)}}else{aK=aO.text.length}ae=new R(ag,aK)}else{Z=(ah||!af)&&az.previousSibling,aa=(ah||af)&&az.nextSibling,ae=aa&&I(aa)?new R(aa,0):Z&&I(Z)?new R(Z,Z.data.length):new R(al,P.getNodeIndex(az))}return az.parentNode.removeChild(az),{boundaryPosition:ae,nodeInfo:{nodeIndex:ap,containerElement:al}}},M=function(ae,ah){var aj,Z,aa,ac,ad=ae.offset,af=P.getDocument(ae.node),ag=V(af).createTextRange(),ai=I(ae.node);return ai?(aj=ae.node,Z=aj.parentNode):(ac=ae.node.childNodes,aj=ad<ac.length?ac[ad]:null,Z=ae.node),aa=af.createElement("span"),aa.innerHTML="&#feff;",aj?Z.insertBefore(aa,aj):Z.appendChild(aa),ag.moveToElementText(aa),ag.collapse(!ah),Z.removeChild(aa),ai&&ag[ah?"moveStart":"moveEnd"]("character",ad),ag},Y=function(Z){this.textRange=Z,this.refresh()},Y.prototype=new T(document),Y.prototype.refresh=function(){var ac,ad,Z,aa=J(this.textRange);K(this.textRange)?ad=ac=L(this.textRange,aa,!0,!0).boundaryPosition:(Z=L(this.textRange,aa,!0,!1),ac=Z.boundaryPosition,ad=L(this.textRange,aa,!1,!1,Z.nodeInfo).boundaryPosition),this.setStart(ac.node,ac.offset),this.setEnd(ad.node,ad.offset)},Y.prototype.getName=function(){return"WrappedTextRange"},T.copyComparisonConstants(Y),N=function(ac){var ad,Z,aa;return ac.collapsed?M(new R(ac.startContainer,ac.startOffset),!0):(ad=M(new R(ac.startContainer,ac.startOffset),!0),Z=M(new R(ac.endContainer,ac.endOffset),!1),aa=V(T.getRangeDocument(ac)).createTextRange(),aa.setEndPoint("StartToStart",ad),aa.setEndPoint("EndToEnd",Z),aa)},Y.rangeToTextRange=N,Y.prototype.toTextRange=function(){return N(this)},S.WrappedTextRange=Y,(!S.features.implementsDomRange||S.config.preferTextRange)&&(O=function(){return this}(),void 0===O.Range&&(O.Range=Y),S.createNativeRange=function(Z){return Z=X(Z,U,"createNativeRange"),V(Z).createTextRange()},S.WrappedRange=Y)),S.createRange=function(Z){return Z=X(Z,U,"createRange"),new S.WrappedRange(S.createNativeRange(Z))},S.createRangyRange=function(Z){return Z=X(Z,U,"createRangyRange"),new T(Z)},S.createIframeRange=function(Z){return U.deprecationNotice("createIframeRange()","createRange(iframeEl)"),S.createRange(Z)},S.createIframeRangyRange=function(Z){return U.deprecationNotice("createIframeRangyRange()","createRangyRange(iframeEl)"),S.createRangyRange(Z)},S.addShimListener(function(Z){var aa=Z.document;void 0===aa.createRange&&(aa.createRange=function(){return S.createRange(aa)}),aa=Z=null})}),p.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(aW,aX){function aY(aA){return"string"==typeof aA?/^backward(s)?$/i.test(aA):!!aA}function aZ(aA,aB){if(aA){if(X.isWindow(aA)){return aA}if(aA instanceof av){return aA.win}var aC=X.getContentDocument(aA,aX,aB);return X.getWindow(aC)}return window}function bb(aA){return aZ(aA,"getWinSelection").getSelection()}function bs(aA){return aZ(aA,"getDocSelection").document.selection}function bt(aA){var aB=!1;return aA.anchorNode&&(aB=1==X.comparePoints(aA.anchorNode,aA.anchorOffset,aA.focusNode,aA.focusOffset)),aB}function bu(aD,aE,aA){var aB=aA?"end":"start",aC=aA?"start":"end";aD.anchorNode=aE[aB+"Container"],aD.anchorOffset=aE[aB+"Offset"],aD.focusNode=aE[aC+"Container"],aD.focusOffset=aE[aC+"Offset"]}function bv(aA){var aB=aA.nativeSelection;aA.anchorNode=aB.anchorNode,aA.anchorOffset=aB.anchorOffset,aA.focusNode=aB.focusNode,aA.focusOffset=aB.focusOffset}function bw(aA){aA.anchorNode=aA.focusNode=null,aA.anchorOffset=aA.focusOffset=0,aA.rangeCount=0,aA.isCollapsed=!0,aA._ranges.length=0}function bx(aA){var aB;return aA instanceof ac?(aB=aW.createNativeRange(aA.getDocument()),aB.setEnd(aA.endContainer,aA.endOffset),aB.setStart(aA.startContainer,aA.startOffset)):aA instanceof ad?aB=aA.nativeRange:ai.implementsDomRange&&aA instanceof X.getWindow(aA.startContainer).Range&&(aB=aA),aB}function by(aB){if(!aB.length||1!=aB[0].nodeType){return !1}for(var aC=1,aA=aB.length;aA>aC;++aC){if(!X.isAncestorOf(aB[0],aB[aC])){return !1}}return !0}function bz(aA){var aB=aA.getNodes();if(!by(aB)){throw aX.createError("getSingleElementFromRange: range "+aA.inspect()+" did not consist of a single element")}return aB[0]}function bA(aA){return !!aA&&void 0!==aA.text}function bB(aB,aC){var aA=new ad(aC);aB._ranges=[aA],bu(aB,aA,!1),aB.rangeCount=1,aB.isCollapsed=aA.collapsed}function at(aA){var aB,aC,aD,aE;if(aA._ranges.length=0,"None"==aA.docSelection.type){bw(aA)}else{if(aB=aA.docSelection.createRange(),bA(aB)){bB(aA,aB)}else{for(aA.rangeCount=aB.length,aD=ak(aB.item(0)),aE=0;aE<aA.rangeCount;++aE){aC=aW.createRange(aD),aC.selectNode(aB.item(aE)),aA._ranges.push(aC)}aA.isCollapsed=1==aA.rangeCount&&aA._ranges[0].collapsed,bu(aA,aA._ranges[aA.rangeCount-1],!1)}}}function au(aA,aB){var aC,aD,aE=aA.docSelection.createRange(),aF=bz(aB),aG=ak(aE.item(0)),aH=al(aG).createControlRange();for(aC=0,aD=aE.length;aD>aC;++aC){aH.add(aE.item(aC))}try{aH.add(aF)}catch(aI){throw aX.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}aH.select(),at(aA)}function av(aB,aC,aA){this.nativeSelection=aB,this.docSelection=aC,this._ranges=[],this.win=aA,this.refresh()}function aw(aA){aA.win=aA.anchorNode=aA.focusNode=aA._ranges=null,aA.rangeCount=aA.anchorOffset=aA.focusOffset=0,aA.detached=!0}function ax(aD,aE){for(var aA,aB,aC=aT.length;aC--;){if(aA=aT[aC],aB=aA.selection,"deleteAll"==aE){aw(aB)}else{if(aA.win==aD){return"delete"==aE?(aT.splice(aC,1),!0):aB}}}return"deleteAll"==aE&&(aT.length=0),null}function ay(aB,aF){var aG,aH,aA,aC=ak(aF[0].startContainer),aD=al(aC).createControlRange();for(aG=0,aA=aF.length;aA>aG;++aG){aH=bz(aF[aG]);try{aD.add(aH)}catch(aE){throw aX.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}aD.select(),at(aB)}function az(aA,aB){if(aA.win.document!=ak(aB)){throw new ae("WRONG_DOCUMENT_ERR")}}function aS(aA){return function(aC,aD){var aB;this.rangeCount?(aB=this.getRangeAt(0),aB["set"+(aA?"Start":"End")](aC,aD)):(aB=aW.createRange(this.win.document),aB.setStartAndEnd(aC,aD)),this.setSingleRange(aB,this.isBackward())}}function aU(aE){var aF,aG,aA=[],aB=new af(aE.anchorNode,aE.anchorOffset),aC=new af(aE.focusNode,aE.focusOffset),aD="function"==typeof aE.getName?aE.getName():"Selection";if(void 0!==aE.rangeCount){for(aF=0,aG=aE.rangeCount;aG>aF;++aF){aA[aF]=ac.inspect(aE.getRangeAt(aF))}}return"["+aD+"(Ranges: "+aA.join(", ")+")(anchor: "+aB.inspect()+", focus: "+aC.inspect()+"]"}var aV,R,X,Z,aa,ac,ad,ae,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,ar,I,J,K,L,M,N,O,U,aR,Y,aT,T,W,Q,S,V,P;if(aW.config.checkSelectionRanges=!0,aV="boolean",R="number",X=aW.dom,Z=aW.util,aa=Z.isHostMethod,ac=aW.DomRange,ad=aW.WrappedRange,ae=aW.DOMException,af=X.DomPosition,ai=aW.features,aj="Control",ak=X.getDocument,al=X.getBody,am=ac.rangesEqual,an=aa(window,"getSelection"),ao=Z.isHostObject(document,"selection"),ai.implementsWinGetSelection=an,ai.implementsDocSelection=ao,ap=ao&&(!an||aW.config.preferTextRange),ap?(ag=bs,aW.isSelectionValid=function(aB){var aC=aZ(aB,"isSelectionValid").document,aA=aC.selection;return"None"!=aA.type||ak(aA.createRange().parentElement())==aC}):an?(ag=bb,aW.isSelectionValid=function(){return !0}):aX.fail("Neither document.selection or window.getSelection() detected."),aW.getNativeSelection=ag,aq=ag(),ar=aW.createNativeRange(document),I=al(document),J=Z.areHostProperties(aq,["anchorNode","focusNode","anchorOffset","focusOffset"]),ai.selectionHasAnchorAndFocus=J,K=aa(aq,"extend"),ai.selectionHasExtend=K,L=typeof aq.rangeCount==R,ai.selectionHasRangeCount=L,M=!1,N=!0,O=K?function(aA,aB){var aC=ac.getRangeDocument(aB),aD=aW.createRange(aC);aD.collapseToPoint(aB.endContainer,aB.endOffset),aA.addRange(bx(aD)),aA.extend(aB.startContainer,aB.startOffset)}:null,Z.areHostMethods(aq,["addRange","getRangeAt","removeAllRanges"])&&typeof aq.rangeCount==R&&ai.implementsDomRange&&!function(){var aG,aH,aI,aJ,aK,aL,aA,aB,aC,aD,aE,aF=window.getSelection();if(aF){for(aG=aF.rangeCount,aH=aG>1,aI=[],aJ=bt(aF),aK=0;aG>aK;++aK){aI[aK]=aF.getRangeAt(aK)}for(aL=al(document),aA=aL.appendChild(document.createElement("div")),aA.contentEditable="false",aB=aA.appendChild(document.createTextNode("   ")),aC=document.createRange(),aC.setStart(aB,1),aC.collapse(!0),aF.addRange(aC),N=1==aF.rangeCount,aF.removeAllRanges(),aH||(aD=window.navigator.appVersion.match(/Chrome\/(.*?) /),aD&&parseInt(aD[1])>=36?M=!1:(aE=aC.cloneRange(),aC.setStart(aB,0),aE.setEnd(aB,3),aE.setStart(aB,2),aF.addRange(aC),aF.addRange(aE),M=2==aF.rangeCount)),aL.removeChild(aA),aF.removeAllRanges(),aK=0;aG>aK;++aK){0==aK&&aJ?O?O(aF,aI[aK]):(aW.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),aF.addRange(aI[aK])):aF.addRange(aI[aK])}}}(),ai.selectionSupportsMultipleRanges=M,ai.collapsedNonEditableSelectionsSupported=N,U=!1,I&&aa(I,"createControlRange")&&(aR=I.createControlRange(),Z.areHostProperties(aR,["item","add"])&&(U=!0)),ai.implementsControlRange=U,ah=J?function(aA){return aA.anchorNode===aA.focusNode&&aA.anchorOffset===aA.focusOffset}:function(aA){return aA.rangeCount?aA.getRangeAt(aA.rangeCount-1).collapsed:!1},aa(aq,"getRangeAt")?Y=function(aB,aC){try{return aB.getRangeAt(aC)}catch(aA){return null}}:J&&(Y=function(aA){var aB=ak(aA.anchorNode),aC=aW.createRange(aB);return aC.setStartAndEnd(aA.anchorNode,aA.anchorOffset,aA.focusNode,aA.focusOffset),aC.collapsed!==this.isCollapsed&&aC.setStartAndEnd(aA.focusNode,aA.focusOffset,aA.anchorNode,aA.anchorOffset),aC}),av.prototype=aW.selectionPrototype,aT=[],T=function(aC){var aD,aA,aB;return aC&&aC instanceof av?(aC.refresh(),aC):(aC=aZ(aC,"getNativeSelection"),aD=ax(aC),aA=ag(aC),aB=ao?bs(aC):null,aD?(aD.nativeSelection=aA,aD.docSelection=aB,aD.refresh()):(aD=new av(aA,aB,aC),aT.push({win:aC,selection:aD})),aD)},aW.getSelection=T,aW.getIframeSelection=function(aA){return aX.deprecationNotice("getIframeSelection()","getSelection(iframeEl)"),aW.getSelection(X.getIframeWindow(aA))},W=av.prototype,!ap&&J&&Z.areHostMethods(aq,["removeAllRanges","addRange"])){W.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),bw(this)},Q=function(aA,aB){O(aA.nativeSelection,aB),aA.refresh()},W.addRange=L?function(aA,aB){var aC,aD;U&&ao&&this.docSelection.type==aj?au(this,aA):aY(aB)&&K?Q(this,aA):(M?aC=this.rangeCount:(this.removeAllRanges(),aC=0),this.nativeSelection.addRange(bx(aA).cloneRange()),this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==aC+1?(aW.config.checkSelectionRanges&&(aD=Y(this.nativeSelection,this.rangeCount-1),aD&&!am(aD,aA)&&(aA=new ad(aD))),this._ranges[this.rangeCount-1]=aA,bu(this,aA,P(this.nativeSelection)),this.isCollapsed=ah(this)):this.refresh())}:function(aA,aB){aY(aB)&&K?Q(this,aA):(this.nativeSelection.addRange(bx(aA)),this.refresh())},W.setRanges=function(aB){if(U&&ao&&aB.length>1){ay(this,aB)}else{this.removeAllRanges();for(var aC=0,aA=aB.length;aA>aC;++aC){this.addRange(aB[aC])}}}}else{if(!(aa(aq,"empty")&&aa(ar,"select")&&U&&ap)){return aX.fail("No means of selecting a Range or TextRange was found"),!1}W.removeAllRanges=function(){var aC,aD,aA;try{this.docSelection.empty(),"None"!=this.docSelection.type&&(this.anchorNode?aC=ak(this.anchorNode):this.docSelection.type==aj&&(aD=this.docSelection.createRange(),aD.length&&(aC=ak(aD.item(0)))),aC&&(aA=al(aC).createTextRange(),aA.select(),this.docSelection.empty()))}catch(aB){}bw(this)},W.addRange=function(aA){this.docSelection.type==aj?au(this,aA):(aW.WrappedTextRange.rangeToTextRange(aA).select(),this._ranges[0]=aA,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,bu(this,aA,!1))},W.setRanges=function(aA){this.removeAllRanges();var aB=aA.length;aB>1?ay(this,aA):aB&&this.addRange(aA[0])}}if(W.getRangeAt=function(aA){if(0>aA||aA>=this.rangeCount){throw new ae("INDEX_SIZE_ERR")}return this._ranges[aA].cloneRange()},ap){S=function(aA){var aB;aW.isSelectionValid(aA.win)?aB=aA.docSelection.createRange():(aB=al(aA.win.document).createTextRange(),aB.collapse(!0)),aA.docSelection.type==aj?at(aA):bA(aB)?bB(aA,aB):bw(aA)}}else{if(aa(aq,"getRangeAt")&&typeof aq.rangeCount==R){S=function(aA){if(U&&ao&&aA.docSelection.type==aj){at(aA)}else{if(aA._ranges.length=aA.rangeCount=aA.nativeSelection.rangeCount,aA.rangeCount){for(var aB=0,aC=aA.rangeCount;aC>aB;++aB){aA._ranges[aB]=new aW.WrappedRange(aA.nativeSelection.getRangeAt(aB))}bu(aA,aA._ranges[aA.rangeCount-1],P(aA.nativeSelection)),aA.isCollapsed=ah(aA)}else{bw(aA)}}}}else{if(!J||typeof aq.isCollapsed!=aV||typeof ar.collapsed!=aV||!ai.implementsDomRange){return aX.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1}S=function(aB){var aC,aA=aB.nativeSelection;aA.anchorNode?(aC=Y(aA,0),aB._ranges=[aC],aB.rangeCount=1,bv(aB),aB.isCollapsed=ah(aB)):bw(aB)}}}W.refresh=function(aD){var aE,aA=aD?this._ranges.slice(0):null,aB=this.anchorNode,aC=this.anchorOffset;if(S(this),aD){if(aE=aA.length,aE!=this._ranges.length){return !0}if(this.anchorNode!=aB||this.anchorOffset!=aC){return !0}for(;aE--;){if(!am(aA[aE],this._ranges[aE])){return !0}}return !1}},V=function(aD,aE){var aA,aB,aC=aD.getAllRanges();for(aD.removeAllRanges(),aA=0,aB=aC.length;aB>aA;++aA){am(aE,aC[aA])||aD.addRange(aC[aA])}aD.rangeCount||bw(aD)},W.removeRange=U&&ao?function(aA){var aB,aC,aD,aE,aF,aG,aH,aI;if(this.docSelection.type==aj){for(aB=this.docSelection.createRange(),aC=bz(aA),aD=ak(aB.item(0)),aE=al(aD).createControlRange(),aG=!1,aH=0,aI=aB.length;aI>aH;++aH){aF=aB.item(aH),aF!==aC||aG?aE.add(aB.item(aH)):aG=!0}aE.select(),at(this)}else{V(this,aA)}}:function(aA){V(this,aA)},!ap&&J&&ai.implementsDomRange?(P=bt,W.isBackward=function(){return P(this)}):P=W.isBackward=function(){return !1},W.isBackwards=W.isBackward,W.toString=function(){var aB,aC,aA=[];for(aB=0,aC=this.rangeCount;aC>aB;++aB){aA[aB]=""+this._ranges[aB]}return aA.join("")},W.collapse=function(aA,aB){az(this,aA);var aC=aW.createRange(aA);aC.collapseToPoint(aA,aB),this.setSingleRange(aC),this.isCollapsed=!0},W.collapseToStart=function(){if(!this.rangeCount){throw new ae("INVALID_STATE_ERR")}var aA=this._ranges[0];this.collapse(aA.startContainer,aA.startOffset)},W.collapseToEnd=function(){if(!this.rangeCount){throw new ae("INVALID_STATE_ERR")}var aA=this._ranges[this.rangeCount-1];this.collapse(aA.endContainer,aA.endOffset)},W.selectAllChildren=function(aA){az(this,aA);var aB=aW.createRange(aA);aB.selectNodeContents(aA),this.setSingleRange(aB)},W.deleteFromDocument=function(){var aD,aE,aA,aB,aC;if(U&&ao&&this.docSelection.type==aj){for(aD=this.docSelection.createRange();aD.length;){aE=aD.item(0),aD.remove(aE),aE.parentNode.removeChild(aE)}this.refresh()}else{if(this.rangeCount&&(aA=this.getAllRanges(),aA.length)){for(this.removeAllRanges(),aB=0,aC=aA.length;aC>aB;++aB){aA[aB].deleteContents()}this.addRange(aA[aC-1])}}},W.eachRange=function(aC,aD){for(var aA=0,aB=this._ranges.length;aB>aA;++aA){if(aC(this.getRangeAt(aA))){return aD}}},W.getAllRanges=function(){var aA=[];return this.eachRange(function(aB){aA.push(aB)}),aA},W.setSingleRange=function(aA,aB){this.removeAllRanges(),this.addRange(aA,aB)},W.callMethodOnEachRange=function(aB,aC){var aA=[];return this.eachRange(function(aD){aA.push(aD[aB].apply(aD,aC))}),aA},W.setStart=aS(!0),W.setEnd=aS(!1),aW.rangePrototype.select=function(aA){T(this.getDocument()).setSingleRange(this,aA)},W.changeEachRange=function(aB){var aC=[],aA=this.isBackward();this.eachRange(function(aD){aB(aD),aC.push(aD)}),this.removeAllRanges(),aA&&1==aC.length?this.addRange(aC[0],"backward"):this.setRanges(aC)},W.containsNode=function(aA,aB){return this.eachRange(function(aC){return aC.containsNode(aA,aB)},!0)||!1},W.getBookmark=function(aA){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[aA])}},W.moveToBookmark=function(aA){var aB,aC,aD,aE=[];for(aB=0;aC=aA.rangeBookmarks[aB++];){aD=aW.createRange(this.win),aD.moveToBookmark(aC),aE.push(aD)}aA.backward?this.setSingleRange(aE[0],"backward"):this.setRanges(aE)},W.toHtml=function(){var aA=[];return this.eachRange(function(aB){aA.push(ac.toHtml(aB))}),aA.join("")},ai.implementsTextRange&&(W.getNativeTextRange=function(){var aA,aB;if(aA=this.docSelection){if(aB=aA.createRange(),bA(aB)){return aB}throw aX.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0){return aW.WrappedTextRange.rangeToTextRange(this.getRangeAt(0))}throw aX.createError("getNativeTextRange: selection contains no range")}),W.getName=function(){return"WrappedSelection"},W.inspect=function(){return aU(this)},W.detach=function(){ax(this.win,"delete"),aw(this)},av.detachAll=function(){ax(null,"deleteAll")},av.inspect=aU,av.isDirectionBackward=aY,aW.Selection=av,aW.selectionPrototype=W,aW.addShimListener(function(aA){void 0===aA.getSelection&&(aA.getSelection=function(){return T(aA)}),aA=null})}),p)},this),function(a,b){"function"==typeof define&&define.amd?define(["rangy"],a):a(b.rangy)}(function(a){a.createModule("SaveRestore",["WrappedRange"],function(p,H){function d(q,r){return(r||document).getElementById(q)}function f(u,v){var q,r="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),s=b.getDocument(u.startContainer),t=u.cloneRange();return t.collapse(v),q=s.createElement("span"),q.id=r,q.style.lineHeight="0",q.style.display="none",q.className="rangySelectionBoundary",q.appendChild(s.createTextNode(e)),t.insertNode(q),q}function g(u,q,r,s){var t=d(r,u);t?(q[s?"setStartBefore":"setEndBefore"](t),t.parentNode.removeChild(t)):H.warn("Marker element has been removed. Cannot restore selection.")}function h(q,r){return r.compareBoundaryPoints(q.START_TO_START,q)}function i(r,q){var s,t,u=p.DomRange.getRangeDocument(r),v=""+r;return r.collapsed?(t=f(r,!1),{document:u,markerId:t.id,collapsed:!0}):(t=f(r,!1),s=f(r,!0),{document:u,startMarkerId:s.id,endMarkerId:t.id,collapsed:!1,backward:q,toString:function(){return"original text: '"+v+"', new text: '"+r+"'"}})}function j(v,q){var s,t,u,r=v.document;return void 0===q&&(q=!0),s=p.createRange(r),v.collapsed?(t=d(v.markerId,r),t?(t.style.display="inline",u=t.previousSibling,u&&3==u.nodeType?(t.parentNode.removeChild(t),s.collapseToPoint(u,u.length)):(s.collapseBefore(t),t.parentNode.removeChild(t))):H.warn("Marker element has been removed. Cannot restore selection.")):(g(r,s,v.startMarkerId,!0),g(r,s,v.endMarkerId,!1)),q&&s.normalizeBoundaries(),s}function k(s,v){var w,q,r,t,u=[];for(s=s.slice(0),s.sort(h),r=0,t=s.length;t>r;++r){u[r]=i(s[r],v)}for(r=t-1;r>=0;--r){w=s[r],q=p.DomRange.getRangeDocument(w),w.collapsed?w.collapseAfter(d(u[r].markerId,q)):(w.setEndBefore(d(u[r].endMarkerId,q)),w.setStartAfter(d(u[r].startMarkerId,q)))}return u}function l(r){var s,t,u,q;return p.isSelectionValid(r)?(s=p.getSelection(r),t=s.getAllRanges(),u=1==t.length&&s.isBackward(),q=k(t,u),u?s.setSingleRange(t[0],"backward"):s.setRanges(t),{win:r,rangeInfos:q,restored:!1}):(H.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null)}function m(s){var t,q=[],r=s.length;for(t=r-1;t>=0;t--){q[t]=j(s[t],!0)}return q}function n(r,q){var s,t,u,v;r.restored||(s=r.rangeInfos,t=p.getSelection(r.win),u=m(s),v=s.length,1==v&&q&&p.features.selectionHasExtend&&s[0].backward?(t.removeAllRanges(),t.addRange(u[0],!0)):t.setRanges(u),r.restored=!0)}function o(r,s){var q=d(s,r);q&&q.parentNode.removeChild(q)}function G(t){var u,q,r,s=t.rangeInfos;for(u=0,q=s.length;q>u;++u){r=s[u],r.collapsed?o(t.doc,r.markerId):(o(t.doc,r.startMarkerId),o(t.doc,r.endMarkerId))}}var b=p.dom,e="";p.util.extend(p,{saveRange:i,restoreRange:j,saveRanges:k,restoreRanges:m,saveSelection:l,restoreSelection:n,removeMarkerElement:o,removeMarkers:G})})},this),Base=function(){},Base.extend=function(f,m){var a,b,d,e=Base.prototype.extend;return Base._prototyping=!0,a=new this,e.call(a,f),a.base=function(){},delete Base._prototyping,b=a.constructor,d=a.constructor=function(){if(!Base._prototyping){if(this._constructing||this.constructor==d){this._constructing=!0,b.apply(this,arguments),delete this._constructing}else{if(null!=arguments[0]){return(arguments[0].extend||e).call(arguments[0],a)}}}},d.ancestor=this,d.extend=this.extend,d.forEach=this.forEach,d.implement=this.implement,d.prototype=a,d.toString=this.toString,d.valueOf=function(g){return"object"==g?d:b.valueOf()},e.call(d,m),"function"==typeof d.init&&d.init(),d},Base.prototype={extend:function(a,b){var d,e,f,g,h,i,s;if(arguments.length>1){d=this[a],!d||"function"!=typeof b||d.valueOf&&d.valueOf()==b.valueOf()||!/\bbase\b/.test(b)||(e=b.valueOf(),b=function(){var j,k=this.base||Base.prototype.base;return this.base=d,j=e.apply(this,arguments),this.base=k,j},b.valueOf=function(j){return"object"==j?b:e},b.toString=Base.toString),this[a]=b}else{if(a){for(f=Base.prototype.extend,Base._prototyping||"function"==typeof this||(f=this.extend||f),g={toSource:null},h=["constructor","toString","valueOf"],i=Base._prototyping?0:1;s=h[i++];){a[s]!=g[s]&&f.call(this,s,a[s])}for(s in a){g[s]||f.call(this,s,a[s])}}}return this}},Base=Base.extend({constructor:function(){this.extend(arguments[0])}},{ancestor:Object,version:"1.1",forEach:function(d,i,a){for(var b in d){void 0===this.prototype[b]&&i.call(a,d[b],b,d)}},implement:function(){for(var a=0;a<arguments.length;a++){"function"==typeof arguments[a]?arguments[a](this.prototype):this.prototype.extend(arguments[a])}return this},toString:function(){return this.valueOf()+""}}),wysihtml5.browser=function(){function a(j){return +(/ipad|iphone|ipod/.test(j)&&j.match(/ os (\d+).+? like mac os x/)||[void 0,0])[1]}function b(j){return +(j.match(/android (\d+)/)||[void 0,0])[1]}function d(l,m){var j,k=-1;return"Microsoft Internet Explorer"==navigator.appName?j=RegExp("MSIE ([0-9]{1,}[.0-9]{0,})"):"Netscape"==navigator.appName&&(j=RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})")),j&&null!=j.exec(navigator.userAgent)&&(k=parseFloat(RegExp.$1)),-1===k?!1:l?m?"<"===m?k>l:">"===m?l>k:"<="===m?k>=l:">="===m?l>=k:void 0:l===k:!0}var e=navigator.userAgent,f=document.createElement("div"),g=-1!==e.indexOf("Gecko")&&-1===e.indexOf("KHTML"),h=-1!==e.indexOf("AppleWebKit/"),i=-1!==e.indexOf("Chrome/"),s=-1!==e.indexOf("Opera/");return{USER_AGENT:e,supported:function(){var m=this.USER_AGENT.toLowerCase(),l="contentEditable" in f,n=document.execCommand&&document.queryCommandSupported&&document.queryCommandState,j=document.querySelector&&document.querySelectorAll,k=this.isIos()&&a(m)<5||this.isAndroid()&&b(m)<4||-1!==m.indexOf("opera mobi")||-1!==m.indexOf("hpwos/");return l&&n&&j&&!k},isTouchDevice:function(){return this.supportsEvent("touchmove")},isIos:function(){return/ipad|iphone|ipod/i.test(this.USER_AGENT)},isAndroid:function(){return -1!==this.USER_AGENT.indexOf("Android")},supportsSandboxedIframes:function(){return d()},throwsMixedContentWarningWhenIframeSrcIsEmpty:function(){return !("querySelector" in document)},displaysCaretInEmptyContentEditableCorrectly:function(){return d()},hasCurrentStyleProperty:function(){return"currentStyle" in f},hasHistoryIssue:function(){return g&&"Mac"===navigator.platform.substr(0,3)},insertsLineBreaksOnReturn:function(){return g},supportsPlaceholderAttributeOn:function(j){return"placeholder" in j},supportsEvent:function(j){return"on"+j in f||function(){return f.setAttribute("on"+j,"return;"),"function"==typeof f["on"+j]}()},supportsEventsInIframeCorrectly:function(){return !s},supportsHTML5Tags:function(k){var l=k.createElement("div"),j="<article>foo</article>";return l.innerHTML=j,l.innerHTML.toLowerCase()===j},supportsCommand:function(){var j={formatBlock:d(10,"<="),insertUnorderedList:d(),insertOrderedList:d()},k={insertHTML:g};return function(p,n){var o=j[n];if(!o){try{return p.queryCommandSupported(n)}catch(l){}try{return p.queryCommandEnabled(n)}catch(m){return !!k[n]}}return !1}}(),doesAutoLinkingInContentEditable:function(){return d()},canDisableAutoLinking:function(){return this.supportsCommand(document,"AutoUrlDetect")},clearsContentEditableCorrectly:function(){return g||s||h},supportsGetAttributeCorrectly:function(){var j=document.createElement("td");return"1"!=j.getAttribute("rowspan")},canSelectImagesInContentEditable:function(){return g||d()||s},autoScrollsToCaret:function(){return !h},autoClosesUnclosedTags:function(){var k,l,j=f.cloneNode(!1);return j.innerHTML="<p><div></div>",l=j.innerHTML.toLowerCase(),k="<p></p><div></div>"===l||"<p><div></div></p>"===l,this.autoClosesUnclosedTags=function(){return k},k},supportsNativeGetElementsByClassName:function(){return -1!==(document.getElementsByClassName+"").indexOf("[native code]")},supportsSelectionModify:function(){return"getSelection" in window&&"modify" in window.getSelection()},needsSpaceAfterLineBreak:function(){return s},supportsSpeechApiOn:function(j){var k=e.match(/Chrome\/(\d+)/)||[void 0,0];return k[1]>=11&&("onwebkitspeechchange" in j||"speech" in j)},crashesWhenDefineProperty:function(j){return d(9)&&("XMLHttpRequest"===j||"XDomainRequest"===j)},doesAsyncFocus:function(){return d()},hasProblemsSettingCaretAfterImg:function(){return d()},hasUndoInContextMenu:function(){return g||i||s},hasInsertNodeIssue:function(){return s},hasIframeFocusIssue:function(){return d()},createsNestedInvalidMarkupAfterPaste:function(){return h},supportsMutationEvents:function(){return"MutationEvent" in window},supportsModenPaste:function(){return !("clipboardData" in window)}}}(),wysihtml5.lang.array=function(a){return{contains:function(b){if(Array.isArray(b)){for(var e=b.length;e--;){if(-1!==wysihtml5.lang.array(a).indexOf(b[e])){return !0}}return !1}return -1!==wysihtml5.lang.array(a).indexOf(b)},indexOf:function(b){if(a.indexOf){return a.indexOf(b)}for(var d=0,g=a.length;g>d;d++){if(a[d]===b){return d}}return -1},without:function(b){b=wysihtml5.lang.array(b);for(var d=[],e=0,i=a.length;i>e;e++){b.contains(a[e])||d.push(a[e])}return d},get:function(){for(var b=0,d=a.length,g=[];d>b;b++){g.push(a[b])}return g},map:function(b,d){if(Array.prototype.map){return a.map(b,d)}for(var e=a.length>>>0,f=Array(e),k=0;e>k;k++){f[k]=b.call(d,a[k],k,a)}return f},unique:function(){for(var b=[],d=a.length,g=0;d>g;){wysihtml5.lang.array(b).contains(a[g])||b.push(a[g]),g++}return b}}},wysihtml5.lang.Dispatcher=Base.extend({on:function(a,b){return this.events=this.events||{},this.events[a]=this.events[a]||[],this.events[a].push(b),this},off:function(e,k){this.events=this.events||{};var a,b,d=0;if(e){for(a=this.events[e]||[],b=[];d<a.length;d++){a[d]!==k&&k&&b.push(a[d])}this.events[e]=b}else{this.events={}}return this},fire:function(d,i){this.events=this.events||{};for(var a=this.events[d]||[],b=0;b<a.length;b++){a[b].call(this,i)}return this},observe:function(){return this.on.apply(this,arguments)},stopObserving:function(){return this.off.apply(this,arguments)}}),wysihtml5.lang.object=function(a){return{merge:function(b){for(var e in b){a[e]=b[e]}return this},get:function(){return a},clone:function(b){var d,g={};if(null===a||!wysihtml5.lang.object(a).isPlainObject()){return a}for(d in a){a.hasOwnProperty(d)&&(g[d]=b?wysihtml5.lang.object(a[d]).clone(b):a[d])}return g},isArray:function(){return"[object Array]"===Object.prototype.toString.call(a)},isFunction:function(){return"[object Function]"===Object.prototype.toString.call(a)},isPlainObject:function(){return"[object Object]"===Object.prototype.toString.call(a)}}},function(){var d=/^\s+/,i=/\s+$/,a=/[&<>\t"]/g,b={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","	":"&nbsp; "};wysihtml5.lang.string=function(e){return e+="",{trim:function(){return e.replace(d,"").replace(i,"")},interpolate:function(f){for(var g in f){e=this.replace("#{"+g+"}").by(f[g])}return e},replace:function(f){return{by:function(g){return e.split(f).join(g)}}},escapeHTML:function(g,h){var f=e.replace(a,function(j){return b[j]});return g&&(f=f.replace(/(?:\r\n|\r|\n)/g,"<br />")),h&&(f=f.replace(/  /gi,"&nbsp; ")),f}}}}(),function(h){function i(m,n){return y(m,n)?m:(m===m.ownerDocument.documentElement&&(m=m.ownerDocument.body),a(m,n))}function j(m){return m.replace(d,function(r,s){var n,o,p=(s.match(e)||[])[1]||"",q=g[p];return s=s.replace(e,""),s.split(q).length>s.split(p).length&&(s+=p,p=""),n=s,o=s,s.length>f&&(o=o.substr(0,f)+"..."),"www."===n.substr(0,4)&&(n="http://"+n),'<a href="'+n+'">'+o+"</a>"+p})}function k(m){var n=m._wysihtml5_tempElement;return n||(n=m._wysihtml5_tempElement=m.createElement("div")),n}function l(m){var n=m.parentNode,o=h.lang.string(m.data).escapeHTML(),p=k(n.ownerDocument);for(p.innerHTML="<span></span>"+j(o),p.removeChild(p.firstChild);p.firstChild;){n.insertBefore(p.firstChild,m)}n.removeChild(m)}function y(m,n){for(var o;m.parentNode;){if(m=m.parentNode,o=m.nodeName,m.className&&h.lang.array(m.className.split(" ")).contains(n)){return !0}if(b.contains(o)){return !0}if("body"===o){return !1}}return !1}function a(m,n){if(!(b.contains(m.nodeName)||m.className&&h.lang.array(m.className.split(" ")).contains(n))){if(m.nodeType===h.TEXT_NODE&&m.data.match(d)){return l(m),void 0}for(var o=h.lang.array(m.childNodes).get(),p=o.length,q=0;p>q;q++){a(o[q],n)}return m}}var b=h.lang.array(["CODE","PRE","A","SCRIPT","HEAD","TITLE","STYLE"]),d=/((https?:\/\/|www\.)[^\s<]{3,})/gi,e=/([^\w\/\-](,?))$/i,f=100,g={")":"(","]":"[","}":"{"};h.dom.autoLink=i,h.dom.autoLink.URL_REG_EXP=d}(wysihtml5),function(a){var b=a.dom;b.addClass=function(d,e){var h=d.classList;return h?h.add(e):(b.hasClass(d,e)||(d.className+=" "+e),void 0)},b.removeClass=function(e,i){var d=e.classList;return d?d.remove(i):(e.className=e.className.replace(RegExp("(^|\\s+)"+i+"(\\s+|$)")," "),void 0)},b.hasClass=function(j,k){var d,e=j.classList;return e?e.contains(k):(d=j.className,d.length>0&&(d==k||RegExp("(^|\\s)"+k+"(\\s|$)").test(d)))}}(wysihtml5),wysihtml5.dom.contains=function(){var a=document.documentElement;return a.contains?function(b,f){return f.nodeType!==wysihtml5.ELEMENT_NODE&&(f=f.parentNode),b!==f&&b.contains(f)}:a.compareDocumentPosition?function(b,f){return !!(16&b.compareDocumentPosition(f))}:void 0}(),wysihtml5.dom.convertToList=function(){function b(e,f){var d=e.createElement("li");return f.appendChild(d),d}function g(d,e){return d.createElement(e)}function a(r,H,d){if("UL"===r.nodeName||"OL"===r.nodeName||"MENU"===r.nodeName){return r}var e,f,h,i,k,m,n,o,p,q=r.ownerDocument,G=g(q,H),j=r.querySelectorAll("br"),l=j.length;for(p=0;l>p;p++){for(i=j[p];(k=i.parentNode)&&k!==r&&k.lastChild===i;){if("block"===wysihtml5.dom.getStyle("display").from(k)){k.removeChild(i);break}wysihtml5.dom.insert(i).after(i.parentNode)}}for(e=wysihtml5.lang.array(r.childNodes).get(),f=e.length,p=0;f>p;p++){o=o||b(q,G),h=e[p],m="block"===wysihtml5.dom.getStyle("display").from(h),n="BR"===h.nodeName,!m||d&&wysihtml5.dom.hasClass(h,d)?n?o=o.firstChild?null:o:o.appendChild(h):(o=o.firstChild?b(q,G):o,o.appendChild(h),o=null)}return 0===e.length&&b(q,G),r.parentNode.replaceChild(G,r),G}return a}(),wysihtml5.dom.copyAttributes=function(a){return{from:function(b){return{to:function(d){for(var e,f=0,k=a.length;k>f;f++){e=a[f],void 0!==b[e]&&""!==b[e]&&(d[e]=b[e])}return{andTo:arguments.callee}}}}}},function(d){var i=["-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing"],a=function(e){return b(e)?parseInt(d.getStyle("width").from(e),10)<e.offsetWidth:!1},b=function(g){for(var e=0,f=i.length;f>e;e++){if("border-box"===d.getStyle(i[e]).from(g)){return i[e]}}};d.copyStyles=function(e){return{from:function(g){a(g)&&(e=wysihtml5.lang.array(e).without(i));for(var h,m="",n=e.length,f=0;n>f;f++){h=e[f],m+=h+":"+d.getStyle(h).from(g)+";"}return{to:function(j){return d.setStyles(m).on(j),{andTo:arguments.callee}}}}}}}(wysihtml5.dom),function(a){a.dom.delegate=function(b,d,e,i){return a.dom.observe(b,e,function(f){for(var g=f.target,h=a.lang.array(b.querySelectorAll(d));g&&g!==b;){if(h.contains(g)){i.call(g,f);break}g=g.parentNode}})}}(wysihtml5),function(a){a.dom.domNode=function(b){var d=[a.ELEMENT_NODE,a.TEXT_NODE],g=function(e){return e.nodeType===a.TEXT_NODE&&/^\s*$/g.test(e.data)};return{prev:function(e){var f=b.previousSibling,j=e&&e.nodeTypes?e.nodeTypes:d;return f?!a.lang.array(j).contains(f.nodeType)||e&&e.ignoreBlankTexts&&g(f)?a.dom.domNode(f).prev(e):f:null},next:function(e){var f=b.nextSibling,j=e&&e.nodeTypes?e.nodeTypes:d;return f?!a.lang.array(j).contains(f.nodeType)||e&&e.ignoreBlankTexts&&g(f)?a.dom.domNode(f).next(e):f:null}}}}(wysihtml5),wysihtml5.dom.getAsDom=function(){var b=function(f,k){var d=k.createElement("div");d.style.display="none",k.body.appendChild(d);try{d.innerHTML=f}catch(e){}return k.body.removeChild(d),d},g=function(e){if(!e._wysihtml5_supportsHTML5Tags){for(var f=0,d=a.length;d>f;f++){e.createElement(a[f])}e._wysihtml5_supportsHTML5Tags=!0}},a=["abbr","article","aside","audio","bdi","canvas","command","datalist","details","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","svg","section","source","summary","time","track","video","wbr"];return function(f,d){d=d||document;var e;return"object"==typeof f&&f.nodeType?(e=d.createElement("div"),e.appendChild(f)):wysihtml5.browser.supportsHTML5Tags(d)?(e=d.createElement("div"),e.innerHTML=f):(g(d),e=b(f,d)),e}}(),wysihtml5.dom.getParentElement=function(){function d(e,f){return f&&f.length?"string"==typeof f?e===f:wysihtml5.lang.array(f).contains(e):!0}function i(e){return e.nodeType===wysihtml5.ELEMENT_NODE}function a(g,h,e){var f=(g.className||"").match(e)||[];return h?f[f.length-1]===h:!!f.length}function b(g,h,e){var f=(g.getAttribute("style")||"").match(e)||[];return h?f[f.length-1]===h:!!f.length}return function(f,h,j,n){var e=h.cssStyle||h.styleRegExp,g=h.className||h.classRegExp;for(j=j||50;j--&&f&&"BODY"!==f.nodeName&&(!n||f!==n);){if(i(f)&&d(f.nodeName,h.nodeName)&&(!e||b(f,h.cssStyle,h.styleRegExp))&&(!g||a(f,h.className,h.classRegExp))){return f}f=f.parentNode}return null}}(),wysihtml5.dom.getStyle=function(){function b(d){return d.replace(a,function(e){return e.charAt(1).toUpperCase()})}var g={"float":"styleFloat" in document.createElement("div").style?"styleFloat":"cssFloat"},a=/\-[a-z]/g;return function(d){return{from:function(k){var l,m,n,y,z,e,f,h,i;if(k.nodeType===wysihtml5.ELEMENT_NODE){if(l=k.ownerDocument,m=g[d]||b(d),n=k.style,y=k.currentStyle,z=n[m],z){return z}if(y){try{return y[m]}catch(j){}}return e=l.defaultView||l.parentWindow,f=("height"===d||"width"===d)&&"TEXTAREA"===k.nodeName,e.getComputedStyle?(f&&(h=n.overflow,n.overflow="hidden"),i=e.getComputedStyle(k,null).getPropertyValue(d),f&&(n.overflow=h||""),i):void 0}}}}}(),wysihtml5.dom.getTextNodes=function(b,g){var a=[];for(b=b.firstChild;b;b=b.nextSibling){3==b.nodeType?g&&/^\s*$/.test(b.innerText||b.textContent)||a.push(b):a=a.concat(wysihtml5.dom.getTextNodes(b,g))}return a},wysihtml5.dom.hasElementWithTagName=function(){function b(d){return d._wysihtml5_identifier||(d._wysihtml5_identifier=a++)}var g={},a=1;return function(f,i){var d=b(f)+":"+i,e=g[d];return e||(e=g[d]=f.getElementsByTagName(i)),e.length>0}}(),function(d){function i(e){return e._wysihtml5_identifier||(e._wysihtml5_identifier=b++)}var a={},b=1;d.dom.hasElementWithClassName=function(g,h){if(!d.browser.supportsNativeGetElementsByClassName()){return !!g.querySelector("."+h)}var e=i(g)+":"+h,f=a[e];return f||(f=a[e]=g.getElementsByClassName(h)),f.length>0}}(wysihtml5),wysihtml5.dom.insert=function(a){return{after:function(b){b.parentNode.insertBefore(a,b.nextSibling)},before:function(b){b.parentNode.insertBefore(a,b)},into:function(b){b.appendChild(a)}}},wysihtml5.dom.insertCSS=function(a){return a=a.join("\n"),{into:function(b){var d,e,i=b.createElement("style");return i.type="text/css",i.styleSheet?i.styleSheet.cssText=a:i.appendChild(b.createTextNode(a)),d=b.querySelector("head link"),d?(d.parentNode.insertBefore(i,d),void 0):(e=b.querySelector("head"),e&&e.appendChild(i),void 0)}}},function(a){a.dom.lineBreaks=function(b){function d(e){return"BR"===e.nodeName}function g(e){return d(e)?!0:"block"===a.dom.getStyle("display").from(e)?!0:!1}return{add:function(){var e=b.ownerDocument,f=a.dom.domNode(b).next({ignoreBlankTexts:!0}),i=a.dom.domNode(b).prev({ignoreBlankTexts:!0});f&&!g(f)&&a.dom.insert(e.createElement("br")).after(b),i&&!g(i)&&a.dom.insert(e.createElement("br")).before(b)},remove:function(){var e=a.dom.domNode(b).next({ignoreBlankTexts:!0}),f=a.dom.domNode(b).prev({ignoreBlankTexts:!0});e&&d(e)&&e.parentNode.removeChild(e),f&&d(f)&&f.parentNode.removeChild(f)}}}}(wysihtml5),wysihtml5.dom.observe=function(f,g,o){g="string"==typeof g?[g]:g;for(var a,b,d=0,e=g.length;e>d;d++){b=g[d],f.addEventListener?f.addEventListener(b,o,!1):(a=function(h){"target" in h||(h.target=h.srcElement),h.preventDefault=h.preventDefault||function(){this.returnValue=!1},h.stopPropagation=h.stopPropagation||function(){this.cancelBubble=!0},o.call(f,h)},f.attachEvent("on"+b,a))}return{stop:function(){for(var j,h=0,i=g.length;i>h;h++){j=g[h],f.removeEventListener?f.removeEventListener(j,o,!1):f.detachEvent("on"+j,a)}}}},wysihtml5.dom.parse=function(a,b){function d(H,I){var J,K,A,B,C,D,E,F,G;for(wysihtml5.lang.object(u).merge(t).merge(I.rules).get(),J=I.context||H.ownerDocument||document,K=J.createDocumentFragment(),A="string"==typeof H,B=!1,I.clearInternals===!0&&(B=!0),C=A?wysihtml5.dom.getAsDom(H,J):H,u.selectors&&f(C,u.selectors);C.firstChild;){E=C.firstChild,D=e(E,I.cleanUp,B,I.uneditableClass),D&&K.appendChild(D),E!==D&&C.removeChild(E)}if(I.unjoinNbsps){for(F=wysihtml5.dom.getTextNodes(K),G=F.length;G--;){F[G].nodeValue=F[G].nodeValue.replace(/([\S\u00A0])\u00A0/gi,"$1 ")}}return C.innerHTML="",C.appendChild(K),A?wysihtml5.quirks.getCorrectInnerHTML(C):C}function e(G,H,I,J){var K,L,A,B=G.nodeType,C=G.childNodes,D=C.length,E=q[B],F=0;if(J&&1===B&&wysihtml5.dom.hasClass(G,J)){return G}if(L=E&&E(G,I),!L){if(L===!1){for(K=G.ownerDocument.createDocumentFragment(),F=D;F--;){C[F]&&(A=e(C[F],H,I,J),A&&(C[F]===A&&F--,K.insertBefore(A,K.firstChild)))}return"block"===wysihtml5.dom.getStyle("display").from(G)&&K.appendChild(G.ownerDocument.createElement("br")),wysihtml5.lang.array(["div","pre","p","table","td","th","ul","ol","li","dd","dl","footer","header","section","h1","h2","h3","h4","h5","h6"]).contains(G.nodeName.toLowerCase())&&G.parentNode.lastChild!==G&&(G.nextSibling&&3===G.nextSibling.nodeType&&/^\s/.test(G.nextSibling.nodeValue)||K.appendChild(G.ownerDocument.createTextNode(" "))),K.normalize&&K.normalize(),K}return null}for(F=0;D>F;F++){C[F]&&(A=e(C[F],H,I,J),A&&(C[F]===A&&F--,L.appendChild(A)))}if(H&&L.nodeName.toLowerCase()===r&&(!L.childNodes.length||/^\s*$/gi.test(L.innerHTML)&&(I||"_wysihtml5-temp-placeholder"!==G.className&&"rangySelectionBoundary"!==G.className)||!L.attributes.length)){for(K=L.ownerDocument.createDocumentFragment();L.firstChild;){K.appendChild(L.firstChild)}return K.normalize&&K.normalize(),K}return L.normalize&&L.normalize(),L}function f(E,F){var A,B,C,D;for(A in F){if(F.hasOwnProperty(A)){for(wysihtml5.lang.object(F[A]).isFunction()?B=F[A]:"string"==typeof F[A]&&aa[F[A]]&&(B=aa[F[A]]),C=E.querySelectorAll(A),D=C.length;D--;){B(C[D])}}}}function g(D,E){var F,G,H,A=u.tags,B=D.nodeName.toLowerCase(),C=D.scopeName;if(D._wysihtml5){return null}if(D._wysihtml5=1,"wysihtml5-temp"===D.className){return null}if(C&&"HTML"!=C&&(B=C+":"+B),"outerHTML" in D&&(wysihtml5.browser.autoClosesUnclosedTags()||"P"!==D.nodeName||"</p>"===D.outerHTML.slice(-4).toLowerCase()||(B="div")),B in A){if(F=A[B],!F||F.remove){return null}if(F.unwrap){return !1}F="string"==typeof F?{rename_tag:F}:F}else{if(!D.firstChild){return null}F={rename_tag:r}}if(F.one_of_type&&!h(D,u,F.one_of_type,E)){if(!F.remove_action){return null}if("unwrap"===F.remove_action){return !1}if("rename"!==F.remove_action){return null}H=F.remove_action_rename_to||r}return G=D.ownerDocument.createElement(H||F.rename_tag||B),n(D,G,F,E),j(D,G,F),D=null,G.normalize&&G.normalize(),G}function h(E,F,A,B){var C,D;if("SPAN"===E.nodeName&&!B&&("_wysihtml5-temp-placeholder"===E.className||"rangySelectionBoundary"===E.className)){return !0}for(D in A){if(A.hasOwnProperty(D)&&F.type_definitions&&F.type_definitions[D]&&(C=F.type_definitions[D],i(E,C))){return !0}}return !1}function i(G,H){var I,J,K,L,A,B,C,D,E=G.getAttribute("class"),F=G.getAttribute("style");if(H.methods){for(B in H.methods){if(H.methods.hasOwnProperty(B)&&z[B]&&z[B](G)){return !0}}}if(E&&H.classes){for(E=E.replace(/^\s+/g,"").replace(/\s+$/g,"").split(s),I=E.length,C=0;I>C;C++){if(H.classes[E[C]]){return !0}}}if(F&&H.styles){F=F.split(";");for(J in H.styles){if(H.styles.hasOwnProperty(J)){for(D=F.length;D--;){if(A=F[D].split(":"),A[0].replace(/\s/g,"").toLowerCase()===J&&(H.styles[J]===!0||1===H.styles[J]||wysihtml5.lang.array(H.styles[J]).contains(A[1].replace(/\s/g,"").toLowerCase()))){return !0}}}}}if(H.attrs){for(K in H.attrs){if(H.attrs.hasOwnProperty(K)&&(L=wysihtml5.dom.getAttribute(G,K),"string"==typeof L&&L.search(H.attrs[K])>-1)){return !0}}}return !1}function j(D,E,A){var B,C;if(A&&A.keep_styles){for(B in A.keep_styles){if(A.keep_styles.hasOwnProperty(B)){if(C="float"===B?D.style.styleFloat||D.style.cssFloat:D.style[B],A.keep_styles[B] instanceof RegExp&&!A.keep_styles[B].test(C)){continue}"float"===B?E.style[D.style.styleFloat?"styleFloat":"cssFloat"]=C:D.style[B]&&(E.style[B]=C)}}}}function k(C,D){var A,B=[];for(A in D){D.hasOwnProperty(A)&&0===A.indexOf(C)&&B.push(A)}return B}function l(E,F,A,B){var C,D=w[A];return D&&(F||"alt"===E&&"IMG"==B)&&(C=D(F),"string"==typeof C)?C:!1}function m(H,I){var J,K,A,B,C,D=wysihtml5.lang.object(u.attributes||{}).clone(),E=wysihtml5.lang.object(D).merge(wysihtml5.lang.object(I||{}).clone()).get(),F={},G=wysihtml5.dom.getAttributes(H);for(J in E){if(/\*$/.test(J)){for(A=k(J.slice(0,-1),G),B=0,C=A.length;C>B;B++){K=l(A[B],G[A[B]],E[J],H.nodeName),K!==!1&&(F[A[B]]=K)}}else{K=l(J,G[J],E[J],H.nodeName),K!==!1&&(F[J]=K)}}return F}function n(E,F,G,I){var J,K,L,M,N,O={},P=G.set_class,Q=G.add_class,R=G.add_style,S=G.set_attributes,T=u.classes,U=0,A=[],B=[],C=[],D=[];if(S&&(O=wysihtml5.lang.object(S).clone()),O=wysihtml5.lang.object(O).merge(m(E,G.check_attributes)).get(),P&&A.push(P),Q){for(M in Q){N=y[Q[M]],N&&(L=N(wysihtml5.dom.getAttribute(E,M)),"string"==typeof L&&A.push(L))}}if(R){for(M in R){N=x[R[M]],N&&(newStyle=N(wysihtml5.dom.getAttribute(E,M)),"string"==typeof newStyle&&B.push(newStyle))}}if("string"==typeof T&&"any"===T&&E.getAttribute("class")){if(u.classes_blacklist){for(D=E.getAttribute("class"),D&&(A=A.concat(D.split(s))),J=A.length;J>U;U++){K=A[U],u.classes_blacklist[K]||C.push(K)}C.length&&(O["class"]=wysihtml5.lang.array(C).unique().join(" "))}else{O["class"]=E.getAttribute("class")}}else{for(I||(T["_wysihtml5-temp-placeholder"]=1,T._rangySelectionBoundary=1,T["wysiwyg-tmp-selected-cell"]=1),D=E.getAttribute("class"),D&&(A=A.concat(D.split(s))),J=A.length;J>U;U++){K=A[U],T[K]&&C.push(K)}C.length&&(O["class"]=wysihtml5.lang.array(C).unique().join(" "))}O["class"]&&I&&(O["class"]=O["class"].replace("wysiwyg-tmp-selected-cell",""),/^\s*$/g.test(O["class"])&&delete O["class"]),B.length&&(O.style=wysihtml5.lang.array(B).unique().join(" "));for(M in O){try{F.setAttribute(M,O[M])}catch(H){}}O.src&&(void 0!==O.width&&F.setAttribute("width",O.width),void 0!==O.height&&F.setAttribute("height",O.height))}function o(B){var C,A=B.nextSibling;return A&&A.nodeType===wysihtml5.TEXT_NODE?(A.data=B.data.replace(v,"")+A.data.replace(v,""),void 0):(C=B.data.replace(v,""),B.ownerDocument.createTextNode(C))}function p(A){return u.comments?A.ownerDocument.createComment(A.nodeValue):void 0}var q={1:g,3:o,8:p},r="span",s=/\s+/,t={tags:{},classes:{}},u={},v=/\uFEFF/g,w={url:function(){var A=/^https?:\/\//i;return function(B){return B&&B.match(A)?B.replace(A,function(C){return C.toLowerCase()}):null}}(),src:function(){var A=/^(\/|https?:\/\/)/i;return function(B){return B&&B.match(A)?B.replace(A,function(C){return C.toLowerCase()}):null}}(),href:function(){var A=/^(#|\/|https?:\/\/|mailto:)/i;return function(B){return B&&B.match(A)?B.replace(A,function(C){return C.toLowerCase()}):null}}(),alt:function(){var A=/[^ a-z0-9_\-]/gi;return function(B){return B?B.replace(A,""):""}}(),numbers:function(){var A=/\D/g;return function(B){return B=(B||"").replace(A,""),B||null}}(),any:function(){return function(A){return A}}()},x={align_text:function(){var A={left:"text-align: left;",right:"text-align: right;",center:"text-align: center;"};return function(B){return A[(B+"").toLowerCase()]}}()},y={align_img:function(){var A={left:"wysiwyg-float-left",right:"wysiwyg-float-right"};return function(B){return A[(B+"").toLowerCase()]}}(),align_text:function(){var A={left:"wysiwyg-text-align-left",right:"wysiwyg-text-align-right",center:"wysiwyg-text-align-center",justify:"wysiwyg-text-align-justify"};return function(B){return A[(B+"").toLowerCase()]}}(),clear_br:function(){var A={left:"wysiwyg-clear-left",right:"wysiwyg-clear-right",both:"wysiwyg-clear-both",all:"wysiwyg-clear-both"};return function(B){return A[(B+"").toLowerCase()]}}(),size_font:function(){var A={1:"wysiwyg-font-size-xx-small",2:"wysiwyg-font-size-small",3:"wysiwyg-font-size-medium",4:"wysiwyg-font-size-large",5:"wysiwyg-font-size-x-large",6:"wysiwyg-font-size-xx-large",7:"wysiwyg-font-size-xx-large","-":"wysiwyg-font-size-smaller","+":"wysiwyg-font-size-larger"};return function(B){return A[(B+"").charAt(0)]}}()},z={has_visible_contet:function(){var A,B=["img","video","picture","br","script","noscript","style","table","iframe","object","embed","audio","svg","input","button","select","textarea","canvas"];return function(C){if(A=(C.innerText||C.textContent).replace(/\s/g,""),A&&A.length>0){return !0}for(var D=B.length;D--;){if(C.querySelector(B[D])){return !0}}return C.offsetWidth&&C.offsetWidth>0&&C.offsetHeight&&C.offsetHeight>0?!0:!1}}()},aa={unwrap:function(A){wysihtml5.dom.unwrap(A)},remove:function(A){A.parentNode.removeChild(A)}};return d(a,b)},wysihtml5.dom.removeEmptyTextNodes=function(e){for(var k,a=wysihtml5.lang.array(e.childNodes).get(),b=a.length,d=0;b>d;d++){k=a[d],k.nodeType===wysihtml5.TEXT_NODE&&""===k.data&&k.parentNode.removeChild(k)}},wysihtml5.dom.renameElement=function(d,i){for(var a,b=d.ownerDocument.createElement(i);a=d.firstChild;){b.appendChild(a)}return wysihtml5.dom.copyAttributes(["align","className"]).from(d).to(b),d.parentNode.replaceChild(b,d),b},wysihtml5.dom.replaceWithChildNodes=function(a){if(a.parentNode){if(!a.firstChild){return a.parentNode.removeChild(a),void 0}for(var b=a.ownerDocument.createDocumentFragment();a.firstChild;){b.appendChild(a.firstChild)}a.parentNode.replaceChild(b,a),a=b=null}},function(e){function k(f){return"block"===e.getStyle("display").from(f)}function a(f){return"BR"===f.nodeName}function b(f){var g=f.ownerDocument.createElement("br");f.appendChild(g)}function d(m,n){if(m.nodeName.match(/^(MENU|UL|OL)$/)){var x,y,z,f,g,h,i=m.ownerDocument,j=i.createDocumentFragment(),l=wysihtml5.dom.domNode(m).prev({ignoreBlankTexts:!0});if(n){for(!l||k(l)||a(l)||b(j);h=m.firstElementChild||m.firstChild;){for(y=h.lastChild;x=h.firstChild;){z=x===y,f=z&&!k(x)&&!a(x),j.appendChild(x),f&&b(j)}h.parentNode.removeChild(h)}}else{for(;h=m.firstElementChild||m.firstChild;){if(h.querySelector&&h.querySelector("div, p, ul, ol, menu, blockquote, h1, h2, h3, h4, h5, h6")){for(;x=h.firstChild;){j.appendChild(x)}}else{for(g=i.createElement("p");x=h.firstChild;){g.appendChild(x)}j.appendChild(g)}h.parentNode.removeChild(h)}}m.parentNode.replaceChild(j,m)}}e.resolveList=d}(wysihtml5.dom),function(e){var k=document,a=["parent","top","opener","frameElement","frames","localStorage","globalStorage","sessionStorage","indexedDB"],b=["open","close","openDialog","showModalDialog","alert","confirm","prompt","openDatabase","postMessage","XMLHttpRequest","XDomainRequest"],d=["referrer","write","open","close"];e.dom.Sandbox=Base.extend({constructor:function(f,g){this.callback=f||e.EMPTY_FUNCTION,this.config=e.lang.object({}).merge(g).get(),this.editableArea=this._createIframe()},insertInto:function(f){"string"==typeof f&&(f=k.getElementById(f)),f.appendChild(this.editableArea)},getIframe:function(){return this.editableArea},getWindow:function(){this._readyError()},getDocument:function(){this._readyError()},destroy:function(){var f=this.getIframe();f.parentNode.removeChild(f)},_readyError:function(){throw Error("wysihtml5.Sandbox: Sandbox iframe isn't loaded yet")},_createIframe:function(){var f=this,g=k.createElement("iframe");return g.className="wysihtml5-sandbox",e.dom.setAttributes({security:"restricted",allowtransparency:"true",frameborder:0,width:0,height:0,marginwidth:0,marginheight:0}).on(g),e.browser.throwsMixedContentWarningWhenIframeSrcIsEmpty()&&(g.src="javascript:'<html></html>'"),g.onload=function(){g.onreadystatechange=g.onload=null,f._onLoadIframe(g)},g.onreadystatechange=function(){/loaded|complete/.test(g.readyState)&&(g.onreadystatechange=g.onload=null,f._onLoadIframe(g))},g},_onLoadIframe:function(h){var j,m,r,i,l,f,g;if(e.dom.contains(k.documentElement,h)){if(j=this,m=h.contentWindow,r=h.contentWindow.document,i=k.characterSet||k.charset||"utf-8",l=this._getHtml({charset:i,stylesheets:this.config.stylesheets}),r.open("text/html","replace"),r.write(l),r.close(),this.getWindow=function(){return h.contentWindow},this.getDocument=function(){return h.contentWindow.document},m.onerror=function(o,p,n){throw Error("wysihtml5.Sandbox: "+o,p,n)},!e.browser.supportsSandboxedIframes()){for(f=0,g=a.length;g>f;f++){this._unset(m,a[f])}for(f=0,g=b.length;g>f;f++){this._unset(m,b[f],e.EMPTY_FUNCTION)}for(f=0,g=d.length;g>f;f++){this._unset(r,d[f])}this._unset(r,"cookie","",!0)}this.loaded=!0,setTimeout(function(){j.callback(j)},0)}},_getHtml:function(h){var j,f=h.stylesheets,g="",i=0;if(f="string"==typeof f?[f]:f,f){for(j=f.length;j>i;i++){g+='<link rel="stylesheet" href="'+f[i]+'">'}}return h.stylesheets=g,e.lang.string('<!DOCTYPE html><html><head><meta charset="#{charset}">#{stylesheets}</head><body></body></html>').interpolate(h)},_unset:function(h,j,p,f){try{h[j]=p}catch(g){}try{h.__defineGetter__(j,function(){return p})}catch(g){}if(f){try{h.__defineSetter__(j,function(){})}catch(g){}}if(!e.browser.crashesWhenDefineProperty(j)){try{var i={get:function(){return p}};f&&(i.set=function(){}),Object.defineProperty(h,j,i)}catch(g){}}}})}(wysihtml5),function(a){var b=document;a.dom.ContentEditableArea=Base.extend({getContentEditable:function(){return this.element},getWindow:function(){return this.element.ownerDocument.defaultView},getDocument:function(){return this.element.ownerDocument},constructor:function(d,e,h){this.callback=d||a.EMPTY_FUNCTION,this.config=a.lang.object({}).merge(e).get(),this.element=h?this._bindElement(h):this._createElement()},_createElement:function(){var d=b.createElement("div");return d.className="wysihtml5-sandbox",this._loadElement(d),d},_bindElement:function(d){return d.className=d.className&&""!=d.className?d.className+" wysihtml5-sandbox":"wysihtml5-sandbox",this._loadElement(d,!0),d},_loadElement:function(j,k){var d,e=this;k||(d=this._getHtml(),j.innerHTML=d),this.getWindow=function(){return j.ownerDocument.defaultView},this.getDocument=function(){return j.ownerDocument},this.loaded=!0,setTimeout(function(){e.callback(e)},0)},_getHtml:function(){return""}})}(wysihtml5),function(){var a={className:"class"};wysihtml5.dom.setAttributes=function(b){return{on:function(d){for(var g in b){d.setAttribute(a[g]||g,b[g])}}}}}(),wysihtml5.dom.setStyles=function(a){return{on:function(b){var d,g=b.style;if("string"==typeof a){return g.cssText+=";"+a,void 0}for(d in a){"float"===d?(g.cssFloat=a[d],g.styleFloat=a[d]):g[d]=a[d]}}}},function(a){a.simulatePlaceholder=function(d,b,e){var f="placeholder",g=function(){var h=b.element.offsetWidth>0&&b.element.offsetHeight>0;b.hasPlaceholderSet()&&(b.clear(),b.element.focus(),h&&setTimeout(function(){var i=b.selection.getSelection();i.focusNode&&i.anchorNode||b.selection.selectNode(b.element.firstChild||b.element)},0)),b.placeholderSet=!1,a.removeClass(b.element,f)},m=function(){b.isEmpty()&&(b.placeholderSet=!0,b.setValue(e),a.addClass(b.element,f))};d.on("set_placeholder",m).on("unset_placeholder",g).on("focus:composer",g).on("paste:composer",g).on("blur:composer",m),m()}}(wysihtml5.dom),function(a){var b=document.documentElement;"textContent" in b?(a.setTextContent=function(d,e){d.textContent=e},a.getTextContent=function(d){return d.textContent}):"innerText" in b?(a.setTextContent=function(d,e){d.innerText=e},a.getTextContent=function(d){return d.innerText}):(a.setTextContent=function(d,e){d.nodeValue=e},a.getTextContent=function(d){return d.nodeValue})}(wysihtml5.dom),wysihtml5.dom.getAttribute=function(f,m){var a,b,d,e=!wysihtml5.browser.supportsGetAttributeCorrectly();return m=m.toLowerCase(),a=f.nodeName,"IMG"==a&&"src"==m&&wysihtml5.dom.isLoadedImage(f)===!0?f.src:e&&"outerHTML" in f?(b=f.outerHTML.toLowerCase(),d=-1!=b.indexOf(" "+m+"="),d?f.getAttribute(m):null):f.getAttribute(m)},wysihtml5.dom.getAttributes=function(e){var k,a=!wysihtml5.browser.supportsGetAttributeCorrectly(),b=e.nodeName,d=[];for(k in e.attributes){(e.attributes.hasOwnProperty&&e.attributes.hasOwnProperty(k)||!e.attributes.hasOwnProperty&&Object.prototype.hasOwnProperty.call(e.attributes,k))&&e.attributes[k].specified&&("IMG"==b&&"src"==e.attributes[k].name.toLowerCase()&&wysihtml5.dom.isLoadedImage(e)===!0?d.src=e.src:wysihtml5.lang.array(["rowspan","colspan"]).contains(e.attributes[k].name.toLowerCase())&&a?1!==e.attributes[k].value&&(d[e.attributes[k].name]=e.attributes[k].value):d[e.attributes[k].name]=e.attributes[k].value)}return d},wysihtml5.dom.isLoadedImage=function(a){try{return a.complete&&!a.mozMatchesSelector(":-moz-broken")}catch(b){if(a.complete&&"complete"===a.readyState){return !0}}},function(d){function e(m,o){var j,k,l,n,p=[];for(k=0,l=m.length;l>k;k++){if(j=m[k].querySelectorAll(o),j){for(n=j.length;n--;p.unshift(j[n])){}}}return p}function f(j){j.parentNode.removeChild(j)}function g(j,k){j.parentNode.insertBefore(k,j.nextSibling)}function h(k,l){for(var j=k.nextSibling;1!=j.nodeType;){if(j=j.nextSibling,!l||l==j.tagName.toLowerCase()){return j}}return null}var i=d.dom,a=function(j){this.el=j,this.isColspan=!1,this.isRowspan=!1,this.firstCol=!0,this.lastCol=!0,this.firstRow=!0,this.lastRow=!0,this.isReal=!0,this.spanCollection=[],this.modified=!1},b=function(j,k){j?(this.cell=j,this.table=i.getParentElement(j,{nodeName:["TABLE"]})):k&&(this.table=k,this.cell=this.table.querySelectorAll("th, td")[0])};b.prototype={addSpannedCellToMap:function(k,m,n,o,p,q){var B,C,D=[],j=n+(q?parseInt(q,10)-1:0),l=o+(p?parseInt(p,10)-1:0);for(B=n;j>=B;B++){for(void 0===m[B]&&(m[B]=[]),C=o;l>=C;C++){m[B][C]=new a(k),m[B][C].isColspan=p&&parseInt(p,10)>1,m[B][C].isRowspan=q&&parseInt(q,10)>1,m[B][C].firstCol=C==o,m[B][C].lastCol=C==l,m[B][C].firstRow=B==n,m[B][C].lastRow=B==j,m[B][C].isReal=C==o&&B==n,m[B][C].spanCollection=D,D.push(m[B][C])}}},setCellAsModified:function(k){if(k.modified=!0,k.spanCollection.length>0){for(var l=0,j=k.spanCollection.length;j>l;l++){k.spanCollection[l].modified=!0}}},setTableMap:function(){var m,n,o,p,q,z,A,j,k=[],l=this.getTableRows();for(m=0;m<l.length;m++){for(n=l[m],o=this.getRowCells(n),z=0,void 0===k[m]&&(k[m]=[]),p=0;p<o.length;p++){for(q=o[p];void 0!==k[m][z];){z++}A=i.getAttribute(q,"colspan"),j=i.getAttribute(q,"rowspan"),A||j?(this.addSpannedCellToMap(q,k,m,z,A,j),z+=A?parseInt(A,10):1):(k[m][z]=new a(q),z++)}}return this.map=k,k},getRowCells:function(n){var l=this.table.querySelectorAll("table"),m=l?e(l,"th, td"):[],j=n.querySelectorAll("th, td"),k=m.length>0?d.lang.array(j).without(m):j;return k},getTableRows:function(){var l=this.table.querySelectorAll("table"),m=l?e(l,"tr"):[],j=this.table.querySelectorAll("tr"),k=m.length>0?d.lang.array(j).without(m):j;return k},getMapIndex:function(m){var n,l,j=this.map.length,k=this.map&&this.map[0]?this.map[0].length:0;for(n=0;j>n;n++){for(l=0;k>l;l++){if(this.map[n][l].el===m){return{row:n,col:l}}}}return !1},getElementAtIndex:function(j){return this.setTableMap(),this.map[j.row]&&this.map[j.row][j.col]&&this.map[j.row][j.col].el?this.map[j.row][j.col].el:null},getMapElsTo:function(q){var o,j,k,l,m,n,p=[];if(this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(q),(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)&&(o=this.idx_start,this.idx_start=this.idx_end,this.idx_end=o),this.idx_start.col>this.idx_end.col&&(j=this.idx_start.col,this.idx_start.col=this.idx_end.col,this.idx_end.col=j),null!=this.idx_start&&null!=this.idx_end){for(k=this.idx_start.row,l=this.idx_end.row;l>=k;k++){for(m=this.idx_start.col,n=this.idx_end.col;n>=m;m++){p.push(this.map[k][m].el)}}}return p},orderSelectionEnds:function(k){var l,j;return this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(k),(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)&&(l=this.idx_start,this.idx_start=this.idx_end,this.idx_end=l),this.idx_start.col>this.idx_end.col&&(j=this.idx_start.col,this.idx_start.col=this.idx_end.col,this.idx_end.col=j),{start:this.map[this.idx_start.row][this.idx_start.col].el,end:this.map[this.idx_end.row][this.idx_end.col].el}},createCells:function(q,o,j){var k,l,m,n=this.table.ownerDocument,p=n.createDocumentFragment();for(l=0;o>l;l++){if(k=n.createElement(q),j){for(m in j){j.hasOwnProperty(m)&&k.setAttribute(m,j[m])}}k.appendChild(document.createTextNode(" ")),p.appendChild(k)}return p},correctColIndexForUnreals:function(m,o){var k,l,n=this.map[o],j=-1;for(k=0,l=m;m>k;k++){n[k].isReal&&j++}return j},getLastNewCellOnRow:function(m,o){var j,k,l,n,p=this.getRowCells(m);for(l=0,n=p.length;n>l;l++){if(j=p[l],k=this.getMapIndex(j),k===!1||void 0!==o&&k.row!=o){return j}}return null},removeEmptyTable:function(){var j=this.table.querySelectorAll("td, th");return j&&0!=j.length?!1:(f(this.table),!0)},splitRowToCells:function(l){var m,j,k;l.isColspan&&(m=parseInt(i.getAttribute(l.el,"colspan")||1,10),j=l.el.tagName.toLowerCase(),m>1&&(k=this.createCells(j,m-1),g(l.el,k)),l.el.removeAttribute("colspan"))},getRealRowEl:function(m,o){var k,l,n=null,j=null;for(o=o||this.idx,k=0,l=this.map[o.row].length;l>k;k++){if(j=this.map[o.row][k],j.isReal&&(n=i.getParentElement(j.el,{nodeName:["TR"]}),n)){return n}}return null===n&&m&&(n=i.getParentElement(this.map[o.row][o.col].el,{nodeName:["TR"]})||null),n},injectRowAt:function(m,n,o,p,q){var y,j,k=this.getRealRowEl(!1,{row:m,col:n}),l=this.createCells(p,o);k?(y=this.correctColIndexForUnreals(n,m),y>=0?g(this.getRowCells(k)[y],l):k.insertBefore(l,k.firstChild)):(j=this.table.ownerDocument.createElement("tr"),j.appendChild(l),g(i.getParentElement(q.el,{nodeName:["TR"]}),j))},canMerge:function(m){var o,j,k,l,n,p;for(this.to=m,this.setTableMap(),this.idx_start=this.getMapIndex(this.cell),this.idx_end=this.getMapIndex(this.to),(this.idx_start.row>this.idx_end.row||this.idx_start.row==this.idx_end.row&&this.idx_start.col>this.idx_end.col)&&(o=this.idx_start,this.idx_start=this.idx_end,this.idx_end=o),this.idx_start.col>this.idx_end.col&&(j=this.idx_start.col,this.idx_start.col=this.idx_end.col,this.idx_end.col=j),k=this.idx_start.row,l=this.idx_end.row;l>=k;k++){for(n=this.idx_start.col,p=this.idx_end.col;p>=n;n++){if(this.map[k][n].isColspan||this.map[k][n].isRowspan){return !1}}}return !0},decreaseCellSpan:function(k,l){var j=parseInt(i.getAttribute(k.el,l),10)-1;j>=1?k.el.setAttribute(l,j):(k.el.removeAttribute(l),"colspan"==l&&(k.isColspan=!1),"rowspan"==l&&(k.isRowspan=!1),k.firstCol=!0,k.lastCol=!0,k.firstRow=!0,k.lastRow=!0,k.isReal=!0)},removeSurplusLines:function(){var p,q,j,k,l,m,n,o;if(this.setTableMap(),this.map){for(j=0,k=this.map.length;k>j;j++){for(p=this.map[j],n=!0,l=0,m=p.length;m>l;l++){if(q=p[l],!(i.getAttribute(q.el,"rowspan")&&parseInt(i.getAttribute(q.el,"rowspan"),10)>1&&q.firstRow!==!0)){n=!1;break}}if(n){for(l=0;m>l;l++){this.decreaseCellSpan(p[l],"rowspan")}}}for(o=this.getTableRows(),j=0,k=o.length;k>j;j++){p=o[j],0==p.childNodes.length&&/^\s*$/.test(p.textContent||p.innerText)&&f(p)}}},fillMissingCells:function(){var m,o,k,l=0,n=0,j=null;if(this.setTableMap(),this.map){for(l=this.map.length,m=0;l>m;m++){this.map[m].length>n&&(n=this.map[m].length)}for(o=0;l>o;o++){for(k=0;n>k;k++){this.map[o]&&!this.map[o][k]&&k>0&&(this.map[o][k]=new a(this.createCells("td",1)),j=this.map[o][k-1],j&&j.el&&j.el.parent&&g(this.map[o][k-1].el,this.map[o][k].el))}}}},rectify:function(){return this.removeEmptyTable()?!1:(this.removeSurplusLines(),this.fillMissingCells(),!0)},unmerge:function(){var m,o,k,l,n,j;if(this.rectify()&&(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx)){if(m=this.map[this.idx.row][this.idx.col],o=i.getAttribute(m.el,"colspan")?parseInt(i.getAttribute(m.el,"colspan"),10):1,k=m.el.tagName.toLowerCase(),m.isRowspan){if(l=parseInt(i.getAttribute(m.el,"rowspan"),10),l>1){for(n=1,j=l-1;j>=n;n++){this.injectRowAt(this.idx.row+n,this.idx.col,o,k,m)}}m.el.removeAttribute("rowspan")}this.splitRowToCells(m)}},merge:function(m){var p,j,k,l,n,o;if(this.rectify()){if(this.canMerge(m)){for(p=this.idx_end.row-this.idx_start.row+1,j=this.idx_end.col-this.idx_start.col+1,k=this.idx_start.row,l=this.idx_end.row;l>=k;k++){for(n=this.idx_start.col,o=this.idx_end.col;o>=n;n++){k==this.idx_start.row&&n==this.idx_start.col?(p>1&&this.map[k][n].el.setAttribute("rowspan",p),j>1&&this.map[k][n].el.setAttribute("colspan",j)):(/^\s*<br\/?>\s*$/.test(this.map[k][n].el.innerHTML.toLowerCase())||(this.map[this.idx_start.row][this.idx_start.col].el.innerHTML+=" "+this.map[k][n].el.innerHTML),f(this.map[k][n].el))}}this.rectify()}else{window.console&&void 0}}},collapseCellToNextRow:function(o){var p,j,k,l=this.getMapIndex(o.el),m=l.row+1,n={row:m,col:l.col};m<this.map.length&&(p=this.getRealRowEl(!1,n),null!==p&&(j=this.correctColIndexForUnreals(n.col,n.row),j>=0?g(this.getRowCells(p)[j],o.el):(k=this.getLastNewCellOnRow(p,m),null!==k?g(k,o.el):p.insertBefore(o.el,p.firstChild)),parseInt(i.getAttribute(o.el,"rowspan"),10)>2?o.el.setAttribute("rowspan",parseInt(i.getAttribute(o.el,"rowspan"),10)-1):o.el.removeAttribute("rowspan")))},removeRowCell:function(j){j.isReal?j.isRowspan?this.collapseCellToNextRow(j):f(j.el):parseInt(i.getAttribute(j.el,"rowspan"),10)>2?j.el.setAttribute("rowspan",parseInt(i.getAttribute(j.el,"rowspan"),10)-1):j.el.removeAttribute("rowspan")},getRowElementsByCell:function(){var l,m,j,k=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1){for(l=this.map[this.idx.row],m=0,j=l.length;j>m;m++){l[m].isReal&&k.push(l[m].el)}}return k},getColumnElementsByCell:function(){var k,l,j=[];if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1){for(k=0,l=this.map.length;l>k;k++){this.map[k][this.idx.col]&&this.map[k][this.idx.col].isReal&&j.push(this.map[k][this.idx.col].el)}}return j},removeRow:function(){var l,m,j,k=i.getParentElement(this.cell,{nodeName:["TR"]});if(k){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1){for(l=this.map[this.idx.row],m=0,j=l.length;j>m;m++){l[m].modified||(this.setCellAsModified(l[m]),this.removeRowCell(l[m]))}}f(k)}},removeColCell:function(j){j.isColspan?parseInt(i.getAttribute(j.el,"colspan"),10)>2?j.el.setAttribute("colspan",parseInt(i.getAttribute(j.el,"colspan"),10)-1):j.el.removeAttribute("colspan"):j.isReal&&f(j.el)},removeColumn:function(){if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),this.idx!==!1){for(var j=0,k=this.map.length;k>j;j++){this.map[j][this.idx.col].modified||(this.setCellAsModified(this.map[j][this.idx.col]),this.removeColCell(this.map[j][this.idx.col]))}}},remove:function(j){if(this.rectify()){switch(j){case"row":this.removeRow();break;case"column":this.removeColumn()}this.rectify()}},addRow:function(o){var p,j,k,l,m,n=this.table.ownerDocument;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"below"==o&&i.getAttribute(this.cell,"rowspan")&&(this.idx.row=this.idx.row+parseInt(i.getAttribute(this.cell,"rowspan"),10)-1),this.idx!==!1){for(p=this.map[this.idx.row],j=n.createElement("tr"),k=0,l=p.length;l>k;k++){p[k].modified||(this.setCellAsModified(p[k]),this.addRowCell(p[k],j,o))}switch(o){case"below":g(this.getRealRowEl(!0),j);break;case"above":m=i.getParentElement(this.map[this.idx.row][this.idx.col].el,{nodeName:["TR"]}),m&&m.parentNode.insertBefore(j,m)}}},addRowCell:function(l,m,j){var k=l.isColspan?{colspan:i.getAttribute(l.el,"colspan")}:null;l.isReal?"above"!=j&&l.isRowspan?l.el.setAttribute("rowspan",parseInt(i.getAttribute(l.el,"rowspan"),10)+1):m.appendChild(this.createCells("td",1,k)):"above"!=j&&l.isRowspan&&l.lastRow?m.appendChild(this.createCells("td",1,k)):c.isRowspan&&l.el.attr("rowspan",parseInt(i.getAttribute(l.el,"rowspan"),10)+1)},add:function(j){this.rectify()&&(("below"==j||"above"==j)&&this.addRow(j),("before"==j||"after"==j)&&this.addColumn(j))},addColCell:function(m,n,k){var l,j=m.el.tagName.toLowerCase();switch(k){case"before":l=!m.isColspan||m.firstCol;break;case"after":l=!m.isColspan||m.lastCol||m.isColspan&&c.el==this.cell}if(l){switch(k){case"before":m.el.parentNode.insertBefore(this.createCells(j,1),m.el);break;case"after":g(m.el,this.createCells(j,1))}m.isRowspan&&this.handleCellAddWithRowspan(m,n+1,k)}else{m.el.setAttribute("colspan",parseInt(i.getAttribute(m.el,"colspan"),10)+1)}},addColumn:function(m){var n,l,j,k;if(this.setTableMap(),this.idx=this.getMapIndex(this.cell),"after"==m&&i.getAttribute(this.cell,"colspan")&&(this.idx.col=this.idx.col+parseInt(i.getAttribute(this.cell,"colspan"),10)-1),this.idx!==!1){for(j=0,k=this.map.length;k>j;j++){n=this.map[j],n[this.idx.col]&&(l=n[this.idx.col],l.modified||(this.setCellAsModified(l),this.addColCell(l,j,m)))}}},handleCellAddWithRowspan:function(n,o,p){var q,z,A,B,j=parseInt(i.getAttribute(this.cell,"rowspan"),10)-1,k=i.getParentElement(n.el,{nodeName:["TR"]}),l=n.el.tagName.toLowerCase(),m=this.table.ownerDocument;for(B=0;j>B;B++){if(q=this.correctColIndexForUnreals(this.idx.col,o+B),k=h(k,"tr"),k){if(q>0){switch(p){case"before":z=this.getRowCells(k),q>0&&this.map[o+B][this.idx.col].el!=z[q]&&q==z.length-1?g(z[q],this.createCells(l,1)):z[q].parentNode.insertBefore(this.createCells(l,1),z[q]);break;case"after":g(this.getRowCells(k)[q],this.createCells(l,1))}}else{k.insertBefore(this.createCells(l,1),k.firstChild)}}else{A=m.createElement("tr"),A.appendChild(this.createCells(l,1)),this.table.appendChild(A)}}}},i.table={getCellsBetween:function(k,l){var j=new b(k);return j.getMapElsTo(l)},addCells:function(k,l){var j=new b(k);j.add(l)},removeCells:function(k,l){var j=new b(k);j.remove(l)},mergeCellsBetween:function(k,l){var j=new b(k);j.merge(l)},unmergeCell:function(j){var k=new b(j);k.unmerge()},orderSelectionEnds:function(k,l){var j=new b(k);return j.orderSelectionEnds(l)},indexOf:function(j){var k=new b(j);return k.setTableMap(),k.getMapIndex(j)},findCell:function(k,l){var j=new b(null,k);return j.getElementAtIndex(l)},findRowByCell:function(j){var k=new b(j);return k.getRowElementsByCell()},findColumnByCell:function(j){var k=new b(j);return k.getColumnElementsByCell()},canMerge:function(k,l){var j=new b(k);return j.canMerge(l)}}}(wysihtml5),wysihtml5.dom.query=function(f,g){var o,a,b,d,e=[];for(f.nodeType&&(f=[f]),a=0,b=f.length;b>a;a++){if(o=f[a].querySelectorAll(g),o){for(d=o.length;d--;e.unshift(o[d])){}}}return e},wysihtml5.dom.compareDocumentPosition=function(){var a=document.documentElement;return a.compareDocumentPosition?function(b,f){return b.compareDocumentPosition(f)}:function(j,k){var w,x,b,d,e,f,g,h,i;if(w=9===j.nodeType?j:j.ownerDocument,x=9===k.nodeType?k:k.ownerDocument,j===k){return 0}if(j===k.ownerDocument){return 20}if(j.ownerDocument===k){return 10}if(w!==x){return 1}if(2===j.nodeType&&j.childNodes&&-1!==wysihtml5.lang.array(j.childNodes).indexOf(k)){return 20}if(2===k.nodeType&&k.childNodes&&-1!==wysihtml5.lang.array(k.childNodes).indexOf(j)){return 10}for(b=j,d=[],e=null;b;){if(b==k){return 10}d.push(b),b=b.parentNode}for(b=k,e=null;b;){if(b==j){return 20}if(f=wysihtml5.lang.array(d).indexOf(b),-1!==f){return g=d[f],h=wysihtml5.lang.array(g.childNodes).indexOf(d[f-1]),i=wysihtml5.lang.array(g.childNodes).indexOf(e),h>i?2:4}e=b,b=b.parentNode}return 1}}(),wysihtml5.dom.unwrap=function(a){if(a.parentNode){for(;a.lastChild;){wysihtml5.dom.insert(a.lastChild).after(a)}a.parentNode.removeChild(a)}},wysihtml5.dom.getPastedHtml=function(a){var b;return a.clipboardData&&(wysihtml5.lang.array(a.clipboardData.types).contains("text/html")?b=a.clipboardData.getData("text/html"):wysihtml5.lang.array(a.clipboardData.types).contains("text/plain")&&(b=wysihtml5.lang.string(a.clipboardData.getData("text/plain")).escapeHTML(!0,!0))),b},wysihtml5.dom.getPastedHtmlWithDiv=function(e,k){var a=e.selection.getBookmark(),b=e.element.ownerDocument,d=b.createElement("DIV");b.body.appendChild(d),d.style.width="1px",d.style.height="1px",d.style.overflow="hidden",d.setAttribute("contenteditable","true"),d.focus(),setTimeout(function(){e.selection.setBookmark(a),k(d.innerHTML),d.parentNode.removeChild(d)},0)},wysihtml5.quirks.cleanPastedHTML=function(){var b=function(e){var f=wysihtml5.lang.string(e).trim(),d=f.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&");return RegExp("^((?!^"+d+"$).)*$","i")},g=function(d,e){var f,k,l=wysihtml5.lang.object(d).clone(!0);for(f in l.tags){if(l.tags.hasOwnProperty(f)&&l.tags[f].keep_styles){for(k in l.tags[f].keep_styles){l.tags[f].keep_styles.hasOwnProperty(k)&&e[k]&&(l.tags[f].keep_styles[k]=b(e[k]))}}}return l},a=function(l,m){var d,e,f;if(!l){return null}for(e=0,f=l.length;f>e;e++){if(l[e].condition||(d=l[e].set),l[e].condition&&l[e].condition.test(m)){return l[e].set}}return d};return function(d,e){var f,l={color:wysihtml5.dom.getStyle("color").from(e.referenceNode),fontSize:wysihtml5.dom.getStyle("font-size").from(e.referenceNode)},m=g(a(e.rules,d)||{},l);return f=wysihtml5.dom.parse(d,{rules:m,cleanUp:!0,context:e.referenceNode.ownerDocument,uneditableClass:e.uneditableClass,clearInternals:!0,unjoinNbsps:!0}),f}}(),wysihtml5.quirks.ensureProperClearing=function(){var a=function(){var b=this;setTimeout(function(){var d=b.innerHTML.toLowerCase();("<p>&nbsp;</p>"==d||"<p>&nbsp;</p><p>&nbsp;</p>"==d)&&(b.innerHTML="")},0)};return function(b){wysihtml5.dom.observe(b.element,["cut","keydown"],a)}}(),function(a){var b="%7E";a.quirks.getCorrectInnerHTML=function(o){var e,g,h,i,d,f=o.innerHTML;if(-1===f.indexOf(b)){return f}for(e=o.querySelectorAll("[href*='~'], [src*='~']"),d=0,i=e.length;i>d;d++){g=e[d].href||e[d].src,h=a.lang.string(g).replace("~").by(b),f=a.lang.string(f).replace(h).by(g)}return f}}(wysihtml5),function(a){var b="wysihtml5-quirks-redraw";a.quirks.redraw=function(g){a.dom.addClass(g,b),a.dom.removeClass(g,b);try{var d=g.ownerDocument;d.execCommand("italic",!1,null),d.execCommand("italic",!1,null)}catch(e){}}}(wysihtml5),wysihtml5.quirks.tableCellsSelection=function(b,e){function g(){return o.observe(b,"mousedown",function(p){var q=wysihtml5.dom.getParentElement(p.target,{nodeName:["TD","TH"]});q&&h(q)}),E}function h(p){E.start=p,E.end=p,E.cells=[p],E.table=o.getParentElement(E.start,{nodeName:["TABLE"]}),E.table&&(i(),o.addClass(p,a),d=o.observe(b,"mousemove",k),f=o.observe(b,"mouseup",l),e.fire("tableselectstart").fire("tableselectstart:composer"))}function i(){var p,q;if(b&&(p=b.querySelectorAll("."+a),p.length>0)){for(q=0;q<p.length;q++){o.removeClass(p[q],a)}}}function j(p){for(var q=0;q<p.length;q++){o.addClass(p[q],a)}}function k(p){var q,r=null,s=o.getParentElement(p.target,{nodeName:["TD","TH"]});s&&E.table&&E.start&&(r=o.getParentElement(s,{nodeName:["TABLE"]}),r&&r===E.table&&(i(),q=E.end,E.end=s,E.cells=o.table.getCellsBetween(E.start,s),E.cells.length>1&&e.composer.selection.deselect(),j(E.cells),E.end!==q&&e.fire("tableselectchange").fire("tableselectchange:composer")))}function l(){d.stop(),f.stop(),e.fire("tableselect").fire("tableselect:composer"),setTimeout(function(){m()},0)}function m(){var p=o.observe(b.ownerDocument,"click",function(q){p.stop(),o.getParentElement(q.target,{nodeName:["TABLE"]})!=E.table&&(i(),E.table=null,E.start=null,E.end=null,e.fire("tableunselect").fire("tableunselect:composer"))})}function n(p,q){E.start=p,E.end=q,E.table=o.getParentElement(E.start,{nodeName:["TABLE"]}),selectedCells=o.table.getCellsBetween(E.start,E.end),j(selectedCells),m(),e.fire("tableselect").fire("tableselect:composer")}var o=wysihtml5.dom,E={table:null,start:null,end:null,cells:null,select:n},a="wysiwyg-tmp-selected-cell",d=null,f=null;return g()},function(f){var m=/^rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*([\d\.]+)\s*\)/i,a=/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/i,b=/^#([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])/i,d=/^#([0-9a-f])([0-9a-f])([0-9a-f])/i,e=function(g){return RegExp("(^|\\s|;)"+g+"\\s*:\\s*[^;$]+","gi")};f.quirks.styleParser={parseColor:function(l,r){var j,k,n,g=e(r),h=l.match(g),i=10;if(h){for(n=h.length;n--;){h[n]=f.lang.string(h[n].split(":")[1]).trim()}if(j=h[h.length-1],m.test(j)){k=j.match(m)}else{if(a.test(j)){k=j.match(a)}else{if(b.test(j)){k=j.match(b),i=16}else{if(d.test(j)){return k=j.match(d),k.shift(),k.push(1),f.lang.array(k).map(function(p,o){return 3>o?16*parseInt(p,16)+parseInt(p,16):parseFloat(p)})}}}}if(k){return k.shift(),k[3]||k.push(1),f.lang.array(k).map(function(p,o){return 3>o?parseInt(p,i):parseFloat(p)})}}return !1},unparseColor:function(g,h){if(h){if("hex"==h){return g[0].toString(16).toUpperCase()+g[1].toString(16).toUpperCase()+g[2].toString(16).toUpperCase()}if("hash"==h){return"#"+g[0].toString(16).toUpperCase()+g[1].toString(16).toUpperCase()+g[2].toString(16).toUpperCase()}if("rgb"==h){return"rgb("+g[0]+","+g[1]+","+g[2]+")"}if("rgba"==h){return"rgba("+g[0]+","+g[1]+","+g[2]+","+g[3]+")"}if("csv"==h){return g[0]+","+g[1]+","+g[2]+","+g[3]}}return g[3]&&1!==g[3]?"rgba("+g[0]+","+g[1]+","+g[2]+","+g[3]+")":"rgb("+g[0]+","+g[1]+","+g[2]+")"},parseFontSize:function(g){var h=g.match(e("font-size"));return h?f.lang.string(h[h.length-1].split(":")[1]).trim():!1}}}(wysihtml5),function(e){function k(f){var g=0;if(f.parentNode){do{g+=f.offsetTop||0,f=f.offsetParent}while(f)}return g}function a(g,h){for(var f=0;h!==g;){if(f++,h=h.parentNode,!h){throw Error("not a descendant of ancestor!")}}return f}function b(g){if(!g.canSurroundContents()){for(var h=g.commonAncestorContainer,i=a(h,g.startContainer),f=a(h,g.endContainer);!g.canSurroundContents();){i>f?(g.setStartBefore(g.startContainer),i=a(h,g.startContainer)):(g.setEndAfter(g.endContainer),f=a(h,g.endContainer))}}}var d=e.dom;e.Selection=Base.extend({constructor:function(g,h,f){window.rangy.init(),this.editor=g,this.composer=g.composer,this.doc=this.composer.doc,this.contain=h,this.unselectableClass=f||!1},getBookmark:function(){var f=this.getRange();return f&&b(f),f&&f.cloneRange()},setBookmark:function(f){f&&this.setSelection(f)},setBefore:function(f){var g=rangy.createRange(this.doc);return g.setStartBefore(f),g.setEndBefore(f),this.setSelection(g)},setAfter:function(f){var g=rangy.createRange(this.doc);return g.setStartAfter(f),g.setEndAfter(f),this.setSelection(g)},selectNode:function(w,x){var f=rangy.createRange(this.doc),g=w.nodeType===e.ELEMENT_NODE,h="canHaveHTML" in w?w.canHaveHTML:"IMG"!==w.nodeName,i=g?w.innerHTML:w.data,j=""===i||i===e.INVISIBLE_SPACE,l=d.getStyle("display").from(w),u="block"===l||"list-item"===l;if(j&&g&&h&&!x){try{w.innerHTML=e.INVISIBLE_SPACE}catch(v){}}h?f.selectNodeContents(w):f.selectNode(w),h&&j&&g?f.collapse(u):h&&j&&(f.setStartAfter(w),f.setEndAfter(w)),this.setSelection(f)},getSelectedNode:function(g){var h,f;return g&&this.doc.selection&&"Control"===this.doc.selection.type&&(f=this.doc.selection.createRange(),f&&f.length)?f.item(0):(h=this.getSelection(this.doc),h.focusNode===h.anchorNode?h.focusNode:(f=this.getRange(this.doc),f?f.commonAncestorContainer:this.doc.body))},fixSelBorders:function(){var f=this.getRange();b(f),this.setSelection(f)},getSelectedOwnNodes:function(){var h,i,f=this.getOwnRanges(),g=[];for(h=0,i=f.length;i>h;h++){g.push(f[h].commonAncestorContainer||this.doc.body)}return g},findNodesInSelection:function(h){var j,p,f,g=this.getOwnRanges(),i=[];for(p=0,f=g.length;f>p;p++){j=g[p].getNodes([1],function(l){return e.lang.array(h).contains(l.nodeName)}),i=i.concat(j)}return i},containsUneditable:function(){var h,i,f=this.getOwnUneditables(),g=this.getSelection();for(h=0,i=f.length;i>h;h++){if(g.containsNode(f[h])){return !0}}return !1},deleteContents:function(){var f,g=this.getOwnRanges();for(f=g.length;f--;){g[f].deleteContents()}this.setSelection(g[0])},getPreviousNode:function(h,j){var f,g,i;return h||(f=this.getSelection(),h=f.anchorNode),h===this.contain?!1:(g=h.previousSibling,g===this.contain?!1:(g&&3!==g.nodeType&&1!==g.nodeType?g=this.getPreviousNode(g,j):g&&3===g.nodeType&&/^\s*$/.test(g.textContent)?g=this.getPreviousNode(g,j):j&&g&&1===g.nodeType&&!e.lang.array(["BR","HR","IMG"]).contains(g.nodeName)&&/^[\s]*$/.test(g.innerHTML)?g=this.getPreviousNode(g,j):g||h===this.contain||(i=h.parentNode,i!==this.contain&&(g=this.getPreviousNode(i,j))),g!==this.contain?g:!1))},getSelectionParentsByTag:function(){var h,j,f,g=this.getSelectedOwnNodes(),i=[];for(j=0,f=g.length;f>j;j++){h=g[j].nodeName&&"LI"===g[j].nodeName?g[j]:e.dom.getParentElement(g[j],{nodeName:["LI"]},!1,this.contain),h&&i.push(h)}return i.length?i:null},getRangeToNodeEnd:function(){if(this.isCollapsed()){var h=this.getRange(),i=h.startContainer,f=h.startOffset,g=rangy.createRange(this.doc);return g.selectNodeContents(i),g.setStart(i,f),g}},caretIsLastInSelection:function(){var f=(rangy.createRange(this.doc),this.getSelection(),this.getRangeToNodeEnd().cloneContents()),g=f.textContent;return/^\s*$/.test(g)},caretIsFirstInSelection:function(){var h=rangy.createRange(this.doc),f=this.getSelection(),g=this.getRange(),i=g.startContainer;return i.nodeType===e.TEXT_NODE?this.isCollapsed()&&i.nodeType===e.TEXT_NODE&&/^\s*$/.test(i.data.substr(0,g.startOffset)):(h.selectNodeContents(this.getRange().commonAncestorContainer),h.collapse(!0),this.isCollapsed()&&(h.startContainer===f.anchorNode||h.endContainer===f.anchorNode)&&h.startOffset===f.anchorOffset)},caretIsInTheBeginnig:function(h){var f=this.getSelection(),g=f.anchorNode,i=f.anchorOffset;return h?0===i&&(g.nodeName&&g.nodeName===h.toUpperCase()||e.dom.getParentElement(g.parentNode,{nodeName:h},1)):0===i&&!this.getPreviousNode(g,!0)},caretIsBeforeUneditable:function(){var g,h,i,j,r=this.getSelection(),s=r.anchorNode,f=r.anchorOffset;if(0===f&&(g=this.getPreviousNode(s,!0),g)){for(h=this.getOwnUneditables(),i=0,j=h.length;j>i;i++){if(g===h[i]){return h[i]}}}return !1},executeAndRestoreRangy:function(h){var i=this.doc.defaultView||this.doc.parentWindow,f=rangy.saveSelection(i);if(f){try{h()}catch(g){setTimeout(function(){throw g},0)}}else{h()}rangy.restoreSelection(f)},executeAndRestore:function(f,g){var i,l,n,p,r,s,t,u,M,N=this.doc.body,h=g&&N.scrollTop,j=g&&N.scrollLeft,m="_wysihtml5-temp-placeholder",o='<span class="'+m+'">'+e.INVISIBLE_SPACE+"</span>",q=this.getRange(!0);if(!q){return f(N,N),void 0}q.collapsed||(t=q.cloneRange(),s=t.createContextualFragment(o),t.collapse(!1),t.insertNode(s),t.detach()),r=q.createContextualFragment(o),q.insertNode(r),s&&(i=this.contain.querySelectorAll("."+m),q.setStartBefore(i[0]),q.setEndAfter(i[i.length-1])),this.setSelection(q);try{f(q.startContainer,q.endContainer)}catch(O){setTimeout(function(){throw O},0)}if(i=this.contain.querySelectorAll("."+m),i&&i.length){for(u=rangy.createRange(this.doc),n=i[0].nextSibling,i.length>1&&(p=i[i.length-1].previousSibling),p&&n?(u.setStartBefore(n),u.setEndAfter(p)):(l=this.doc.createTextNode(e.INVISIBLE_SPACE),d.insert(l).after(i[0]),u.setStartBefore(l),u.setEndAfter(l)),this.setSelection(u),M=i.length;M--;){i[M].parentNode.removeChild(i[M])}}else{this.contain.focus()}g&&(N.scrollTop=h,N.scrollLeft=j);try{i.parentNode.removeChild(i)}catch(P){}},set:function(g,h){var f=rangy.createRange(this.doc);f.setStart(g,h||0),this.setSelection(f)},insertHTML:function(h){var i,f=(rangy.createRange(this.doc),this.doc.createElement("DIV")),g=this.doc.createDocumentFragment();for(f.innerHTML=h,i=f.lastChild;f.firstChild;){g.appendChild(f.firstChild)}this.insertNode(g),i&&this.setAfter(i)},insertNode:function(f){var g=this.getRange();g&&g.insertNode(f)},surround:function(g){var h,i,j=this.getOwnRanges(),q=[];if(0==j.length){return q}for(i=j.length;i--;){h=this.doc.createElement(g.nodeName),q.push(h),g.className&&(h.className=g.className),g.cssStyle&&h.setAttribute("style",g.cssStyle);try{j[i].surroundContents(h),this.selectNode(h)}catch(f){h.appendChild(j[i].extractContents()),j[i].insertNode(h)}}return q},deblockAndSurround:function(h){var j,p,f,g=this.doc.createElement("div"),i=rangy.createRange(this.doc);if(g.className=h.className,this.composer.commands.exec("formatBlock",h.nodeName,h.className),j=this.contain.querySelectorAll("."+h.className),j[0]){for(j[0].parentNode.insertBefore(g,j[0]),i.setStartBefore(j[0]),i.setEndAfter(j[j.length-1]),p=i.extractContents();p.firstChild;){if(f=p.firstChild,1==f.nodeType&&e.dom.hasClass(f,h.className)){for(;f.firstChild;){g.appendChild(f.firstChild)}"BR"!==f.nodeName&&g.appendChild(this.doc.createElement("br")),p.removeChild(f)}else{g.appendChild(f)}}}else{g=null}return g},scrollIntoView:function(){var g,i=this.doc,j=5,f=i.documentElement.scrollHeight>i.documentElement.offsetHeight,h=i._wysihtml5ScrollIntoViewElement=i._wysihtml5ScrollIntoViewElement||function(){var l=i.createElement("span");return l.innerHTML=e.INVISIBLE_SPACE,l}();f&&(this.insertNode(h),g=k(h),h.parentNode.removeChild(h),g>=i.body.scrollTop+i.documentElement.offsetHeight-j&&(i.body.scrollTop=g))},selectLine:function(){e.browser.supportsSelectionModify()?this._selectLine_W3C():this.doc.selection&&this._selectLine_MSIE()},_selectLine_W3C:function(){var f=this.doc.defaultView,g=f.getSelection();g.modify("move","left","lineboundary"),g.modify("extend","right","lineboundary")},_selectLine_MSIE:function(){var x,y,f,g,h,i=this.doc.selection.createRange(),j=i.boundingTop,u=this.doc.body.scrollWidth;if(i.moveToPoint){for(0===j&&(f=this.doc.createElement("span"),this.insertNode(f),j=f.offsetTop,f.parentNode.removeChild(f)),j+=1,g=-10;u>g;g+=2){try{i.moveToPoint(g,j);break}catch(v){}}for(x=j,y=this.doc.selection.createRange(),h=u;h>=0;h--){try{y.moveToPoint(h,x);break}catch(w){}}i.setEndPoint("EndToEnd",y),i.select()}},getText:function(){var f=this.getSelection();return f?""+f:""},getNodes:function(g,h){var f=this.getRange();return f?f.getNodes([g],h):[]},fixRangeOverflow:function(g){var h,f;this.contain&&this.contain.firstChild&&g&&(h=g.compareNode(this.contain),2!==h?(1===h&&g.setStartBefore(this.contain.firstChild),0===h&&g.setEndAfter(this.contain.lastChild),3===h&&(g.setStartBefore(this.contain.firstChild),g.setEndAfter(this.contain.lastChild))):this._detectInlineRangeProblems(g)&&(f=g.endContainer.previousElementSibling,f&&g.setEnd(f,this._endOffsetForNode(f))))},_endOffsetForNode:function(f){var g=document.createRange();return g.selectNodeContents(f),g.endOffset},_detectInlineRangeProblems:function(f){var g=d.compareDocumentPosition(f.startContainer,f.endContainer);return 0==f.endOffset&&4&g},getRange:function(g){var h=this.getSelection(),f=h&&h.rangeCount&&h.getRangeAt(0);return g!==!0&&this.fixRangeOverflow(f),f},getOwnUneditables:function(){var f=d.query(this.contain,"."+this.unselectableClass),g=d.query(f,"."+this.unselectableClass);return e.lang.array(f).without(g)},getOwnRanges:function(){var w,f,g,h,i,j,t,u=[],v=this.getRange();if(v&&u.push(v),this.unselectableClass&&this.contain&&v&&(f=this.getOwnUneditables(),f.length>0)){for(h=0,i=f.length;i>h;h++){for(w=[],j=0,t=u.length;t>j;j++){if(u[j]){switch(u[j].compareNode(f[h])){case 2:break;case 3:g=u[j].cloneRange(),g.setEndBefore(f[h]),w.push(g),g=u[j].cloneRange(),g.setStartAfter(f[h]),w.push(g);break;default:w.push(u[j])}}u=w}}}return u},getSelection:function(){return rangy.getSelection(this.doc.defaultView||this.doc.parentWindow)},setSelection:function(g){var h=this.doc.defaultView||this.doc.parentWindow,f=rangy.getSelection(h);return f.setSingleRange(g)},createRange:function(){return rangy.createRange(this.doc)},isCollapsed:function(){return this.getSelection().isCollapsed},getHtml:function(){return this.getSelection().toHtml()},isEndToEndInNode:function(h){var j=this.getRange(),f=j.commonAncestorContainer,g=j.startContainer,i=j.endContainer;if(f.nodeType===e.TEXT_NODE&&(f=f.parentNode),g.nodeType===e.TEXT_NODE&&!/^\s*$/.test(g.data.substr(j.startOffset))){return !1}if(i.nodeType===e.TEXT_NODE&&!/^\s*$/.test(i.data.substr(j.endOffset))){return !1}for(;g&&g!==f;){if(g.nodeType!==e.TEXT_NODE&&!e.dom.contains(f,g)){return !1}if(e.dom.domNode(g).prev({ignoreBlankTexts:!0})){return !1}g=g.parentNode}for(;i&&i!==f;){if(i.nodeType!==e.TEXT_NODE&&!e.dom.contains(f,i)){return !1}if(e.dom.domNode(i).next({ignoreBlankTexts:!0})){return !1}i=i.parentNode}return e.lang.array(h).contains(f.nodeName)?f:!1},deselect:function(){var f=this.getSelection();f&&f.removeAllRanges()}})}(wysihtml5),function(a,b){function d(x,y,v){if(!x.className){return !1}var w=x.className.match(v)||[];return w[w.length-1]===y}function e(v,w){if(!v.getAttribute||!v.getAttribute("style")){return !1}v.getAttribute("style").match(w);return v.getAttribute("style").match(w)?!0:!1}function f(w,x,v){w.getAttribute("style")?(l(w,v),w.getAttribute("style")&&!/^\s*$/.test(w.getAttribute("style"))?w.setAttribute("style",x+";"+w.getAttribute("style")):w.setAttribute("style",x)):w.setAttribute("style",x)}function g(w,x,v){w.className?(j(w,v),w.className+=" "+x):w.className=x}function j(v,w){v.className&&(v.className=v.className.replace(w,""))}function l(y,z){var v,w,x=[];if(y.getAttribute("style")){for(v=y.getAttribute("style").split(";"),w=v.length;w--;){v[w].match(z)||/^\s*$/.test(v[w])||x.push(v[w])}x.length?y.setAttribute("style",x.join(";")):y.removeAttribute("style")}}function n(y,z){var A,B,C,v=[],w=z.split(";"),x=y.getAttribute("style");if(x){for(x=x.replace(/\s/gi,"").toLowerCase(),v.push(RegExp("(^|\\s|;)"+z.replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi")),A=w.length;A-->0;){/^\s*$/.test(w[A])||v.push(RegExp("(^|\\s|;)"+w[A].replace(/\s/gi,"").replace(/([\(\)])/gi,"\\$1").toLowerCase().replace(";",";?").replace(/rgb\\\((\d+),(\d+),(\d+)\\\)/gi,"\\s?rgb\\($1,\\s?$2,\\s?$3\\)"),"gi"))}for(B=0,C=v.length;C>B;B++){if(x.match(v[B])){return v[B]}}}return !1}function p(x,y,v,w){return v?n(x,v):w?a.dom.hasClass(x,w):b.dom.arrayContains(y,x.tagName.toLowerCase())}function q(y,z,v,w){for(var x=y.length;x--;){if(!p(y[x],z,v,w)){return !1}}return y.length?!0:!1}function r(x,y,v){var w=n(x,y);return w?(l(x,w),"remove"):(f(x,y,v),"change")}function s(v,w){return v.className.replace(o," ")==w.className.replace(o," ")}function t(v){for(var w=v.parentNode;v.firstChild;){w.insertBefore(v.firstChild,v)}w.removeChild(v)}function u(z,A){if(z.attributes.length!=A.attributes.length){return !1}for(var B,v,w,x=0,y=z.attributes.length;y>x;++x){if(B=z.attributes[x],w=B.name,"class"!=w){if(v=A.attributes.getNamedItem(w),B.specified!=v.specified){return !1}if(B.specified&&B.nodeValue!==v.nodeValue){return !1}}}return !0}function Q(v,w){return b.dom.isCharacterDataNode(v)?0==w?!!v.previousSibling:w==v.length?!!v.nextSibling:!0:w>0&&w<v.childNodes.length}function h(v,w,x,y){var z,A;if(b.dom.isCharacterDataNode(w)&&(0==x?(x=b.dom.getNodeIndex(w),w=w.parentNode):x==w.length?(x=b.dom.getNodeIndex(w)+1,w=w.parentNode):z=b.dom.splitDataNode(w,x)),!(z||y&&w===y)){for(z=w.cloneNode(!1),z.id&&z.removeAttribute("id");A=w.childNodes[x];){z.appendChild(A)}b.dom.insertAfter(z,w)}return w==v?z:h(v,z.parentNode,b.dom.getNodeIndex(z),y)}function i(v){this.isElementMerge=v.nodeType==a.ELEMENT_NODE,this.firstTextNode=this.isElementMerge?v.lastChild:v,this.textNodes=[this.firstTextNode]}function k(z,A,B,v,w,x,y){this.tagNames=z||[m],this.cssClass=A||(A===!1?!1:""),this.similarClassRegExp=B,this.cssStyle=w||"",this.similarStyleRegExp=x,this.normalize=v,this.applyToAnyTagName=!1,this.container=y}var m="span",o=/\s+/g;i.prototype={doMerge:function(){var z,A,v,w,x,y=[];for(w=0,x=this.textNodes.length;x>w;++w){z=this.textNodes[w],A=z.parentNode,y[w]=z.data,w&&(A.removeChild(z),A.hasChildNodes()||A.parentNode.removeChild(A))}return this.firstTextNode.data=v=y.join(""),v},getLength:function(){for(var v=this.textNodes.length,w=0;v--;){w+=this.textNodes[v].length}return w},toString:function(){var w,x,v=[];for(w=0,x=this.textNodes.length;x>w;++w){v[w]="'"+this.textNodes[w].data+"'"}return"[Merge("+v.join(",")+")]"}},k.prototype={getAncestorWithClass:function(v){for(var w;v;){if(w=this.cssClass?d(v,this.cssClass,this.similarClassRegExp):""!==this.cssStyle?!1:!0,v.nodeType==a.ELEMENT_NODE&&"false"!=v.getAttribute("contenteditable")&&b.dom.arrayContains(this.tagNames,v.tagName.toLowerCase())&&w){return v}v=v.parentNode}return !1},getAncestorWithStyle:function(v){for(var w;v;){if(w=this.cssStyle?e(v,this.similarStyleRegExp):!1,v.nodeType==a.ELEMENT_NODE&&"false"!=v.getAttribute("contenteditable")&&b.dom.arrayContains(this.tagNames,v.tagName.toLowerCase())&&w){return v}v=v.parentNode}return !1},getMatchingAncestor:function(w){var x=this.getAncestorWithClass(w),v=!1;return x?this.cssStyle&&(v="class"):(x=this.getAncestorWithStyle(w),x&&(v="style")),{element:x,type:v}},postApply:function(y,z){var A,B,C,D,E,F,G=y[0],H=y[y.length-1],I=[],J=G,v=H,w=0,x=H.length;for(D=0,E=y.length;E>D;++D){B=y[D],C=null,B&&B.parentNode&&(C=this.getAdjacentMergeableTextNode(B.parentNode,!1)),C?(A||(A=new i(C),I.push(A)),A.textNodes.push(B),B===G&&(J=A.firstTextNode,w=J.length),B===H&&(v=A.firstTextNode,x=A.getLength())):A=null}if(H&&H.parentNode&&(F=this.getAdjacentMergeableTextNode(H.parentNode,!0),F&&(A||(A=new i(H),I.push(A)),A.textNodes.push(F))),I.length){for(D=0,E=I.length;E>D;++D){I[D].doMerge()}z.setStart(J,w),z.setEnd(v,x)}},getAdjacentMergeableTextNode:function(w,v){var x,y=w.nodeType==a.TEXT_NODE,z=y?w.parentNode:w,A=v?"nextSibling":"previousSibling";if(y){if(x=w[A],x&&x.nodeType==a.TEXT_NODE){return x}}else{if(x=z[A],x&&this.areElementsMergeable(w,x)){return x[v?"firstChild":"lastChild"]}}return null},areElementsMergeable:function(v,w){return b.dom.arrayContains(this.tagNames,(v.tagName||"").toLowerCase())&&b.dom.arrayContains(this.tagNames,(w.tagName||"").toLowerCase())&&s(v,w)&&u(v,w)},createContainer:function(v){var w=v.createElement(this.tagNames[0]);return this.cssClass&&(w.className=this.cssClass),this.cssStyle&&w.setAttribute("style",this.cssStyle),w},applyToTextNode:function(v){var w,x=v.parentNode;1==x.childNodes.length&&b.dom.arrayContains(this.tagNames,x.tagName.toLowerCase())?(this.cssClass&&g(x,this.cssClass,this.similarClassRegExp),this.cssStyle&&f(x,this.cssStyle,this.similarStyleRegExp)):(w=this.createContainer(b.dom.getDocument(v)),v.parentNode.insertBefore(w,v),w.appendChild(v))},isRemovable:function(v){return b.dom.arrayContains(this.tagNames,v.tagName.toLowerCase())&&""===a.lang.string(v.className).trim()&&(!v.getAttribute("style")||""===a.lang.string(v.getAttribute("style")).trim())},undoToTextNode:function(y,z,A,B){var C,v=A?!1:!0,w=A||B,x=!1;z.containsNode(w)||(C=z.cloneRange(),C.selectNode(w),C.isPointInRange(z.endContainer,z.endOffset)&&Q(z.endContainer,z.endOffset)&&(h(w,z.endContainer,z.endOffset,this.container),z.setEndAfter(w)),C.isPointInRange(z.startContainer,z.startOffset)&&Q(z.startContainer,z.startOffset)&&(w=h(w,z.startContainer,z.startOffset,this.container))),!v&&this.similarClassRegExp&&j(w,this.similarClassRegExp),v&&this.similarStyleRegExp&&(x="change"===r(w,this.cssStyle,this.similarStyleRegExp)),this.isRemovable(w)&&!x&&t(w)},applyToRange:function(x){var A,B,C,v,w,y;for(B=x.length;B--;){if(A=x[B].getNodes([a.TEXT_NODE]),!A.length){try{return C=this.createContainer(x[B].endContainer.ownerDocument),x[B].surroundContents(C),this.selectNode(x[B],C),void 0}catch(z){}}if(x[B].splitBoundaries(),A=x[B].getNodes([a.TEXT_NODE]),A.length){for(w=0,y=A.length;y>w;++w){v=A[w],this.getMatchingAncestor(v).element||this.applyToTextNode(v)}x[B].setStart(A[0],0),v=A[A.length-1],x[B].setEnd(v,v.length),this.normalize&&this.postApply(A,x[B])}}},undoToRange:function(v){var w,x,y,z,A,B,C,D;for(z=v.length;z--;){for(w=v[z].getNodes([a.TEXT_NODE]),w.length?(v[z].splitBoundaries(),w=v[z].getNodes([a.TEXT_NODE])):(A=v[z].endContainer.ownerDocument,B=A.createTextNode(a.INVISIBLE_SPACE),v[z].insertNode(B),v[z].selectNode(B),w=[B]),C=0,D=w.length;D>C;++C){v[z].isValid()&&(x=w[C],y=this.getMatchingAncestor(x),"style"===y.type?this.undoToTextNode(x,v[z],!1,y.element):y.element&&this.undoToTextNode(x,v[z],y.element))}1==D?this.selectNode(v[z],w[0]):(v[z].setStart(w[0],0),x=w[w.length-1],v[z].setEnd(x,x.length),this.normalize&&this.postApply(w,v[z]))}},selectNode:function(x,B){var v=B.nodeType===a.ELEMENT_NODE,w="canHaveHTML" in B?B.canHaveHTML:!0,y=v?B.innerHTML:B.data,z=""===y||y===a.INVISIBLE_SPACE;if(z&&v&&w){try{B.innerHTML=a.INVISIBLE_SPACE}catch(A){}}x.selectNodeContents(B),z&&v?x.collapse(!1):z&&(x.setStartAfter(B),x.setEndAfter(B))},getTextSelectedByRange:function(y,z){var v,w,x=z.cloneRange();return x.selectNodeContents(y),v=x.intersection(z),w=v?""+v:"",x.detach(),w},isAppliedToRange:function(v){var w,x,y,z,A,B,C=[],D="full";for(y=v.length;y--;){if(x=v[y].getNodes([a.TEXT_NODE]),!x.length){return w=this.getMatchingAncestor(v[y].startContainer).element,w?{elements:[w],coverage:D}:!1}for(z=0,A=x.length;A>z;++z){B=this.getTextSelectedByRange(x[z],v[y]),w=this.getMatchingAncestor(x[z]).element,w&&""!=B?(C.push(w),1===a.dom.getTextNodes(w,!0).length?D="full":"full"===D&&(D="inline")):w||(D="partial")}}return C.length?{elements:C,coverage:D}:!1},toggleRange:function(w){var x,v=this.isAppliedToRange(w);v?"full"===v.coverage?this.undoToRange(w):"inline"===v.coverage?(x=q(v.elements,this.tagNames,this.cssStyle,this.cssClass),this.undoToRange(w),x||this.applyToRange(w)):(q(v.elements,this.tagNames,this.cssStyle,this.cssClass)||this.undoToRange(w),this.applyToRange(w)):this.applyToRange(w)}},a.selection.HTMLApplier=k}(wysihtml5,rangy),wysihtml5.Commands=Base.extend({constructor:function(a){this.editor=a,this.composer=a.composer,this.doc=this.composer.doc},support:function(a){return wysihtml5.browser.supportsCommand(this.doc,a)},exec:function(f,g){var o=wysihtml5.commands[f],a=wysihtml5.lang.array(arguments).get(),b=o&&o.exec,d=null;if(this.editor.fire("beforecommand:composer"),b){a.unshift(this.composer),d=b.apply(o,a)}else{try{d=this.doc.execCommand(f,!1,g)}catch(e){}}return this.editor.fire("aftercommand:composer"),d},state:function(e){var k=wysihtml5.commands[e],a=wysihtml5.lang.array(arguments).get(),b=k&&k.state;if(b){return a.unshift(this.composer),b.apply(k,a)}try{return this.doc.queryCommandState(e)}catch(d){return !1}},stateValue:function(d){var i=wysihtml5.commands[d],a=wysihtml5.lang.array(arguments).get(),b=i&&i.stateValue;return b?(a.unshift(this.composer),b.apply(i,a)):!1}}),wysihtml5.commands.bold={exec:function(a,b){wysihtml5.commands.formatInline.execWithToggle(a,b,"b")},state:function(a,b){return wysihtml5.commands.formatInline.state(a,b,"b")}},function(f){function m(h,i){var j,o,p,r,s,E,F,G,k,l=h.doc,n="_wysihtml5-temp-"+ +new Date,q=/non-matching-class/g,g=0;for(f.commands.formatInline.exec(h,b,d,n,q,b,b,!0,!0),o=l.querySelectorAll(d+"."+n),j=o.length;j>g;g++){p=o[g],p.removeAttribute("class");for(k in i){"text"!==k&&p.setAttribute(k,i[k])}}E=p,1===j&&(F=e.getTextContent(p),r=!!p.querySelector("*"),s=""===F||F===f.INVISIBLE_SPACE,!r&&s&&(e.setTextContent(p,i.text||p.href),G=l.createTextNode(" "),h.selection.setAfter(p),e.insert(G).after(p),E=G)),h.selection.setAfter(E)}function a(t,g,h){var i,j,k,l;for(j=g.length;j--;){for(i=g[j].attributes,k=i.length;k--;){g[j].removeAttribute(i.item(k).name)}for(l in h){h.hasOwnProperty(l)&&g[j].setAttribute(l,h[l])}}}var b,d="A",e=f.dom;f.commands.createLink={exec:function(h,i,j){var g=this.state(h,i);g?h.selection.executeAndRestore(function(){a(h,g,j)}):(j="object"==typeof j?j:{href:j},m(h,j))},state:function(g,h){return f.commands.formatInline.state(g,h,"A")}}}(wysihtml5),function(b){function g(h,p){for(var q,r,d,e=p.length,f=0;e>f;f++){q=p[f],r=a.getParentElement(q,{nodeName:"code"}),d=a.getTextContent(q),d.match(a.autoLink.URL_REG_EXP)&&!r?r=a.renameElement(q,"code"):a.replaceWithChildNodes(q)}}var a=b.dom;b.commands.removeLink={exec:function(d,e){var f=this.state(d,e);f&&d.selection.executeAndRestore(function(){g(d,f)})},state:function(d,e){return b.commands.formatInline.state(d,e,"A")}}}(wysihtml5),function(a){var b=/wysiwyg-font-size-[0-9a-z\-]+/g;a.commands.fontSize={exec:function(g,d,e){a.commands.formatInline.execWithToggle(g,d,"span","wysiwyg-font-size-"+e,b)},state:function(g,d,e){return a.commands.formatInline.state(g,d,"span","wysiwyg-font-size-"+e,b)}}}(wysihtml5),function(a){var b=/(\s|^)font-size\s*:\s*[^;\s]+;?/gi;a.commands.fontSizeStyle={exec:function(g,d,e){e="object"==typeof e?e.size:e,/^\s*$/.test(e)||a.commands.formatInline.execWithToggle(g,d,"span",!1,!1,"font-size:"+e,b)},state:function(d,e){return a.commands.formatInline.state(d,e,"span",!1,!1,"font-size",b)},stateValue:function(d,e){var i,j=this.state(d,e);return j&&a.lang.object(j).isArray()&&(j=j[0]),j&&(i=j.getAttribute("style"),i)?a.quirks.styleParser.parseFontSize(i):!1}}}(wysihtml5),function(a){var b=/wysiwyg-color-[0-9a-z]+/g;a.commands.foreColor={exec:function(g,d,e){a.commands.formatInline.execWithToggle(g,d,"span","wysiwyg-color-"+e,b)},state:function(g,d,e){return a.commands.formatInline.state(g,d,"span","wysiwyg-color-"+e,b)}}}(wysihtml5),function(a){var b=/(\s|^)color\s*:\s*[^;\s]+;?/gi;a.commands.foreColorStyle={exec:function(f,g,k){var d,e=a.quirks.styleParser.parseColor("object"==typeof k?"color:"+k.color:"color:"+k,"color");e&&(d="color: rgb("+e[0]+","+e[1]+","+e[2]+");",1!==e[3]&&(d+="color: rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+");"),a.commands.formatInline.execWithToggle(f,g,"span",!1,!1,d,b))},state:function(d,e){return a.commands.formatInline.state(d,e,"span",!1,!1,"color",b)},stateValue:function(d,e,f){var k,l=this.state(d,e);return l&&a.lang.object(l).isArray()&&(l=l[0]),l&&(k=l.getAttribute("style"),k&&k)?(val=a.quirks.styleParser.parseColor(k,"color"),a.quirks.styleParser.unparseColor(val,f)):!1}}}(wysihtml5),function(a){var b=/(\s|^)background-color\s*:\s*[^;\s]+;?/gi;a.commands.bgColorStyle={exec:function(f,g,k){var d,e=a.quirks.styleParser.parseColor("object"==typeof k?"background-color:"+k.color:"background-color:"+k,"background-color");e&&(d="background-color: rgb("+e[0]+","+e[1]+","+e[2]+");",1!==e[3]&&(d+="background-color: rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]+");"),a.commands.formatInline.execWithToggle(f,g,"span",!1,!1,d,b))},state:function(d,e){return a.commands.formatInline.state(d,e,"span",!1,!1,"background-color",b)},stateValue:function(e,d,f){var g,m=this.state(e,d),n=!1;return m&&a.lang.object(m).isArray()&&(m=m[0]),m&&(g=m.getAttribute("style"),g)?(n=a.quirks.styleParser.parseColor(g,"background-color"),a.quirks.styleParser.unparseColor(n,f)):!1}}}(wysihtml5),function(h){function i(m,n,o){m.className?(k(m,o),m.className=h.lang.string(m.className+" "+n).trim()):m.className=n}function j(m,n,o){l(m,o),m.getAttribute("style")?m.setAttribute("style",h.lang.string(m.getAttribute("style")+" "+n).trim()):m.setAttribute("style",n)}function k(m,n){var o=n.test(m.className);return m.className=m.className.replace(n,""),""==h.lang.string(m.className).trim()&&m.removeAttribute("class"),o}function l(m,n){var o=n.test(m.getAttribute("style"));return m.setAttribute("style",(m.getAttribute("style")||"").replace(n,"")),""==h.lang.string(m.getAttribute("style")||"").trim()&&m.removeAttribute("style"),o}function y(m){var n=m.lastChild;n&&a(n)&&n.parentNode.removeChild(n)}function a(m){return"BR"===m.nodeName}function b(m,n){var o,p,q;for(m.selection.isCollapsed()&&m.selection.selectLine(),o=m.selection.surround(n),p=0,q=o.length;q>p;p++){h.dom.lineBreaks(o[p]).remove(),y(o[p])}}function d(m){return !!h.lang.string(m.className).trim()}function e(m){return !!h.lang.string(m.getAttribute("style")||"").trim()}var f=h.dom,g=["H1","H2","H3","H4","H5","H6","P","PRE","DIV"];h.commands.formatBlock={exec:function(r,s,t,u,v,w,F){var G,H,m,n,o,p=(r.doc,this.state(r,s,t,u,v,w,F)),x=r.config.useLineBreaks,q=x?"DIV":"P";return t="string"==typeof t?t.toUpperCase():t,p.length?(r.selection.executeAndRestoreRangy(function(){var A,z,B;for(A=p.length;A--;){if(v&&(H=k(p[A],v)),F&&(n=l(p[A],F)),(n||H)&&null===t&&p[A].nodeName!=q){return}z=d(p[A]),B=e(p[A]),z||B||!x&&"P"!==t?f.renameElement(p[A],"P"===t?"DIV":q):(h.dom.lineBreaks(p[A]).add(),f.replaceWithChildNodes(p[A]))}}),void 0):((null!==t&&!h.lang.array(g).contains(t)||(G=r.selection.findNodesInSelection(g).concat(r.selection.getSelectedOwnNodes()),r.selection.executeAndRestoreRangy(function(){for(var z=G.length;z--;){o=f.getParentElement(G[z],{nodeName:g}),o==r.element&&(o=null),o&&(t&&(o=f.renameElement(o,t)),u&&i(o,u,v),w&&j(o,w,F),m=!0)}}),!m))&&b(r,{nodeName:t||q,className:u||null,cssStyle:w||null}),void 0)},state:function(u,v,w,x,m,n,o){var p,r,s,q=u.selection.getSelectedOwnNodes(),t=[];for(w="string"==typeof w?w.toUpperCase():w,r=0,s=q.length;s>r;r++){p=f.getParentElement(q[r],{nodeName:w,className:x,classRegExp:m,cssStyle:n,styleRegExp:o}),p&&-1==h.lang.array(t).indexOf(p)&&t.push(p)}return 0==t.length?!1:t}}}(wysihtml5),wysihtml5.commands.formatCode={exec:function(f,g,o){var a,b,d,e=this.state(f);e?f.selection.executeAndRestore(function(){a=e.querySelector("code"),wysihtml5.dom.replaceWithChildNodes(e),a&&wysihtml5.dom.replaceWithChildNodes(a)}):(b=f.selection.getRange(),d=b.extractContents(),e=f.doc.createElement("pre"),a=f.doc.createElement("code"),o&&(a.className=o),e.appendChild(a),a.appendChild(d),b.insertNode(e),f.selection.selectNode(e))},state:function(a){var b=a.selection.getSelectedNode();return b&&b.nodeName&&"PRE"==b.nodeName&&b.firstChild&&b.firstChild.nodeName&&"CODE"==b.firstChild.nodeName?b:wysihtml5.dom.getParentElement(b,{nodeName:"CODE"})&&wysihtml5.dom.getParentElement(b,{nodeName:"PRE"})}},function(e){function k(f){var g=b[f];return g?[f.toLowerCase(),g.toLowerCase()]:[f.toLowerCase()]}function a(p,g,i,j,o,f){var h=p;return g&&(h+=":"+g),j&&(h+=":"+j),d[h]||(d[h]=new e.selection.HTMLApplier(k(p),g,i,!0,j,o,f)),d[h]}var b={strong:"b",em:"i",b:"strong",i:"em"},d={};e.commands.formatInline={exec:function(x,y,z,A,B,f,g,h,i){var j=x.selection.createRange(),l=x.selection.getOwnRanges();return l&&0!=l.length?(x.selection.getSelection().removeAllRanges(),a(z,A,B,f,g,x.element).toggleRange(l),h?i||x.cleanUp():(j.setStart(l[0].startContainer,l[0].startOffset),j.setEnd(l[l.length-1].endContainer,l[l.length-1].endOffset),x.selection.setSelection(j),x.selection.executeAndRestore(function(){i||x.cleanUp()},!0,!0)),void 0):!1},execWithToggle:function(f,g,h,i,j,s,t){var u,v=this;this.state(f,g,h,i,j,s,t)&&f.selection.isCollapsed()&&!f.selection.caretIsLastInSelection()&&!f.selection.caretIsFirstInSelection()?(u=v.state(f,g,h,i,j)[0],f.selection.executeAndRestoreRangy(function(){u.parentNode;f.selection.selectNode(u,!0),e.commands.formatInline.exec(f,g,h,i,j,s,t,!0,!0)})):this.state(f,g,h,i,j,s,t)&&!f.selection.isCollapsed()?f.selection.executeAndRestoreRangy(function(){e.commands.formatInline.exec(f,g,h,i,j,s,t,!0,!0)}):e.commands.formatInline.exec(f,g,h,i,j,s,t)},state:function(m,n,x,y,z,f,g){var h,i,j=m.doc,l=b[x]||x;return e.dom.hasElementWithTagName(j,x)||e.dom.hasElementWithTagName(j,l)?y&&!e.dom.hasElementWithClassName(j,y)?!1:(h=m.selection.getOwnRanges(),h&&0!==h.length?(i=a(x,y,z,f,g,m.element).isAppliedToRange(h),i&&i.elements?i.elements:!1):!1):!1}}}(wysihtml5),function(a){a.commands.insertBlockQuote={exec:function(b,d){var e=this.state(b,d),i=b.selection.isEndToEndInNode(["H1","H2","H3","H4","H5","H6","P"]);b.selection.executeAndRestore(function(){if(e){b.config.useLineBreaks&&a.dom.lineBreaks(e).add(),a.dom.unwrap(e)}else{if(b.selection.isCollapsed()&&b.selection.selectLine(),i){var f=i.ownerDocument.createElement("blockquote");a.dom.insert(f).after(i),f.appendChild(i)}else{b.selection.surround({nodeName:"blockquote"})}}})},state:function(b){var d=b.selection.getSelectedNode(),g=a.dom.getParentElement(d,{nodeName:"BLOCKQUOTE"},!1,b.element);return g?g:!1}}}(wysihtml5),wysihtml5.commands.insertHTML={exec:function(b,g,a){b.commands.support(g)?b.doc.execCommand(g,!1,a):b.selection.insertHTML(a)},state:function(){return !1}},function(a){var b="IMG";a.commands.insertImage={exec:function(i,j,q){var e,g,h,d,f;if(q="object"==typeof q?q:{src:q},e=i.doc,g=this.state(i),g){return i.selection.setBefore(g),d=g.parentNode,d.removeChild(g),a.dom.removeEmptyTextNodes(d),"A"!==d.nodeName||d.firstChild||(i.selection.setAfter(d),d.parentNode.removeChild(d)),a.quirks.redraw(i.element),void 0}g=e.createElement(b);for(f in q){g.setAttribute("className"===f?"class":f,q[f])}i.selection.insertNode(g),a.browser.hasProblemsSettingCaretAfterImg()?(h=e.createTextNode(a.INVISIBLE_SPACE),i.selection.insertNode(h),i.selection.setAfter(h)):i.selection.setAfter(g)},state:function(f){var g,k,d,e=f.doc;return a.dom.hasElementWithTagName(e,b)?(g=f.selection.getSelectedNode(),g?g.nodeName===b?g:g.nodeType!==a.ELEMENT_NODE?!1:(k=f.selection.getText(),k=a.lang.string(k).trim(),k?!1:(d=f.selection.getNodes(a.ELEMENT_NODE,function(h){return"IMG"===h.nodeName}),1!==d.length?!1:d[0])):!1):!1}}}(wysihtml5),function(a){var b="<br>"+(a.browser.needsSpaceAfterLineBreak()?" ":"");a.commands.insertLineBreak={exec:function(d,e){d.commands.support(e)?(d.doc.execCommand(e,!1,null),a.browser.autoScrollsToCaret()||d.selection.scrollIntoView()):d.commands.exec("insertHTML",b)},state:function(){return !1}}}(wysihtml5),wysihtml5.commands.insertOrderedList={exec:function(a,b){wysihtml5.commands.insertList.exec(a,b,"OL")},state:function(a,b){return wysihtml5.commands.insertList.state(a,b,"OL")}},wysihtml5.commands.insertUnorderedList={exec:function(a,b){wysihtml5.commands.insertList.exec(a,b,"UL")},state:function(a,b){return wysihtml5.commands.insertList.state(a,b,"UL")}},wysihtml5.commands.insertList=function(f){var g=function(i,j){if(i&&i.nodeName){"string"==typeof j&&(j=[j]);for(var h=j.length;h--;){if(i.nodeName===j[h]){return !0}}}return !1},o=function(j,k,l){var m,h,i={el:null,other:!1};return j&&(m=f.dom.getParentElement(j,{nodeName:"LI"}),h="UL"===k?"OL":"UL",g(j,k)?i.el=j:g(j,h)?i={el:j,other:!0}:m&&(g(m.parentNode,k)?i.el=m.parentNode:g(m.parentNode,h)&&(i={el:m.parentNode,other:!0}))),i.el&&!l.element.contains(i.el)&&(i.el=null),i},a=function(h,j,k){var l,i="UL"===j?"OL":"UL";k.selection.executeAndRestore(function(){var n,p,m=d(i,k);if(m.length){for(n=m.length;n--;){f.dom.renameElement(m[n],j.toLowerCase())}}else{for(l=d(["OL","UL"],k),p=l.length;p--;){f.dom.resolveList(l[p],k.config.useLineBreaks)}f.dom.resolveList(h,k.config.useLineBreaks)}})},b=function(h,k,i){var j="UL"===k?"OL":"UL";i.selection.executeAndRestore(function(){var m,l=[h].concat(d(j,i));for(m=l.length;m--;){f.dom.renameElement(l[m],k.toLowerCase())}})},d=function(h,j){var k,l=j.selection.getOwnRanges(),i=[];for(k=l.length;k--;){i=i.concat(l[k].getNodes([1],function(m){return g(m,h)}))}return i},e=function(h,i){i.selection.executeAndRestoreRangy(function(){var k,l,m="_wysihtml5-temp-"+(new Date).getTime(),n=i.selection.deblockAndSurround({nodeName:"div",className:m}),j=/\uFEFF/g;n.innerHTML=n.innerHTML.replace(j,""),n&&(k=f.lang.array(["","<br>",f.INVISIBLE_SPACE]).contains(n.innerHTML),l=f.dom.convertToList(n,h.toLowerCase(),i.parent.config.uneditableContainerClassname),k&&i.selection.selectNode(l.querySelector("li"),!0))})};return{exec:function(l,n,i){var j=l.doc,k="OL"===i?"insertOrderedList":"insertUnorderedList",m=l.selection.getSelectedNode(),h=o(m,i,l);h.el?h.other?b(h.el,i,l):a(h.el,i,l):l.commands.support(k)?j.execCommand(k,!1,null):e(i,l)},state:function(l,i,h){var j=l.selection.getSelectedNode(),k=o(j,h,l);return k.el&&!k.other?k.el:!1}}}(wysihtml5),wysihtml5.commands.italic={exec:function(a,b){wysihtml5.commands.formatInline.execWithToggle(a,b,"i")},state:function(a,b){return wysihtml5.commands.formatInline.state(a,b,"i")}},function(b){var g="wysiwyg-text-align-center",a=/wysiwyg-text-align-[0-9a-z]+/g;b.commands.justifyCenter={exec:function(d){return b.commands.formatBlock.exec(d,"formatBlock",null,g,a)},state:function(d){return b.commands.formatBlock.state(d,"formatBlock",null,g,a)}}}(wysihtml5),function(b){var g="wysiwyg-text-align-left",a=/wysiwyg-text-align-[0-9a-z]+/g;b.commands.justifyLeft={exec:function(d){return b.commands.formatBlock.exec(d,"formatBlock",null,g,a)},state:function(d){return b.commands.formatBlock.state(d,"formatBlock",null,g,a)}}}(wysihtml5),function(b){var g="wysiwyg-text-align-right",a=/wysiwyg-text-align-[0-9a-z]+/g;b.commands.justifyRight={exec:function(d){return b.commands.formatBlock.exec(d,"formatBlock",null,g,a)},state:function(d){return b.commands.formatBlock.state(d,"formatBlock",null,g,a)}}}(wysihtml5),function(b){var g="wysiwyg-text-align-justify",a=/wysiwyg-text-align-[0-9a-z]+/g;b.commands.justifyFull={exec:function(d){return b.commands.formatBlock.exec(d,"formatBlock",null,g,a)},state:function(d){return b.commands.formatBlock.state(d,"formatBlock",null,g,a)}}}(wysihtml5),function(b){var g="text-align: right;",a=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;b.commands.alignRightStyle={exec:function(d){return b.commands.formatBlock.exec(d,"formatBlock",null,null,null,g,a)},state:function(d){return b.commands.formatBlock.state(d,"formatBlock",null,null,null,g,a)}}}(wysihtml5),function(b){var g="text-align: left;",a=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;b.commands.alignLeftStyle={exec:function(d){return b.commands.formatBlock.exec(d,"formatBlock",null,null,null,g,a)},state:function(d){return b.commands.formatBlock.state(d,"formatBlock",null,null,null,g,a)}}}(wysihtml5),function(b){var g="text-align: center;",a=/(\s|^)text-align\s*:\s*[^;\s]+;?/gi;b.commands.alignCenterStyle={exec:function(d){return b.commands.formatBlock.exec(d,"formatBlock",null,null,null,g,a)},state:function(d){return b.commands.formatBlock.state(d,"formatBlock",null,null,null,g,a)}}}(wysihtml5),wysihtml5.commands.redo={exec:function(a){return a.undoManager.redo()},state:function(){return !1}},wysihtml5.commands.underline={exec:function(a,b){wysihtml5.commands.formatInline.execWithToggle(a,b,"u")},state:function(a,b){return wysihtml5.commands.formatInline.state(a,b,"u")}},wysihtml5.commands.undo={exec:function(a){return a.undoManager.undo()},state:function(){return !1}},wysihtml5.commands.createTable={exec:function(f,m,a){var b,d,e;if(a&&a.cols&&a.rows&&parseInt(a.cols,10)>0&&parseInt(a.rows,10)>0){for(e=a.tableStyle?'<table style="'+a.tableStyle+'">':"<table>",e+="<tbody>",d=0;d<a.rows;d++){for(e+="<tr>",b=0;b<a.cols;b++){e+="<td>&nbsp;</td>"}e+="</tr>"}e+="</tbody></table>",f.commands.exec("insertHTML",e)}},state:function(){return !1}},wysihtml5.commands.mergeTableCells={exec:function(a,b){a.tableSelection&&a.tableSelection.start&&a.tableSelection.end&&(this.state(a,b)?wysihtml5.dom.table.unmergeCell(a.tableSelection.start):wysihtml5.dom.table.mergeCellsBetween(a.tableSelection.start,a.tableSelection.end))},state:function(b){if(b.tableSelection){var g=b.tableSelection.start,a=b.tableSelection.end;if(g&&a&&g==a&&(wysihtml5.dom.getAttribute(g,"colspan")&&parseInt(wysihtml5.dom.getAttribute(g,"colspan"),10)>1||wysihtml5.dom.getAttribute(g,"rowspan")&&parseInt(wysihtml5.dom.getAttribute(g,"rowspan"),10)>1)){return[g]}}return !1}},wysihtml5.commands.addTableCells={exec:function(d,i,a){if(d.tableSelection&&d.tableSelection.start&&d.tableSelection.end){var b=wysihtml5.dom.table.orderSelectionEnds(d.tableSelection.start,d.tableSelection.end);"before"==a||"above"==a?wysihtml5.dom.table.addCells(b.start,a):("after"==a||"below"==a)&&wysihtml5.dom.table.addCells(b.end,a),setTimeout(function(){d.tableSelection.select(b.start,b.end)},0)}},state:function(){return !1}},wysihtml5.commands.deleteTableCells={exec:function(f,g,o){if(f.tableSelection&&f.tableSelection.start&&f.tableSelection.end){var a,b=wysihtml5.dom.table.orderSelectionEnds(f.tableSelection.start,f.tableSelection.end),d=wysihtml5.dom.table.indexOf(b.start),e=f.tableSelection.table;wysihtml5.dom.table.removeCells(b.start,o),setTimeout(function(){a=wysihtml5.dom.table.findCell(e,d),a||("row"==o&&(a=wysihtml5.dom.table.findCell(e,{row:d.row-1,col:d.col})),"column"==o&&(a=wysihtml5.dom.table.findCell(e,{row:d.row,col:d.col-1}))),a&&f.tableSelection.select(a,a)},0)}},state:function(){return !1}},wysihtml5.commands.indentList={exec:function(a){var b=a.selection.getSelectionParentsByTag("LI");return b?this.tryToPushLiLevel(b,a.selection):!1},state:function(){return !1},tryToPushLiLevel:function(e,f){var g,h,q,a,b,d=!1;return f.executeAndRestoreRangy(function(){for(var i=e.length;i--;){a=e[i],g="OL"===a.parentNode.nodeName?"OL":"UL",h=a.ownerDocument.createElement(g),q=wysihtml5.dom.domNode(a).prev({nodeTypes:[wysihtml5.ELEMENT_NODE]}),b=q?q.querySelector("ul, ol"):null,q&&(b?b.appendChild(a):(h.appendChild(a),q.appendChild(h)),d=!0)}}),d}},wysihtml5.commands.outdentList={exec:function(a){var b=a.selection.getSelectionParentsByTag("LI");return b?this.tryToPullLiLevel(b,a):!1},state:function(){return !1},tryToPullLiLevel:function(a,b){var d,e,f,g,h,i=!1,s=this;return b.selection.executeAndRestoreRangy(function(){var j,k;for(j=a.length;j--;){if(g=a[j],g.parentNode&&(d=g.parentNode,"OL"===d.tagName||"UL"===d.tagName)){if(i=!0,e=wysihtml5.dom.getParentElement(d.parentNode,{nodeName:["OL","UL"]},!1,b.element),f=wysihtml5.dom.getParentElement(d.parentNode,{nodeName:["LI"]},!1,b.element),e&&f){g.nextSibling&&(h=s.getAfterList(d,g),g.appendChild(h)),e.insertBefore(g,f.nextSibling)}else{for(g.nextSibling&&(h=s.getAfterList(d,g),g.appendChild(h)),k=g.childNodes.length;k--;){d.parentNode.insertBefore(g.childNodes[k],d.nextSibling)}d.parentNode.insertBefore(document.createElement("br"),d.nextSibling),g.parentNode.removeChild(g)}0===d.childNodes.length&&d.parentNode.removeChild(d)}}}),i},getAfterList:function(d,i){for(var a=d.nodeName,b=document.createElement(a);i.nextSibling;){b.appendChild(i.nextSibling)}return b}},function(a){var b=90,d=89,e=8,f=46,g=25,h="data-wysihtml5-selection-node",i="data-wysihtml5-selection-offset",s=('<span id="_wysihtml5-undo" class="_wysihtml5-temp">'+a.INVISIBLE_SPACE+"</span>",'<span id="_wysihtml5-redo" class="_wysihtml5-temp">'+a.INVISIBLE_SPACE+"</span>",a.dom);a.UndoManager=a.lang.Dispatcher.extend({constructor:function(j){this.editor=j,this.composer=j.composer,this.element=this.composer.element,this.position=0,this.historyStr=[],this.historyDom=[],this.transact(),this._observe()},_observe:function(){var j,k=this;this.composer.sandbox.getDocument();s.observe(this.element,"keydown",function(o){if(!o.altKey&&(o.ctrlKey||o.metaKey)){var n=o.keyCode,l=n===b&&!o.shiftKey,m=n===b&&o.shiftKey||n===d;l?(k.undo(),o.preventDefault()):m&&(k.redo(),o.preventDefault())}}),s.observe(this.element,"keydown",function(l){var m=l.keyCode;m!==j&&(j=m,(m===e||m===f)&&k.transact())}),this.editor.on("newword:composer",function(){k.transact()}).on("beforecommand:composer",function(){k.transact()})},transact:function(){var n,o,p,q,r,y,j,k=this.historyStr[this.position-1],l=this.composer.getValue(!1,!1),m=this.element.offsetWidth>0&&this.element.offsetHeight>0;l!==k&&(y=this.historyStr.length=this.historyDom.length=this.position,y>g&&(this.historyStr.shift(),this.historyDom.shift(),this.position--),this.position++,m&&(n=this.composer.selection.getRange(),o=n&&n.startContainer?n.startContainer:this.element,p=n&&n.startOffset?n.startOffset:0,o.nodeType===a.ELEMENT_NODE?q=o:(q=o.parentNode,r=this.getChildNodeIndex(q,o)),q.setAttribute(i,p),void 0!==r&&q.setAttribute(h,r)),j=this.element.cloneNode(!!l),this.historyDom.push(j),this.historyStr.push(l),q&&(q.removeAttribute(i),q.removeAttribute(h)))},undo:function(){this.transact(),this.undoPossible()&&(this.set(this.historyDom[--this.position-1]),this.editor.fire("undo:composer"))},redo:function(){this.redoPossible()&&(this.set(this.historyDom[++this.position-1]),this.editor.fire("redo:composer"))},undoPossible:function(){return this.position>1},redoPossible:function(){return this.position<this.historyStr.length},set:function(o){var p,j,k,l,m,n;for(this.element.innerHTML="",p=0,j=o.childNodes,k=o.childNodes.length;k>p;p++){this.element.appendChild(j[p].cloneNode(!0))}o.hasAttribute(i)?(l=o.getAttribute(i),n=o.getAttribute(h),m=this.element):(m=this.element.querySelector("["+i+"]")||this.element,l=m.getAttribute(i),n=m.getAttribute(h),m.removeAttribute(i),m.removeAttribute(h)),null!==n&&(m=this.getChildNodeByIndex(m,+n)),this.composer.selection.set(m,l)},getChildNodeIndex:function(m,n){for(var l=0,j=m.childNodes,k=j.length;k>l;l++){if(j[l]===n){return l}}},getChildNodeByIndex:function(j,k){return j.childNodes[k]}})}(wysihtml5),wysihtml5.views.View=Base.extend({constructor:function(b,g,a){this.parent=b,this.element=g,this.config=a,this.config.noTextarea||this._observeViewChange()},_observeViewChange:function(){var a=this;this.parent.on("beforeload",function(){a.parent.on("change_view",function(b){b===a.name?(a.parent.currentView=a,a.show(),setTimeout(function(){a.focus()},0)):a.hide()})})},focus:function(){if(this.element.ownerDocument.querySelector(":focus")!==this.element){try{this.element.focus()}catch(a){}}},hide:function(){this.element.style.display="none"},show:function(){this.element.style.display=""},disable:function(){this.element.setAttribute("disabled","disabled")},enable:function(){this.element.removeAttribute("disabled")}}),function(b){var g=b.dom,a=b.browser;b.views.Composer=b.views.View.extend({name:"composer",CARET_HACK:"<br>",constructor:function(e,f,d){this.base(e,f,d),this.config.noTextarea?this.editableArea=f:this.textarea=this.parent.textarea,this.config.contentEditableMode?this._initContentEditableArea():this._initSandbox()},clear:function(){this.element.innerHTML=a.displaysCaretInEmptyContentEditableCorrectly()?"":this.CARET_HACK},getValue:function(d,e){var f=this.isEmpty()?"":b.quirks.getCorrectInnerHTML(this.element);return d!==!1&&(f=this.parent.parse(f,e===!1?!1:!0)),f},setValue:function(e,f){f&&(e=this.parent.parse(e));try{this.element.innerHTML=e}catch(d){this.element.innerText=e}},cleanUp:function(){this.parent.parse(this.element)},show:function(){this.editableArea.style.display=this._displayStyle||"",this.config.noTextarea||this.textarea.element.disabled||(this.disable(),this.enable())},hide:function(){this._displayStyle=g.getStyle("display").from(this.editableArea),"none"===this._displayStyle&&(this._displayStyle=null),this.editableArea.style.display="none"},disable:function(){this.parent.fire("disable:composer"),this.element.removeAttribute("contentEditable")},enable:function(){this.parent.fire("enable:composer"),this.element.setAttribute("contentEditable","true")},focus:function(d){b.browser.doesAsyncFocus()&&this.hasPlaceholderSet()&&this.clear(),this.base();var e=this.element.lastChild;d&&e&&this.selection&&("BR"===e.nodeName?this.selection.setBefore(this.element.lastChild):this.selection.setAfter(this.element.lastChild))},getTextContent:function(){return g.getTextContent(this.element)},hasPlaceholderSet:function(){return this.getTextContent()==(this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"))&&this.placeholderSet},isEmpty:function(){var d=this.element.innerHTML.toLowerCase();return/^(\s|<br>|<\/br>|<p>|<\/p>)*$/i.test(d)||""===d||"<br>"===d||"<p></p>"===d||"<p><br></p>"===d||this.hasPlaceholderSet()},_initContentEditableArea:function(){var d=this;this.config.noTextarea?this.sandbox=new g.ContentEditableArea(function(){d._create()},{},this.editableArea):(this.sandbox=new g.ContentEditableArea(function(){d._create()}),this.editableArea=this.sandbox.getContentEditable(),g.insert(this.editableArea).after(this.textarea.element),this._createWysiwygFormField())},_initSandbox:function(){var d,e=this;this.sandbox=new g.Sandbox(function(){e._create()},{stylesheets:this.config.stylesheets}),this.editableArea=this.sandbox.getIframe(),d=this.textarea.element,g.insert(this.editableArea).after(d),this._createWysiwygFormField()},_createWysiwygFormField:function(){if(this.textarea.element.form){var d=document.createElement("input");d.type="hidden",d.name="_wysihtml5_mode",d.value=1,g.insert(d).after(this.textarea.element)}},_create:function(){var f,d,e=this;this.doc=this.sandbox.getDocument(),this.element=this.config.contentEditableMode?this.sandbox.getContentEditable():this.doc.body,this.config.noTextarea?this.cleanUp():(this.textarea=this.parent.textarea,this.element.innerHTML=this.textarea.getValue(!0,!1)),this.selection=new b.Selection(this.parent,this.element,this.config.uneditableContainerClassname),this.commands=new b.Commands(this.parent),this.config.noTextarea||g.copyAttributes(["className","spellcheck","title","lang","dir","accessKey"]).from(this.textarea.element).to(this.element),g.addClass(this.element,this.config.composerClassName),this.config.style&&!this.config.contentEditableMode&&this.style(),this.observe(),f=this.config.name,f&&(g.addClass(this.element,f),this.config.contentEditableMode||g.addClass(this.editableArea,f)),this.enable(),!this.config.noTextarea&&this.textarea.element.disabled&&this.disable(),d="string"==typeof this.config.placeholder?this.config.placeholder:this.config.noTextarea?this.editableArea.getAttribute("data-placeholder"):this.textarea.element.getAttribute("placeholder"),d&&g.simulatePlaceholder(this.parent,this,d),this.commands.exec("styleWithCSS",!1),this._initAutoLinking(),this._initObjectResizing(),this._initUndoManager(),this._initLineBreaking(),this.config.noTextarea||!this.textarea.element.hasAttribute("autofocus")&&document.querySelector(":focus")!=this.textarea.element||a.isIos()||setTimeout(function(){e.focus(!0)},100),a.clearsContentEditableCorrectly()||b.quirks.ensureProperClearing(this),this.initSync&&this.config.sync&&this.initSync(),this.config.noTextarea||this.textarea.hide(),this.parent.fire("beforeload").fire("load")},_initAutoLinking:function(){var e,h,i,n=this,d=a.canDisableAutoLinking(),f=a.doesAutoLinkingInContentEditable();d&&this.commands.exec("autoUrlDetect",!1),this.config.autoLink&&((!f||f&&d)&&(this.parent.on("newword:composer",function(){g.getTextContent(n.element).match(g.autoLink.URL_REG_EXP)&&n.selection.executeAndRestore(function(l,m){var q,j=n.element.querySelectorAll("."+n.config.uneditableContainerClassname),k=!1;for(q=j.length;q--;){b.dom.contains(j[q],m)&&(k=!0)}k||g.autoLink(m.parentNode,[n.config.uneditableContainerClassname])})}),g.observe(this.element,"blur",function(){g.autoLink(n.element,[n.config.uneditableContainerClassname])})),e=this.sandbox.getDocument().getElementsByTagName("a"),h=g.autoLink.URL_REG_EXP,i=function(j){var k=b.lang.string(g.getTextContent(j)).trim();return"www."===k.substr(0,4)&&(k="http://"+k),k},g.observe(this.element,"keydown",function(j){if(e.length){var k,l=n.selection.getSelectedNode(j.target.ownerDocument),m=g.getParentElement(l,{nodeName:"A"},4);m&&(k=i(m),setTimeout(function(){var o=i(m);o!==k&&o.match(h)&&m.setAttribute("href",o)},0))}}))},_initObjectResizing:function(){if(this.commands.exec("enableObjectResizing",!0),a.supportsEvent("resizeend")){var f=["width","height"],d=f.length,e=this.element;g.observe(e,"resizeend",function(p){var q,h=p.target||p.srcElement,i=h.style,o=0;if("IMG"===h.nodeName){for(;d>o;o++){q=f[o],i[q]&&(h.setAttribute(q,parseInt(i[q],10)),i[q]="")}b.quirks.redraw(e)}})}},_initUndoManager:function(){this.undoManager=new b.UndoManager(this.parent)},_initLineBreaking:function(){function f(i){var h=g.getParentElement(i,{nodeName:["P","DIV"]},2);h&&g.contains(j.element,h)&&j.selection.executeAndRestore(function(){j.config.useLineBreaks?g.replaceWithChildNodes(h):"P"!==h.nodeName&&g.renameElement(h,"p")})}var j=this,d=["LI","P","H1","H2","H3","H4","H5","H6"],e=["UL","OL","MENU"];this.config.useLineBreaks||g.observe(this.element,["focus","keydown"],function(){if(j.isEmpty()){var h=j.doc.createElement("P");j.element.innerHTML="",j.element.appendChild(h),a.displaysCaretInEmptyContentEditableCorrectly()?j.selection.selectNode(h,!0):(h.innerHTML="<br>",j.selection.setBefore(h.firstChild))}}),g.observe(this.element,"keydown",function(h){var i,l=h.keyCode;if(!h.shiftKey&&(l===b.ENTER_KEY||l===b.BACKSPACE_KEY)){return i=g.getParentElement(j.selection.getSelectedNode(),{nodeName:d},4),i?(setTimeout(function(){var k,n=j.selection.getSelectedNode();if("LI"===i.nodeName){if(!n){return}k=g.getParentElement(n,{nodeName:e},2),k||f(n)}l===b.ENTER_KEY&&i.nodeName.match(/^H[1-6]$/)&&f(n)},0),void 0):(j.config.useLineBreaks&&l===b.ENTER_KEY&&!b.browser.insertsLineBreaksOnReturn()&&(h.preventDefault(),j.commands.exec("insertLineBreak")),void 0)}})}})}(wysihtml5),function(a){var b=a.dom,d=document,e=window,f=d.createElement("div"),g=["background-color","color","cursor","font-family","font-size","font-style","font-variant","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-rendering","word-break","word-wrap","word-spacing"],h=["background-color","border-collapse","border-bottom-color","border-bottom-style","border-bottom-width","border-left-color","border-left-style","border-left-width","border-right-color","border-right-style","border-right-width","border-top-color","border-top-style","border-top-width","clear","display","float","margin-bottom","margin-left","margin-right","margin-top","outline-color","outline-offset","outline-width","outline-style","padding-left","padding-right","padding-top","padding-bottom","position","top","left","right","bottom","z-index","vertical-align","text-align","-webkit-box-sizing","-moz-box-sizing","-ms-box-sizing","box-sizing","-webkit-box-shadow","-moz-box-shadow","-ms-box-shadow","box-shadow","-webkit-border-top-right-radius","-moz-border-radius-topright","border-top-right-radius","-webkit-border-bottom-right-radius","-moz-border-radius-bottomright","border-bottom-right-radius","-webkit-border-bottom-left-radius","-moz-border-radius-bottomleft","border-bottom-left-radius","-webkit-border-top-left-radius","-moz-border-radius-topleft","border-top-left-radius","width","height"],i=["html                 { height: 100%; }","body                 { height: 100%; padding: 1px 0 0 0; margin: -1px 0 0 0; }","body > p:first-child { margin-top: 0; }","._wysihtml5-temp     { display: none; }",a.browser.isGecko?"body.placeholder { color: graytext !important; }":"body.placeholder { color: #a9a9a9 !important; }","img:-moz-broken      { -moz-force-broken-image-icon: 1; height: 24px; width: 24px; }"],s=function(j){if(j.setActive){try{j.setActive()}catch(k){}}else{var l=j.style,m=d.documentElement.scrollTop||d.body.scrollTop,n=d.documentElement.scrollLeft||d.body.scrollLeft,o={position:l.position,top:l.top,left:l.left,WebkitUserSelect:l.WebkitUserSelect};b.setStyles({position:"absolute",top:"-99999px",left:"-99999px",WebkitUserSelect:"none"}).on(j),j.focus(),b.setStyles(o).on(j),e.scrollTo&&e.scrollTo(n,m)}};a.views.Composer.prototype.style=function(){var q,r,j=this,k=d.querySelector(":focus"),l=this.textarea.element,m=l.hasAttribute("placeholder"),n=m&&l.getAttribute("placeholder"),o=l.style.display,p=l.disabled;return this.focusStylesHost=f.cloneNode(!1),this.blurStylesHost=f.cloneNode(!1),this.disabledStylesHost=f.cloneNode(!1),m&&l.removeAttribute("placeholder"),l===k&&l.blur(),l.disabled=!1,l.style.display=q="none",(l.getAttribute("rows")&&"auto"===b.getStyle("height").from(l)||l.getAttribute("cols")&&"auto"===b.getStyle("width").from(l))&&(l.style.display=q=o),b.copyStyles(h).from(l).to(this.editableArea).andTo(this.blurStylesHost),b.copyStyles(g).from(l).to(this.element).andTo(this.blurStylesHost),b.insertCSS(i).into(this.element.ownerDocument),l.disabled=!0,b.copyStyles(h).from(l).to(this.disabledStylesHost),b.copyStyles(g).from(l).to(this.disabledStylesHost),l.disabled=p,l.style.display=o,s(l),l.style.display=q,b.copyStyles(h).from(l).to(this.focusStylesHost),b.copyStyles(g).from(l).to(this.focusStylesHost),l.style.display=o,b.copyStyles(["display"]).from(l).to(this.editableArea),r=a.lang.array(h).without(["display"]),k?k.focus():l.blur(),m&&l.setAttribute("placeholder",n),this.parent.on("focus:composer",function(){b.copyStyles(r).from(j.focusStylesHost).to(j.editableArea),b.copyStyles(g).from(j.focusStylesHost).to(j.element)}),this.parent.on("blur:composer",function(){b.copyStyles(r).from(j.blurStylesHost).to(j.editableArea),b.copyStyles(g).from(j.blurStylesHost).to(j.element)}),this.parent.observe("disable:composer",function(){b.copyStyles(r).from(j.disabledStylesHost).to(j.editableArea),b.copyStyles(g).from(j.disabledStylesHost).to(j.element)}),this.parent.observe("enable:composer",function(){b.copyStyles(r).from(j.blurStylesHost).to(j.editableArea),b.copyStyles(g).from(j.blurStylesHost).to(j.element)}),this}}(wysihtml5),function(f){var g=f.dom,o=f.browser,a={66:"bold",73:"italic",85:"underline"},b=function(m,j,h){var i,k=m.getPreviousNode(j,!0),l=m.getSelectedNode();if(1!==l.nodeType&&l.parentNode!==h&&(l=l.parentNode),k){if(1==l.nodeType){if(i=l.firstChild,1==k.nodeType){for(;l.firstChild;){k.appendChild(l.firstChild)}}else{for(;l.firstChild;){j.parentNode.insertBefore(l.firstChild,j)}}l.parentNode&&l.parentNode.removeChild(l),m.setBefore(i)}else{1==k.nodeType?k.appendChild(l):j.parentNode.insertBefore(l,j),m.setBefore(l)}}},d=function(n,m,h,i){var j,k,l;m.isCollapsed()?m.caretIsInTheBeginnig("LI")?(n.preventDefault(),i.commands.exec("outdentList")):m.caretIsInTheBeginnig()?n.preventDefault():(m.caretIsFirstInSelection()&&m.getPreviousNode()&&m.getPreviousNode().nodeName&&/^H\d$/gi.test(m.getPreviousNode().nodeName)&&(j=m.getPreviousNode(),n.preventDefault(),/^\s*$/.test(j.textContent||j.innerText)?j.parentNode.removeChild(j):(k=j.ownerDocument.createRange(),k.selectNodeContents(j),k.collapse(!1),m.setSelection(k))),l=m.caretIsBeforeUneditable(),l&&(n.preventDefault(),b(m,l,h))):m.containsUneditable()&&(n.preventDefault(),m.deleteContents())},e=function(h){if(h.selection.isCollapsed()){if(h.selection.caretIsInTheBeginnig("LI")&&h.commands.exec("indentList")){return}}else{h.selection.deleteContents()}h.commands.exec("insertHTML","&emsp;")};f.views.Composer.prototype.observe=function(){var u,h,i=this,j=this.getValue(!1,!1),k=this.sandbox.getIframe?this.sandbox.getIframe():this.sandbox.getContentEditable(),l=this.element,m=o.supportsEventsInIframeCorrectly()||this.sandbox.getContentEditable?l:this.sandbox.getWindow(),n=["drop","paste","beforepaste"],t=["drop","paste","mouseup","focus","keyup"];g.observe(k,"DOMNodeRemoved",function(){clearInterval(u),i.parent.fire("destroy:composer")}),o.supportsMutationEvents()||(u=setInterval(function(){g.contains(document.documentElement,k)||(clearInterval(u),i.parent.fire("destroy:composer"))},250)),g.observe(m,t,function(){setTimeout(function(){i.parent.fire("interaction").fire("interaction:composer")},0)}),this.config.handleTables&&(!this.tableClickHandle&&this.doc.execCommand&&f.browser.supportsCommand(this.doc,"enableObjectResizing")&&f.browser.supportsCommand(this.doc,"enableInlineTableEditing")&&(this.sandbox.getIframe?this.tableClickHandle=g.observe(k,["focus","mouseup","mouseover"],function(){i.doc.execCommand("enableObjectResizing",!1,"false"),i.doc.execCommand("enableInlineTableEditing",!1,"false"),i.tableClickHandle.stop()}):setTimeout(function(){i.doc.execCommand("enableObjectResizing",!1,"false"),i.doc.execCommand("enableInlineTableEditing",!1,"false")},0)),this.tableSelection=f.quirks.tableCellsSelection(l,i.parent)),g.observe(m,"focus",function(p){i.parent.fire("focus",p).fire("focus:composer",p),setTimeout(function(){j=i.getValue(!1,!1)},0)}),g.observe(m,"blur",function(q){if(j!==i.getValue(!1,!1)){var p=q;"function"==typeof Object.create&&(p=Object.create(q,{type:{value:"change"}})),i.parent.fire("change",p).fire("change:composer",p)}i.parent.fire("blur",q).fire("blur:composer",q)}),g.observe(l,"dragenter",function(){i.parent.fire("unset_placeholder")}),g.observe(l,n,function(p){i.parent.fire(p.type,p).fire(p.type+":composer",p)}),this.config.copyedFromMarking&&g.observe(l,"copy",function(p){p.clipboardData&&(p.clipboardData.setData("text/html",i.config.copyedFromMarking+i.selection.getHtml()),p.preventDefault()),i.parent.fire(p.type,p).fire(p.type+":composer",p)}),g.observe(l,"keyup",function(p){var q=p.keyCode;(q===f.SPACE_KEY||q===f.ENTER_KEY)&&i.parent.fire("newword:composer")}),this.parent.on("paste:composer",function(){setTimeout(function(){i.parent.fire("newword:composer")},0)}),o.canSelectImagesInContentEditable()||g.observe(l,"mousedown",function(x){var p=x.target,q=l.querySelectorAll("img"),r=l.querySelectorAll("."+i.config.uneditableContainerClassname+" img"),s=f.lang.array(q).without(r);"IMG"===p.nodeName&&f.lang.array(s).contains(p)&&i.selection.selectNode(p)}),o.canSelectImagesInContentEditable()||g.observe(l,"drop",function(){setTimeout(function(){i.selection.getSelection().removeAllRanges()},0)}),o.hasHistoryIssue()&&o.supportsSelectionModify()&&g.observe(l,"keydown",function(s){if(s.metaKey||s.ctrlKey){var r=s.keyCode,p=l.ownerDocument.defaultView,q=p.getSelection();(37===r||39===r)&&(37===r&&(q.modify("extend","left","lineboundary"),s.shiftKey||q.collapseToStart()),39===r&&(q.modify("extend","right","lineboundary"),s.shiftKey||q.collapseToEnd()),s.preventDefault())}}),g.observe(l,"keydown",function(r){var q=r.keyCode,p=a[q];(r.ctrlKey||r.metaKey)&&!r.altKey&&p&&(i.commands.exec(p),r.preventDefault()),8===q?d(r,i.selection,l,i):i.config.handleTabKey&&9===q&&(r.preventDefault(),e(i,l))}),g.observe(l,"keydown",function(s){var p,q=i.selection.getSelectedNode(!0),r=s.keyCode;!q||"IMG"!==q.nodeName||r!==f.BACKSPACE_KEY&&r!==f.DELETE_KEY||(p=q.parentNode,p.removeChild(q),"A"!==p.nodeName||p.firstChild||p.parentNode.removeChild(p),setTimeout(function(){f.quirks.redraw(l)},0),s.preventDefault())}),!this.config.contentEditableMode&&o.hasIframeFocusIssue()&&(g.observe(k,"focus",function(){setTimeout(function(){i.doc.querySelector(":focus")!==i.element&&i.focus()},0)}),g.observe(this.element,"blur",function(){setTimeout(function(){i.selection.getSelection().removeAllRanges()},0)})),h={IMG:"Image: ",A:"Link: "},g.observe(l,"mouseover",function(s){var x,p,q=s.target,r=q.nodeName;("A"===r||"IMG"===r)&&(p=q.hasAttribute("title"),p||(x=h[r]+(q.getAttribute("href")||q.getAttribute("src")),q.setAttribute("title",x)))})}}(wysihtml5),function(a){var b=400;a.views.Synchronizer=Base.extend({constructor:function(e,i,d){this.editor=e,this.textarea=i,this.composer=d,this._observe()},fromComposerToTextarea:function(d){this.textarea.setValue(a.lang.string(this.composer.getValue(!1,!1)).trim(),d)},fromTextareaToComposer:function(d){var e=this.textarea.getValue(!1,!1);e?this.composer.setValue(e,d):(this.composer.clear(),this.editor.fire("set_placeholder"))},sync:function(d){"textarea"===this.editor.currentView.name?this.fromTextareaToComposer(d):this.fromComposerToTextarea(d)},_observe:function(){var f,g=this,k=this.textarea.element.form,d=function(){f=setInterval(function(){g.fromComposerToTextarea()},b)},e=function(){clearInterval(f),f=null};d(),k&&(a.dom.observe(k,"submit",function(){g.sync(!0)}),a.dom.observe(k,"reset",function(){setTimeout(function(){g.fromTextareaToComposer()},0)})),this.editor.on("change_view",function(h){"composer"!==h||f?"textarea"===h&&(g.fromComposerToTextarea(!0),e()):(g.fromTextareaToComposer(!0),d())}),this.editor.on("destroy:composer",e)}})}(wysihtml5),wysihtml5.views.Textarea=wysihtml5.views.View.extend({name:"textarea",constructor:function(b,g,a){this.base(b,g,a),this._observe()},clear:function(){this.element.value=""},getValue:function(a){var b=this.isEmpty()?"":this.element.value;return a!==!1&&(b=this.parent.parse(b)),b},setValue:function(a,b){b&&(a=this.parent.parse(a)),this.element.value=a},cleanUp:function(){var a=this.parent.parse(this.element.value);this.element.value=a},hasPlaceholderSet:function(){var d=wysihtml5.browser.supportsPlaceholderAttributeOn(this.element),i=this.element.getAttribute("placeholder")||null,a=this.element.value,b=!a;return d&&b||a===i},isEmpty:function(){return !wysihtml5.lang.string(this.element.value).trim()||this.hasPlaceholderSet()},_observe:function(){var d=this.element,i=this.parent,a={focusin:"focus",focusout:"blur"},b=wysihtml5.browser.supportsEvent("focusin")?["focusin","focusout","change"]:["focus","blur","change"];i.on("beforeload",function(){wysihtml5.dom.observe(d,b,function(e){var f=a[e.type]||e.type;i.fire(f).fire(f+":textarea")}),wysihtml5.dom.observe(d,["paste","drop"],function(){setTimeout(function(){i.fire("paste").fire("paste:textarea")},0)})})}}),function(b){var g,a={name:g,style:!0,toolbar:g,showToolbarAfterInit:!0,autoLink:!0,handleTables:!0,handleTabKey:!0,parserRules:{tags:{br:{},span:{},div:{},p:{}},classes:{}},pasteParserRulesets:null,parser:b.dom.parse,composerClassName:"wysihtml5-editor",bodyClassName:"wysihtml5-supported",useLineBreaks:!0,stylesheets:[],placeholderText:g,supportTouchDevices:!0,cleanUp:!0,contentEditableMode:!1,uneditableContainerClassname:"wysihtml5-uneditable-container",copyedFromMarking:'<meta name="copied-from" content="wysihtml5">'};b.Editor=b.lang.Dispatcher.extend({constructor:function(d,e){if(this.editableElement="string"==typeof d?document.getElementById(d):d,this.config=b.lang.object({}).merge(a).merge(e).get(),this._isCompatible=b.browser.supported(),"textarea"!=this.editableElement.nodeName.toLowerCase()&&(this.config.contentEditableMode=!0,this.config.noTextarea=!0),this.config.noTextarea||(this.textarea=new b.views.Textarea(this,this.editableElement,this.config),this.currentView=this.textarea),!this._isCompatible||!this.config.supportTouchDevices&&b.browser.isTouchDevice()){var f=this;return setTimeout(function(){f.fire("beforeload").fire("load")},0),void 0}b.dom.addClass(document.body,this.config.bodyClassName),this.composer=new b.views.Composer(this,this.editableElement,this.config),this.currentView=this.composer,"function"==typeof this.config.parser&&this._initParser(),this.on("beforeload",this.handleBeforeLoad)},handleBeforeLoad:function(){this.config.noTextarea||(this.synchronizer=new b.views.Synchronizer(this,this.textarea,this.composer)),this.config.toolbar&&(this.toolbar=new b.toolbar.Toolbar(this,this.config.toolbar,this.config.showToolbarAfterInit))},isCompatible:function(){return this._isCompatible},clear:function(){return this.currentView.clear(),this},getValue:function(d,e){return this.currentView.getValue(d,e)},setValue:function(d,e){return this.fire("unset_placeholder"),d?(this.currentView.setValue(d,e),this):this.clear()},cleanUp:function(){this.currentView.cleanUp()},focus:function(d){return this.currentView.focus(d),this},disable:function(){return this.currentView.disable(),this},enable:function(){return this.currentView.enable(),this},isEmpty:function(){return this.currentView.isEmpty()},hasPlaceholderSet:function(){return this.currentView.hasPlaceholderSet()},parse:function(d,e){var f=this.config.contentEditableMode?document:this.composer?this.composer.sandbox.getDocument():null,j=this.config.parser(d,{rules:this.config.parserRules,cleanUp:this.config.cleanUp,context:f,uneditableClass:this.config.uneditableContainerClassname,clearInternals:e});return"object"==typeof d&&b.quirks.redraw(d),j},_initParser:function(){var d,e=this;b.browser.supportsModenPaste()?this.on("paste:composer",function(f){f.preventDefault(),d=b.dom.getPastedHtml(f),d&&e._cleanAndPaste(d)}):this.on("beforepaste:composer",function(f){f.preventDefault(),b.dom.getPastedHtmlWithDiv(e.composer,function(h){h&&e._cleanAndPaste(h)})})},_cleanAndPaste:function(d){var e=b.quirks.cleanPastedHTML(d,{referenceNode:this.composer.element,rules:this.config.pasteParserRulesets||[{set:this.config.parserRules}],uneditableClass:this.config.uneditableContainerClassname});this.composer.selection.deleteContents(),this.composer.selection.insertHTML(e)}})}(wysihtml5),function(f){var m=f.dom,a="wysihtml5-command-dialog-opened",b="input, select, textarea",d="[data-wysihtml5-dialog-field]",e="data-wysihtml5-dialog-field";f.toolbar.Dialog=f.lang.Dispatcher.extend({constructor:function(g,h){this.link=g,this.container=h},_observe:function(){var k,l,h,j,g,i;if(!this._observed){for(k=this,l=function(n){var o=k._serialize();o==k.elementToChange?k.fire("edit",o):k.fire("save",o),k.hide(),n.preventDefault(),n.stopPropagation()},m.observe(k.link,"click",function(){m.hasClass(k.link,a)&&setTimeout(function(){k.hide()},0)}),m.observe(this.container,"keydown",function(o){var n=o.keyCode;n===f.ENTER_KEY&&l(o),n===f.ESCAPE_KEY&&(k.fire("cancel"),k.hide())}),m.delegate(this.container,"[data-wysihtml5-dialog-action=save]","click",l),m.delegate(this.container,"[data-wysihtml5-dialog-action=cancel]","click",function(n){k.fire("cancel"),k.hide(),n.preventDefault(),n.stopPropagation()}),h=this.container.querySelectorAll(b),j=0,g=h.length,i=function(){clearInterval(k.interval)};g>j;j++){m.observe(h[j],"change",i)}this._observed=!0}},_serialize:function(){for(var h=this.elementToChange||{},i=this.container.querySelectorAll(d),j=i.length,g=0;j>g;g++){h[i[g].getAttribute(e)]=i[g].value}return h},_interpolate:function(j){for(var l,h,i,k=document.querySelector(":focus"),s=this.container.querySelectorAll(d),t=s.length,g=0;t>g;g++){l=s[g],l!==k&&(j&&"hidden"===l.type||(h=l.getAttribute(e),i=this.elementToChange&&"boolean"!=typeof this.elementToChange?this.elementToChange.getAttribute(h)||"":l.defaultValue,l.value=i))}},show:function(h){if(!m.hasClass(this.link,a)){var j=this,g=this.container.querySelector(b);if(this.elementToChange=h,this._observe(),this._interpolate(),h&&(this.interval=setInterval(function(){j._interpolate(!0)},500)),m.addClass(this.link,a),this.container.style.display="",this.fire("show"),g&&!h){try{g.focus()}catch(i){}}}},hide:function(){clearInterval(this.interval),this.elementToChange=null,m.removeClass(this.link,a),this.container.style.display="none",this.fire("hide")}})}(wysihtml5),function(f){var m=f.dom,a={position:"relative"},b={left:0,margin:0,opacity:0,overflow:"hidden",padding:0,position:"absolute",top:0,zIndex:1},d={cursor:"inherit",fontSize:"50px",height:"50px",marginTop:"-25px",outline:0,padding:0,position:"absolute",right:"-4px",top:"50%"},e={"x-webkit-speech":"",speech:""};f.toolbar.Speech=function(h,j){var k,l,g,i=document.createElement("input");return f.browser.supportsSpeechApiOn(i)?(k=h.editor.textarea.element.getAttribute("lang"),k&&(e.lang=k),l=document.createElement("div"),f.lang.object(b).merge({width:j.offsetWidth+"px",height:j.offsetHeight+"px"}),m.insert(i).into(l),m.insert(l).into(j),m.setStyles(d).on(i),m.setAttributes(e).on(i),m.setStyles(b).on(l),m.setStyles(a).on(j),g="onwebkitspeechchange" in i?"webkitspeechchange":"speechchange",m.observe(i,g,function(){h.execCommand("insertText",i.value),i.value=""}),m.observe(i,"click",function(o){m.hasClass(j,"wysihtml5-command-disabled")&&o.preventDefault(),o.stopPropagation()}),void 0):(j.style.display="none",void 0)}}(wysihtml5),function(f){var m="wysihtml5-command-disabled",a="wysihtml5-commands-disabled",b="wysihtml5-command-active",d="wysihtml5-action-active",e=f.dom;f.toolbar.Toolbar=Base.extend({constructor:function(l,h,j){this.editor=l,this.container="string"==typeof h?document.getElementById(h):h,this.composer=l.composer,this._getLinks("command"),this._getLinks("action"),this._observe(),j&&this.show(),null!=l.config.classNameCommandDisabled&&(m=l.config.classNameCommandDisabled),null!=l.config.classNameCommandsDisabled&&(a=l.config.classNameCommandsDisabled),null!=l.config.classNameCommandActive&&(b=l.config.classNameCommandActive),null!=l.config.classNameActionActive&&(d=l.config.classNameActionActive);for(var k=this.container.querySelectorAll("[data-wysihtml5-command=insertSpeech]"),g=k.length,i=0;g>i;i++){new f.toolbar.Speech(this,k[i])}},_getLinks:function(w){for(var x,y,g,h,i,j=this[w+"Links"]=f.lang.array(this.container.querySelectorAll("[data-wysihtml5-"+w+"]")).get(),k=j.length,l=0,v=this[w+"Mapping"]={};k>l;l++){x=j[l],g=x.getAttribute("data-wysihtml5-"+w),h=x.getAttribute("data-wysihtml5-"+w+"-value"),y=this.container.querySelector("[data-wysihtml5-"+w+"-group='"+g+"']"),i=this._getDialog(x,g),v[g+":"+h]={link:x,group:y,name:g,value:h,dialog:i,state:!1}}},_getDialog:function(h,i){var j,k,l=this,g=this.container.querySelector("[data-wysihtml5-dialog='"+i+"']");return g&&(j=f.toolbar["Dialog_"+i]?new f.toolbar["Dialog_"+i](h,g):new f.toolbar.Dialog(h,g),j.on("show",function(){k=l.composer.selection.getBookmark(),l.editor.fire("show:dialog",{command:i,dialogContainer:g,commandLink:h})}),j.on("save",function(n){k&&l.composer.selection.setBookmark(k),l._execCommand(i,n),l.editor.fire("save:dialog",{command:i,dialogContainer:g,commandLink:h})}),j.on("cancel",function(){l.editor.focus(!1),l.editor.fire("cancel:dialog",{command:i,dialogContainer:g,commandLink:h})})),j},execCommand:function(h,i){if(!this.commandsDisabled){var g=this.commandMapping[h+":"+i];g&&g.dialog&&!g.state?g.dialog.show():this._execCommand(h,i)}},_execCommand:function(g,h){this.editor.focus(!1),this.composer.commands.exec(g,h),this._updateLinkStates()},execAction:function(g){var h=this.editor;"change_view"===g&&h.textarea&&(h.currentView===h.textarea?h.fire("change_view","composer"):h.fire("change_view","textarea")),"showSource"==g&&h.fire("showSource")},_observe:function(){for(var g=this,i=this.editor,h=this.container,j=this.commandLinks.concat(this.actionLinks),k=j.length,l=0;k>l;l++){"A"===j[l].nodeName?e.setAttributes({href:"javascript:;",unselectable:"on"}).on(j[l]):e.setAttributes({unselectable:"on"}).on(j[l])}e.delegate(h,"[data-wysihtml5-command], [data-wysihtml5-action]","mousedown",function(n){n.preventDefault()}),e.delegate(h,"[data-wysihtml5-command]","click",function(n){var o=this,p=o.getAttribute("data-wysihtml5-command"),q=o.getAttribute("data-wysihtml5-command-value");g.execCommand(p,q),n.preventDefault()}),e.delegate(h,"[data-wysihtml5-action]","click",function(n){var o=this.getAttribute("data-wysihtml5-action");g.execAction(o),n.preventDefault()}),i.on("interaction:composer",function(){g._updateLinkStates()}),i.on("focus:composer",function(){g.bookmark=null}),this.editor.config.handleTables&&(i.on("tableselect:composer",function(){g.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display=""}),i.on("tableunselect:composer",function(){g.container.querySelectorAll('[data-wysihtml5-hiddentools="table"]')[0].style.display="none"})),i.on("change_view",function(n){i.textarea&&setTimeout(function(){g.commandsDisabled="composer"!==n,g._updateLinkStates(),g.commandsDisabled?e.addClass(h,a):e.removeClass(h,a)},0)})},_updateLinkStates:function(){var h,j,k,l,g=this.commandMapping,i=this.actionMapping;for(h in g){l=g[h],this.commandsDisabled?(j=!1,e.removeClass(l.link,b),l.group&&e.removeClass(l.group,b),l.dialog&&l.dialog.hide()):(j=this.composer.commands.state(l.name,l.value),e.removeClass(l.link,m),l.group&&e.removeClass(l.group,m)),l.state!==j&&(l.state=j,j?(e.addClass(l.link,b),l.group&&e.addClass(l.group,b),l.dialog&&("object"==typeof j||f.lang.object(j).isArray()?(!l.dialog.multiselect&&f.lang.object(j).isArray()&&(j=1===j.length?j[0]:!0,l.state=j),l.dialog.show(j)):l.dialog.hide())):(e.removeClass(l.link,b),l.group&&e.removeClass(l.group,b),l.dialog&&l.dialog.hide()))}for(h in i){k=i[h],"change_view"===k.name&&(k.state=this.editor.currentView===this.editor.textarea,k.state?e.addClass(k.link,d):e.removeClass(k.link,d))}},show:function(){this.container.style.display=""},hide:function(){this.container.style.display="none"}})}(wysihtml5),function(a){a.toolbar.Dialog_createTable=a.toolbar.Dialog.extend({show:function(b){this.base(b)}})}(wysihtml5),function(b){var g=(b.dom,"[data-wysihtml5-dialog-field]"),a="data-wysihtml5-dialog-field";b.toolbar.Dialog_foreColorStyle=b.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){for(var d={},e=this.container.querySelectorAll(g),f=e.length,j=0;f>j;j++){d[e[j].getAttribute(a)]=e[j].value}return d},_interpolate:function(t){for(var d,e=document.querySelector(":focus"),f=this.container.querySelectorAll(g),h=f.length,i=0,j=this.elementToChange?b.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,k=j?j.getAttribute("style"):null,l=k?b.quirks.styleParser.parseColor(k,"color"):null;h>i;i++){d=f[i],d!==e&&(t&&"hidden"===d.type||"color"===d.getAttribute(a)&&(d.value=l?l[3]&&1!=l[3]?"rgba("+l[0]+","+l[1]+","+l[2]+","+l[3]+");":"rgb("+l[0]+","+l[1]+","+l[2]+");":"rgb(0,0,0);"))}}})}(wysihtml5),function(a){a.dom;a.toolbar.Dialog_fontSizeStyle=a.toolbar.Dialog.extend({multiselect:!0,_serialize:function(){return{size:this.container.querySelector('[data-wysihtml5-dialog-field="size"]').value}},_interpolate:function(){var b=document.querySelector(":focus"),d=this.container.querySelector("[data-wysihtml5-dialog-field='size']"),e=this.elementToChange?a.lang.object(this.elementToChange).isArray()?this.elementToChange[0]:this.elementToChange:null,f=e?e.getAttribute("style"):null,k=f?a.quirks.styleParser.parseFontSize(f):null;d&&d!==b&&k&&!/^\s*$/.test(k)&&(d.value=k)}})}(wysihtml5),Handlebars=function(){var f=function(){function g(i){this.string=i}var h;return g.prototype.toString=function(){return""+this.string},h=g}(),m=function(l){function A(n){return i[n]||"&amp;"}function B(o,p){for(var n in p){Object.prototype.hasOwnProperty.call(p,n)&&(o[n]=p[n])}}function C(n){return n instanceof h?""+n:n||0===n?(n=""+n,k.test(n)?n.replace(j,A):n):""}function D(n){return n||0===n?G(n)&&0===n.length?!0:!1:!0}var E,F,G,g={},h=l,i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},j=/[&<>"'`]/g,k=/[&<>"'`]/;return g.extend=B,E=Object.prototype.toString,g.toString=E,F=function(n){return"function"==typeof n},F(/x/)&&(F=function(n){return"function"==typeof n&&"[object Function]"===E.call(n)}),g.isFunction=F,G=Array.isArray||function(n){return n&&"object"==typeof n?"[object Array]"===E.call(n):!1},g.isArray=G,g.escapeExpression=C,g.isEmpty=D,g}(f),a=function(){function h(s,j){var k,l,r;for(j&&j.firstLine&&(k=j.firstLine,s+=" - "+k+":"+j.firstColumn),l=Error.prototype.constructor.call(this,s),r=0;r<g.length;r++){this[g[r]]=l[g[r]]}k&&(this.lineNumber=k,this.column=j.firstColumn)}var i,g=["description","fileName","lineNumber","message","name","number","stack"];return h.prototype=Error(),i=h}(),b=function(I,K){function M(r,s){this.helpers=r||{},this.partials=s||{},O(this)}function O(r){r.registerHelper("helperMissing",function(s){if(2===arguments.length){return void 0}throw new N("Missing helper: '"+s+"'")}),r.registerHelper("blockHelperMissing",function(t,v){var s=v.inverse||function(){},u=v.fn;return l(t)&&(t=t.call(this)),t===!0?u(this):t===!1||null==t?s(this):k(t)?t.length>0?r.helpers.each(t,v):s(this):u(t)}),r.registerHelper("each",function(x,y){var z,A,s,t=y.fn,u=y.inverse,v=0,w="";if(l(x)&&(x=x.call(this)),y.data&&(z=q(y.data)),x&&"object"==typeof x){if(k(x)){for(A=x.length;A>v;v++){z&&(z.index=v,z.first=0===v,z.last=v===x.length-1),w+=t(x[v],{data:z})}}else{for(s in x){x.hasOwnProperty(s)&&(z&&(z.key=s,z.index=v,z.first=0===v),w+=t(x[s],{data:z}),v++)}}}return 0===v&&(w=u(this)),w}),r.registerHelper("if",function(s,t){return l(s)&&(s=s.call(this)),!t.hash.includeZero&&!s||L.isEmpty(s)?t.inverse(this):t.fn(this)}),r.registerHelper("unless",function(s,t){return r.helpers["if"].call(this,s,{fn:t.inverse,inverse:t.fn,hash:t.hash})}),r.registerHelper("with",function(s,t){return l(s)&&(s=s.call(this)),L.isEmpty(s)?void 0:t.fn(s)}),r.registerHelper("log",function(s,t){var u=t.data&&null!=t.data.level?parseInt(t.data.level,10):1;r.log(u,s)})}function h(r,s){p.log(r,s)}var i,j,k,l,n,o,p,q,J={},L=I,N=K,g="1.3.0";return J.VERSION=g,i=4,J.COMPILER_REVISION=i,j={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"},J.REVISION_CHANGES=j,k=L.isArray,l=L.isFunction,n=L.toString,o="[object Object]",J.HandlebarsEnvironment=M,M.prototype={constructor:M,logger:p,log:h,registerHelper:function(s,t,r){if(n.call(s)===o){if(r||t){throw new N("Arg not supported with multiple helpers")}L.extend(this.helpers,s)}else{r&&(t.not=r),this.helpers[s]=t}},registerPartial:function(r,s){n.call(r)===o?L.extend(this.partials,r):this.partials[r]=s}},p={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,log:function(s,t){if(p.level<=s){var r=p.methodMap[s];"undefined"!=typeof console&&console[r]&&console[r].call(console,t)}}},J.logger=p,J.log=h,q=function(r){var s={};return L.extend(s,r),s},J.createFrame=q,J}(m,a),d=function(j,l,n){function C(o){var p,q,r=o&&o[0]||1,s=i;if(r!==s){if(s>r){throw p=k[s],q=k[r],new h("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+p+") or downgrade your runtime to an older version ("+q+").")}throw new h("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+o[1]+").")}}function D(p,q){if(!q){throw new h("No environment passed to template")}var r=function(s,t,u,v,w,x){var y,z=q.VM.invokePartial.apply(this,arguments);if(null!=z){return z}if(q.compile){return y={helpers:v,partials:w,data:x},w[t]=q.compile(s,{data:void 0!==x},q),w[t](u,y)}throw new h("The partial "+t+" could not be compiled when running in runtime-only mode")},o={escapeExpression:g.escapeExpression,invokePartial:r,programs:[],program:function(u,v,s){var t=this.programs[u];return s?t=F(u,v,s):t||(t=this.programs[u]=F(u,v)),t},merge:function(u,t){var s=u||t;return u&&t&&u!==t&&(s={},g.extend(s,t),g.extend(s,u)),s},programWithDepth:q.VM.programWithDepth,noop:q.VM.noop,compilerInfo:null};return function(u,v){var x,w,s,t;return v=v||{},s=v.partial?v:q,v.partial||(x=v.helpers,w=v.partials),t=p.call(o,s,u,x,w,v.data),v.partial||q.VM.checkRevision(o.compilerInfo),t}}function E(o,p,q){var r=Array.prototype.slice.call(arguments,3),s=function(t,u){return u=u||{},p.apply(this,[t,u.data||q].concat(r))};return s.program=o,s.depth=r.length,s}function F(p,q,r){var o=function(s,t){return t=t||{},q(s,t.data||r)};return o.program=p,o.depth=0,o}function G(u,o,p,q,r,s){var t={partial:!0,helpers:q,partials:r,data:s};if(void 0===u){throw new h("The partial "+o+" could not be found")}return u instanceof Function?u(p,t):void 0}function H(){return""}var I={},g=j,h=l,i=n.COMPILER_REVISION,k=n.REVISION_CHANGES;return I.checkRevision=C,I.template=D,I.programWithDepth=E,I.program=F,I.invokePartial=G,I.noop=H,I}(m,a,b),e=function(l,A,B,C,D){var E,F=l,G=A,g=B,h=C,i=D,j=function(){var n=new F.HandlebarsEnvironment;return h.extend(n,F),n.SafeString=G,n.Exception=g,n.Utils=h,n.VM=i,n.template=function(o){return i.template(o,n)},n},k=j();return k.create=j,E=k}(b,f,a,m,d);return e}(),this.wysihtml5=this.wysihtml5||{},this.wysihtml5.tpl=this.wysihtml5.tpl||{},this.wysihtml5.tpl.blockquote=Handlebars.template(function(g,h,i,j,k){function l(o){var p,n="";return n+="btn-"+e((p=o&&o.options,p=null==p||p===!1?p:p.toolbar,p=null==p||p===!1?p:p.size,typeof p===d?p.apply(o):p)),n}function m(){return' \n      <span class="fa fa-quote-left"></span>\n    '}function A(){return'\n      <span class="glyphicon glyphicon-quote"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,g.helpers),k=k||{};var a,b="",d="function",e=this.escapeExpression,f=this;return b+='<li>\n  <a class="btn ',a=i["if"].call(h,(a=h&&h.options,a=null==a||a===!1?a:a.toolbar,null==a||a===!1?a:a.size),{hash:{},inverse:f.noop,fn:f.program(1,l,k),data:k}),(a||0===a)&&(b+=a),b+=' btn-default" data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="blockquote" data-wysihtml5-display-format-name="false" tabindex="-1">\n    ',a=i["if"].call(h,(a=h&&h.options,a=null==a||a===!1?a:a.toolbar,null==a||a===!1?a:a.fa),{hash:{},inverse:f.program(5,A,k),fn:f.program(3,m,k),data:k}),(a||0===a)&&(b+=a),b+="\n  </a>\n</li>\n",b}),this.wysihtml5.tpl.color=Handlebars.template(function(i,j,k,w,a){function b(m){var n,l="";return l+="btn-"+g((n=m&&m.options,n=null==n||n===!1?n:n.toolbar,n=null==n||n===!1?n:n.size,typeof n===f?n.apply(m):n)),l}this.compilerInfo=[4,">= 1.0.0"],k=this.merge(k,i.helpers),a=a||{};var d,e="",f="function",g=this.escapeExpression,h=this;return e+='<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ',d=k["if"].call(j,(d=j&&j.options,d=null==d||d===!1?d:d.toolbar,null==d||d===!1?d:d.size),{hash:{},inverse:h.noop,fn:h.program(1,b,a),data:a}),(d||0===d)&&(e+=d),e+='" data-toggle="dropdown" tabindex="-1">\n    <span class="current-color">'+g((d=j&&j.locale,d=null==d||d===!1?d:d.colours,d=null==d||d===!1?d:d.black,typeof d===f?d.apply(j):d))+'</span>\n    <b class="caret"></b>\n  </a>\n  <ul class="dropdown-menu">\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="black"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="black">'+g((d=j&&j.locale,d=null==d||d===!1?d:d.colours,d=null==d||d===!1?d:d.black,typeof d===f?d.apply(j):d))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="silver"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="silver">'+g((d=j&&j.locale,d=null==d||d===!1?d:d.colours,d=null==d||d===!1?d:d.silver,typeof d===f?d.apply(j):d))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="gray"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="gray">'+g((d=j&&j.locale,d=null==d||d===!1?d:d.colours,d=null==d||d===!1?d:d.gray,typeof d===f?d.apply(j):d))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="maroon"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="maroon">'+g((d=j&&j.locale,d=null==d||d===!1?d:d.colours,d=null==d||d===!1?d:d.maroon,typeof d===f?d.apply(j):d))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="red"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="red">'+g((d=j&&j.locale,d=null==d||d===!1?d:d.colours,d=null==d||d===!1?d:d.red,typeof d===f?d.apply(j):d))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="purple"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="purple">'+g((d=j&&j.locale,d=null==d||d===!1?d:d.colours,d=null==d||d===!1?d:d.purple,typeof d===f?d.apply(j):d))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="green"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="green">'+g((d=j&&j.locale,d=null==d||d===!1?d:d.colours,d=null==d||d===!1?d:d.green,typeof d===f?d.apply(j):d))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="olive"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="olive">'+g((d=j&&j.locale,d=null==d||d===!1?d:d.colours,d=null==d||d===!1?d:d.olive,typeof d===f?d.apply(j):d))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="navy"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="navy">'+g((d=j&&j.locale,d=null==d||d===!1?d:d.colours,d=null==d||d===!1?d:d.navy,typeof d===f?d.apply(j):d))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="blue"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="blue">'+g((d=j&&j.locale,d=null==d||d===!1?d:d.colours,d=null==d||d===!1?d:d.blue,typeof d===f?d.apply(j):d))+'</a></li>\n    <li><div class="wysihtml5-colors" data-wysihtml5-command-value="orange"></div><a class="wysihtml5-colors-title" data-wysihtml5-command="foreColor" data-wysihtml5-command-value="orange">'+g((d=j&&j.locale,d=null==d||d===!1?d:d.colours,d=null==d||d===!1?d:d.orange,typeof d===f?d.apply(j):d))+"</a></li>\n  </ul>\n</li>\n",e}),this.wysihtml5.tpl.emphasis=Handlebars.template(function(h,i,j,k,l){function y(n){var o,m="";return m+="btn-"+f((o=n&&n.options,o=null==o||o===!1?o:o.toolbar,o=null==o||o===!1?o:o.size,typeof o===e?o.apply(n):o)),m}function a(o,p){var m,n="";return n+='\n    <a class="btn ',m=j["if"].call(o,(m=o&&o.options,m=null==m||m===!1?m:m.toolbar,null==m||m===!1?m:m.size),{hash:{},inverse:g.noop,fn:g.program(1,y,p),data:p}),(m||0===m)&&(n+=m),n+=' btn-default" data-wysihtml5-command="small" title="CTRL+S" tabindex="-1">'+f((m=o&&o.locale,m=null==m||m===!1?m:m.emphasis,m=null==m||m===!1?m:m.small,typeof m===e?m.apply(o):m))+"</a>\n    ",n}this.compilerInfo=[4,">= 1.0.0"],j=this.merge(j,h.helpers),l=l||{};var b,d="",e="function",f=this.escapeExpression,g=this;return d+='<li>\n  <div class="btn-group">\n    <a class="btn ',b=j["if"].call(i,(b=i&&i.options,b=null==b||b===!1?b:b.toolbar,null==b||b===!1?b:b.size),{hash:{},inverse:g.noop,fn:g.program(1,y,l),data:l}),(b||0===b)&&(d+=b),d+=' btn-default" data-wysihtml5-command="bold" title="CTRL+B" tabindex="-1">'+f((b=i&&i.locale,b=null==b||b===!1?b:b.emphasis,b=null==b||b===!1?b:b.bold,typeof b===e?b.apply(i):b))+'</a>\n    <a class="btn ',b=j["if"].call(i,(b=i&&i.options,b=null==b||b===!1?b:b.toolbar,null==b||b===!1?b:b.size),{hash:{},inverse:g.noop,fn:g.program(1,y,l),data:l}),(b||0===b)&&(d+=b),d+=' btn-default" data-wysihtml5-command="italic" title="CTRL+I" tabindex="-1">'+f((b=i&&i.locale,b=null==b||b===!1?b:b.emphasis,b=null==b||b===!1?b:b.italic,typeof b===e?b.apply(i):b))+'</a>\n    <a class="btn ',b=j["if"].call(i,(b=i&&i.options,b=null==b||b===!1?b:b.toolbar,null==b||b===!1?b:b.size),{hash:{},inverse:g.noop,fn:g.program(1,y,l),data:l}),(b||0===b)&&(d+=b),d+=' btn-default" data-wysihtml5-command="underline" title="CTRL+U" tabindex="-1">'+f((b=i&&i.locale,b=null==b||b===!1?b:b.emphasis,b=null==b||b===!1?b:b.underline,typeof b===e?b.apply(i):b))+"</a>\n    ",b=j["if"].call(i,(b=i&&i.options,b=null==b||b===!1?b:b.toolbar,b=null==b||b===!1?b:b.emphasis,null==b||b===!1?b:b.small),{hash:{},inverse:g.noop,fn:g.program(3,a,l),data:l}),(b||0===b)&&(d+=b),d+="\n  </div>\n</li>\n",d}),this.wysihtml5.tpl["font-styles"]=Handlebars.template(function(g,h,i,j,k){function l(o){var p,n="";return n+="btn-"+e((p=o&&o.options,p=null==p||p===!1?p:p.toolbar,p=null==p||p===!1?p:p.size,typeof p===d?p.apply(o):p)),n}function m(){return'\n      <span class="fa fa-font"></span>\n    '}function A(){return'\n      <span class="glyphicon glyphicon-font"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,g.helpers),k=k||{};var a,b="",d="function",e=this.escapeExpression,f=this;return b+='<li class="dropdown">\n  <a class="btn btn-default dropdown-toggle ',a=i["if"].call(h,(a=h&&h.options,a=null==a||a===!1?a:a.toolbar,null==a||a===!1?a:a.size),{hash:{},inverse:f.noop,fn:f.program(1,l,k),data:k}),(a||0===a)&&(b+=a),b+='" data-toggle="dropdown">\n    ',a=i["if"].call(h,(a=h&&h.options,a=null==a||a===!1?a:a.toolbar,null==a||a===!1?a:a.fa),{hash:{},inverse:f.program(5,A,k),fn:f.program(3,m,k),data:k}),(a||0===a)&&(b+=a),b+='\n    <span class="current-font">'+e((a=h&&h.locale,a=null==a||a===!1?a:a.font_styles,a=null==a||a===!1?a:a.normal,typeof a===d?a.apply(h):a))+'</span>\n    <b class="caret"></b>\n  </a>\n  <ul class="dropdown-menu">\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="p" tabindex="-1">'+e((a=h&&h.locale,a=null==a||a===!1?a:a.font_styles,a=null==a||a===!1?a:a.normal,typeof a===d?a.apply(h):a))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h1" tabindex="-1">'+e((a=h&&h.locale,a=null==a||a===!1?a:a.font_styles,a=null==a||a===!1?a:a.h1,typeof a===d?a.apply(h):a))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h2" tabindex="-1">'+e((a=h&&h.locale,a=null==a||a===!1?a:a.font_styles,a=null==a||a===!1?a:a.h2,typeof a===d?a.apply(h):a))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h3" tabindex="-1">'+e((a=h&&h.locale,a=null==a||a===!1?a:a.font_styles,a=null==a||a===!1?a:a.h3,typeof a===d?a.apply(h):a))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h4" tabindex="-1">'+e((a=h&&h.locale,a=null==a||a===!1?a:a.font_styles,a=null==a||a===!1?a:a.h4,typeof a===d?a.apply(h):a))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h5" tabindex="-1">'+e((a=h&&h.locale,a=null==a||a===!1?a:a.font_styles,a=null==a||a===!1?a:a.h5,typeof a===d?a.apply(h):a))+'</a></li>\n    <li><a data-wysihtml5-command="formatBlock" data-wysihtml5-command-value="h6" tabindex="-1">'+e((a=h&&h.locale,a=null==a||a===!1?a:a.font_styles,a=null==a||a===!1?a:a.h6,typeof a===d?a.apply(h):a))+"</a></li>\n  </ul>\n</li>\n",b}),this.wysihtml5.tpl.html=Handlebars.template(function(g,h,i,j,k){function l(o){var p,n="";return n+="btn-"+e((p=o&&o.options,p=null==p||p===!1?p:p.toolbar,p=null==p||p===!1?p:p.size,typeof p===d?p.apply(o):p)),n}function m(){return'\n        <span class="fa fa-pencil"></span>\n      '}function A(){return'\n        <span class="glyphicon glyphicon-pencil"></span>\n      '}this.compilerInfo=[4,">= 1.0.0"],i=this.merge(i,g.helpers),k=k||{};var a,b="",d="function",e=this.escapeExpression,f=this;return b+='<li>\n  <div class="btn-group">\n    <a class="btn ',a=i["if"].call(h,(a=h&&h.options,a=null==a||a===!1?a:a.toolbar,null==a||a===!1?a:a.size),{hash:{},inverse:f.noop,fn:f.program(1,l,k),data:k}),(a||0===a)&&(b+=a),b+=' btn-default" data-wysihtml5-action="change_view" title="'+e((a=h&&h.locale,a=null==a||a===!1?a:a.html,a=null==a||a===!1?a:a.edit,typeof a===d?a.apply(h):a))+'" tabindex="-1">\n      ',a=i["if"].call(h,(a=h&&h.options,a=null==a||a===!1?a:a.toolbar,null==a||a===!1?a:a.fa),{hash:{},inverse:f.program(5,A,k),fn:f.program(3,m,k),data:k}),(a||0===a)&&(b+=a),b+="\n    </a>\n  </div>\n</li>\n",b}),this.wysihtml5.tpl.image=Handlebars.template(function(e,g,h,i,j){function k(){return"modal-sm"}function l(p){var q,o="";return o+="btn-"+d((q=p&&p.options,q=null==q||q===!1?q:q.toolbar,q=null==q||q===!1?q:q.size,typeof q===b?q.apply(p):q)),o}function m(){return'\n      <span class="fa fa-file-image-o"></span>\n    '}function n(){return'\n      <span class="glyphicon glyphicon-picture"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],h=this.merge(h,e.helpers),j=j||{};var C,a="",b="function",d=this.escapeExpression,f=this;return a+='<li>\n  <div class="bootstrap-wysihtml5-insert-image-modal modal fade" data-wysihtml5-dialog="insertImage">\n    <div class="modal-dialog ',C=h["if"].call(g,(C=g&&g.options,C=null==C||C===!1?C:C.toolbar,null==C||C===!1?C:C.smallmodals),{hash:{},inverse:f.noop,fn:f.program(1,k,j),data:j}),(C||0===C)&&(a+=C),a+='">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;</a>\n          <h3>'+d((C=g&&g.locale,C=null==C||C===!1?C:C.image,C=null==C||C===!1?C:C.insert,typeof C===b?C.apply(g):C))+'</h3>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-image-url form-control" data-wysihtml5-dialog-field="src">\n          </div> \n        </div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">'+d((C=g&&g.locale,C=null==C||C===!1?C:C.image,C=null==C||C===!1?C:C.cancel,typeof C===b?C.apply(g):C))+'</a>\n          <a class="btn btn-primary" data-dismiss="modal"  data-wysihtml5-dialog-action="save" href="#">'+d((C=g&&g.locale,C=null==C||C===!1?C:C.image,C=null==C||C===!1?C:C.insert,typeof C===b?C.apply(g):C))+'</a>\n        </div>\n      </div>\n    </div>\n  </div>\n  <a class="btn ',C=h["if"].call(g,(C=g&&g.options,C=null==C||C===!1?C:C.toolbar,null==C||C===!1?C:C.size),{hash:{},inverse:f.noop,fn:f.program(3,l,j),data:j}),(C||0===C)&&(a+=C),a+=' btn-default" data-wysihtml5-command="insertImage" title="'+d((C=g&&g.locale,C=null==C||C===!1?C:C.image,C=null==C||C===!1?C:C.insert,typeof C===b?C.apply(g):C))+'" tabindex="-1">\n    ',C=h["if"].call(g,(C=g&&g.options,C=null==C||C===!1?C:C.toolbar,null==C||C===!1?C:C.fa),{hash:{},inverse:f.program(7,n,j),fn:f.program(5,m,j),data:j}),(C||0===C)&&(a+=C),a+="\n  </a>\n</li>\n",a}),this.wysihtml5.tpl.link=Handlebars.template(function(e,g,h,i,j){function k(){return"modal-sm"}function l(p){var q,o="";return o+="btn-"+d((q=p&&p.options,q=null==q||q===!1?q:q.toolbar,q=null==q||q===!1?q:q.size,typeof q===b?q.apply(p):q)),o}function m(){return'\n      <span class="fa fa-share-square-o"></span>\n    '}function n(){return'\n      <span class="glyphicon glyphicon-share"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],h=this.merge(h,e.helpers),j=j||{};var C,a="",b="function",d=this.escapeExpression,f=this;return a+='<li>\n  <div class="bootstrap-wysihtml5-insert-link-modal modal fade" data-wysihtml5-dialog="createLink">\n    <div class="modal-dialog ',C=h["if"].call(g,(C=g&&g.options,C=null==C||C===!1?C:C.toolbar,null==C||C===!1?C:C.smallmodals),{hash:{},inverse:f.noop,fn:f.program(1,k,j),data:j}),(C||0===C)&&(a+=C),a+='">\n      <div class="modal-content">\n        <div class="modal-header">\n          <a class="close" data-dismiss="modal">&times;</a>\n          <h3>'+d((C=g&&g.locale,C=null==C||C===!1?C:C.link,C=null==C||C===!1?C:C.insert,typeof C===b?C.apply(g):C))+'</h3>\n        </div>\n        <div class="modal-body">\n          <div class="form-group">\n            <input value="http://" class="bootstrap-wysihtml5-insert-link-url form-control" data-wysihtml5-dialog-field="href">\n          </div> \n          <div class="checkbox">\n            <label> \n              <input type="checkbox" class="bootstrap-wysihtml5-insert-link-target" checked>'+d((C=g&&g.locale,C=null==C||C===!1?C:C.link,C=null==C||C===!1?C:C.target,typeof C===b?C.apply(g):C))+'\n            </label>\n          </div>\n        </div>\n        <div class="modal-footer">\n          <a class="btn btn-default" data-dismiss="modal" data-wysihtml5-dialog-action="cancel" href="#">'+d((C=g&&g.locale,C=null==C||C===!1?C:C.link,C=null==C||C===!1?C:C.cancel,typeof C===b?C.apply(g):C))+'</a>\n          <a href="#" class="btn btn-primary" data-dismiss="modal" data-wysihtml5-dialog-action="save">'+d((C=g&&g.locale,C=null==C||C===!1?C:C.link,C=null==C||C===!1?C:C.insert,typeof C===b?C.apply(g):C))+'</a>\n        </div>\n      </div>\n    </div>\n  </div>\n  <a class="btn ',C=h["if"].call(g,(C=g&&g.options,C=null==C||C===!1?C:C.toolbar,null==C||C===!1?C:C.size),{hash:{},inverse:f.noop,fn:f.program(3,l,j),data:j}),(C||0===C)&&(a+=C),a+=' btn-default" data-wysihtml5-command="createLink" title="'+d((C=g&&g.locale,C=null==C||C===!1?C:C.link,C=null==C||C===!1?C:C.insert,typeof C===b?C.apply(g):C))+'" tabindex="-1">\n    ',C=h["if"].call(g,(C=g&&g.options,C=null==C||C===!1?C:C.toolbar,null==C||C===!1?C:C.fa),{hash:{},inverse:f.program(7,n,j),fn:f.program(5,m,j),data:j}),(C||0===C)&&(a+=C),a+="\n  </a>\n</li>\n",a}),this.wysihtml5.tpl.lists=Handlebars.template(function(a,b,e,g,i){function k(u){var v,t="";return t+="btn-"+m((v=u&&u.options,v=null==v||v===!1?v:v.toolbar,v=null==v||v===!1?v:v.size,typeof v===l?v.apply(u):v)),t}function n(){return'\n      <span class="fa fa-list-ul"></span>\n    '}function p(){return'\n      <span class="glyphicon glyphicon-list"></span>\n    '}function q(){return'\n      <span class="fa fa-list-ol"></span>\n    '}function r(){return'\n      <span class="glyphicon glyphicon-th-list"></span>\n    '}function s(){return'\n      <span class="fa fa-outdent"></span>\n    '}function M(){return'\n      <span class="glyphicon glyphicon-indent-right"></span>\n    '}function d(){return'\n      <span class="fa fa-indent"></span>\n    '}function f(){return'\n      <span class="glyphicon glyphicon-indent-left"></span>\n    '}this.compilerInfo=[4,">= 1.0.0"],e=this.merge(e,a.helpers),i=i||{};var h,j="",l="function",m=this.escapeExpression,o=this;return j+='<li>\n  <div class="btn-group">\n    <a class="btn ',h=e["if"].call(b,(h=b&&b.options,h=null==h||h===!1?h:h.toolbar,null==h||h===!1?h:h.size),{hash:{},inverse:o.noop,fn:o.program(1,k,i),data:i}),(h||0===h)&&(j+=h),j+=' btn-default" data-wysihtml5-command="insertUnorderedList" title="'+m((h=b&&b.locale,h=null==h||h===!1?h:h.lists,h=null==h||h===!1?h:h.unordered,typeof h===l?h.apply(b):h))+'" tabindex="-1">\n    ',h=e["if"].call(b,(h=b&&b.options,h=null==h||h===!1?h:h.toolbar,null==h||h===!1?h:h.fa),{hash:{},inverse:o.program(5,p,i),fn:o.program(3,n,i),data:i}),(h||0===h)&&(j+=h),j+='\n    </a>\n    <a class="btn ',h=e["if"].call(b,(h=b&&b.options,h=null==h||h===!1?h:h.toolbar,null==h||h===!1?h:h.size),{hash:{},inverse:o.noop,fn:o.program(1,k,i),data:i}),(h||0===h)&&(j+=h),j+=' btn-default" data-wysihtml5-command="insertOrderedList" title="'+m((h=b&&b.locale,h=null==h||h===!1?h:h.lists,h=null==h||h===!1?h:h.ordered,typeof h===l?h.apply(b):h))+'" tabindex="-1">\n    ',h=e["if"].call(b,(h=b&&b.options,h=null==h||h===!1?h:h.toolbar,null==h||h===!1?h:h.fa),{hash:{},inverse:o.program(9,r,i),fn:o.program(7,q,i),data:i}),(h||0===h)&&(j+=h),j+='\n    </a>\n    <a class="btn ',h=e["if"].call(b,(h=b&&b.options,h=null==h||h===!1?h:h.toolbar,null==h||h===!1?h:h.size),{hash:{},inverse:o.noop,fn:o.program(1,k,i),data:i}),(h||0===h)&&(j+=h),j+=' btn-default" data-wysihtml5-command="Outdent" title="'+m((h=b&&b.locale,h=null==h||h===!1?h:h.lists,h=null==h||h===!1?h:h.outdent,typeof h===l?h.apply(b):h))+'" tabindex="-1">\n    ',h=e["if"].call(b,(h=b&&b.options,h=null==h||h===!1?h:h.toolbar,null==h||h===!1?h:h.fa),{hash:{},inverse:o.program(13,M,i),fn:o.program(11,s,i),data:i}),(h||0===h)&&(j+=h),j+='\n    </a>\n    <a class="btn ',h=e["if"].call(b,(h=b&&b.options,h=null==h||h===!1?h:h.toolbar,null==h||h===!1?h:h.size),{hash:{},inverse:o.noop,fn:o.program(1,k,i),data:i}),(h||0===h)&&(j+=h),j+=' btn-default" data-wysihtml5-command="Indent" title="'+m((h=b&&b.locale,h=null==h||h===!1?h:h.lists,h=null==h||h===!1?h:h.indent,typeof h===l?h.apply(b):h))+'" tabindex="-1">\n    ',h=e["if"].call(b,(h=b&&b.options,h=null==h||h===!1?h:h.toolbar,null==h||h===!1?h:h.fa),{hash:{},inverse:o.program(17,f,i),fn:o.program(15,d,i),data:i}),(h||0===h)&&(j+=h),j+="\n    </a>\n  </div>\n</li>\n",j}),function(a){"function"==typeof define&&define.amd?define("bootstrap.wysihtml5",["jquery","wysihtml5","bootstrap","bootstrap.wysihtml5.templates","bootstrap.wysihtml5.commands"],a):a(jQuery,wysihtml5)}(function(b,g){var a=function(p,q){var r,d,e,f=function(h,j,i){return q.tpl[h]?q.tpl[h]({locale:j,options:i}):void 0},o=function(j,k){var h,i;this.el=j,h=p.extend(!0,{},d,k);for(i in h.customTemplates){h.customTemplates.hasOwnProperty(i)&&(q.tpl[i]=h.customTemplates[i])}this.toolbar=this.createToolbar(j,h),this.editor=this.createEditor(h)};o.prototype={constructor:o,createEditor:function(h){h=h||{},h=p.extend(!0,{},h),h.toolbar=this.toolbar[0],this.initializeEditor(this.el[0],h)},initializeEditor:function(h,j){var k,i=new q.Editor(this.el[0],j);if(i.on("beforeload",this.syncBootstrapDialogEvents),i.on("beforeload",this.loadParserRules),i.composer.editableArea.contentDocument?this.addMoreShortcuts(i,i.composer.editableArea.contentDocument.body||i.composer.editableArea.contentDocument,j.shortcuts):this.addMoreShortcuts(i,i.composer.editableArea,j.shortcuts),j&&j.events){for(k in j.events){j.events.hasOwnProperty(k)&&i.on(k,j.events[k])}}return i},loadParserRules:function(){"string"===p.type(this.config.parserRules)&&p.ajax({dataType:"json",url:this.config.parserRules,context:this,error:function(j,h,i){void 0},success:function(h){this.config.parserRules=h,void 0}}),this.config.pasteParserRulesets&&"string"===p.type(this.config.pasteParserRulesets)&&p.ajax({dataType:"json",url:this.config.pasteParserRulesets,context:this,error:function(j,h,i){void 0},success:function(h){this.config.pasteParserRulesets=h}})},syncBootstrapDialogEvents:function(){var h=this;p.map(this.toolbar.commandMapping,function(i){return[i]}).filter(function(i){return i.dialog}).map(function(i){return i.dialog}).forEach(function(i){i.on("show",function(){p(this.container).modal("show")}),i.on("hide",function(){p(this.container).modal("hide"),setTimeout(h.composer.focus,0)}),p(i.container).on("shown.bs.modal",function(){p(this).find("input, select, textarea").first().focus()})}),this.on("change_view",function(){p(this.toolbar.container.children).find("a.btn").not('[data-wysihtml5-action="change_view"]').toggleClass("disabled")})},createToolbar:function(h,i){var j,k,l=this,m=p("<ul/>",{"class":"wysihtml5-toolbar",style:"display:none"}),n=i.locale||d.locale||"en";e.hasOwnProperty(n)||(void 0,n="en"),j=p.extend(!0,{},e.en,e[n]);for(k in i.toolbar){i.toolbar[k]&&m.append(f(k,j,i))}return m.find('a[data-wysihtml5-command="formatBlock"]').click(function(A){var s=A.delegateTarget||A.target||A.srcElement,t=p(s),y=t.data("wysihtml5-display-format-name"),z=t.data("wysihtml5-format-name")||t.html();(void 0===y||"true"===y)&&l.toolbar.find(".current-font").text(z)}),m.find('a[data-wysihtml5-command="foreColor"]').click(function(w){var s=w.target||w.srcElement,t=p(s);l.toolbar.find(".current-color").text(t.html())}),this.el.before(m),m},addMoreShortcuts:function(h,j,i){q.dom.observe(j,"keydown",function(l){var m,n=l.keyCode,k=i[n];(l.ctrlKey||l.metaKey||l.altKey)&&k&&q.commands[k]&&(m=h.toolbar.commandMapping[k+":null"],m&&m.dialog&&!m.state?m.dialog.show():q.commands[k].exec(h.composer,k),l.preventDefault())})}},r={resetDefaults:function(){p.fn.wysihtml5.defaultOptions=p.extend(!0,{},p.fn.wysihtml5.defaultOptionsCache)},bypassDefaults:function(h){return this.each(function(){var i=p(this);i.data("wysihtml5",new o(i,h))})},shallowExtend:function(h){var j=p.extend({},p.fn.wysihtml5.defaultOptions,h||{},p(this).data()),i=this;return r.bypassDefaults.apply(i,[j])},deepExtend:function(h){var j=p.extend(!0,{},p.fn.wysihtml5.defaultOptions,h||{}),i=this;return r.bypassDefaults.apply(i,[j])},init:function(i){var h=this;return r.shallowExtend.apply(h,[i])}},p.fn.wysihtml5=function(h){return r[h]?r[h].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof h&&h?(p.error("Method "+h+" does not exist on jQuery.wysihtml5"),void 0):r.init.apply(this,arguments)},p.fn.wysihtml5.Constructor=o,d=p.fn.wysihtml5.defaultOptions={toolbar:{"font-styles":!0,color:!1,emphasis:{small:!0},blockquote:!0,lists:!0,html:!1,link:!0,image:!0,smallmodals:!1},useLineBreaks:!1,parserRules:{classes:{"wysiwyg-color-silver":1,"wysiwyg-color-gray":1,"wysiwyg-color-white":1,"wysiwyg-color-maroon":1,"wysiwyg-color-red":1,"wysiwyg-color-purple":1,"wysiwyg-color-fuchsia":1,"wysiwyg-color-green":1,"wysiwyg-color-lime":1,"wysiwyg-color-olive":1,"wysiwyg-color-yellow":1,"wysiwyg-color-navy":1,"wysiwyg-color-blue":1,"wysiwyg-color-teal":1,"wysiwyg-color-aqua":1,"wysiwyg-color-orange":1},tags:{b:{},i:{},strong:{},em:{},p:{},br:{},ol:{},ul:{},li:{},h1:{},h2:{},h3:{},h4:{},h5:{},h6:{},blockquote:{},u:1,img:{check_attributes:{width:"numbers",alt:"alt",src:"url",height:"numbers"}},a:{check_attributes:{href:"url"},set_attributes:{target:"_blank",rel:"nofollow"}},span:1,div:1,small:1,code:1,pre:1}},locale:"en",shortcuts:{83:"small",75:"createLink"}},void 0===p.fn.wysihtml5.defaultOptionsCache&&(p.fn.wysihtml5.defaultOptionsCache=p.extend(!0,{},p.fn.wysihtml5.defaultOptions)),e=p.fn.wysihtml5.locale={}};a(b,g)}),function(a){a.commands.small={exec:function(b,e){return a.commands.formatInline.exec(b,e,"small")},state:function(b,e){return a.commands.formatInline.state(b,e,"small")}}}(wysihtml5),function(a){"function"==typeof define&&define.amd?define("bootstrap.wysihtml5.en-US",["jquery","bootstrap.wysihtml5"],a):a(jQuery)}(function(a){a.fn.wysihtml5.locale.en=a.fn.wysihtml5.locale["en-US"]={font_styles:{normal:"Normal text",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6"},emphasis:{bold:"Bold",italic:"Italic",underline:"Underline",small:"Small"},lists:{unordered:"Unordered list",ordered:"Ordered list",outdent:"Outdent",indent:"Indent"},link:{insert:"Insert link",cancel:"Cancel",target:"Open link in new window"},image:{insert:"Insert image",cancel:"Cancel"},html:{edit:"Edit HTML"},colours:{black:"Black",silver:"Silver",gray:"Grey",maroon:"Maroon",red:"Red",purple:"Purple",green:"Green",olive:"Olive",navy:"Navy",blue:"Blue",orange:"Orange"}}});
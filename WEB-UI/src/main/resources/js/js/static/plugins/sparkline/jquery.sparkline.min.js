(function(b,c,a){(function(d){typeof define=="function"&&define.amd?define(["jquery"],d):jQuery&&!jQuery.fn.sparkline&&d(jQuery)})(function(r){var s={},t,u,v,w,x,y,z,A,B,C,D,G,K,d,f,h,j,l,n,p,F,E,I,L,e,g,i,k,m,o,q,H,J=0;t=function(){return{common:{type:"line",lineColor:"#00f",fillColor:"#cdf",defaultPixelsPerValue:3,width:"auto",height:"auto",composite:!1,tagValuesAttribute:"values",tagOptionsPrefix:"spark",enableTagOptions:!1,enableHighlight:!0,highlightLighten:1.4,tooltipSkipNull:!0,tooltipPrefix:"",tooltipSuffix:"",disableHiddenCheck:!1,numberFormatter:!1,numberDigitGroupCount:3,numberDigitGroupSep:",",numberDecimalMark:".",disableTooltips:!1,disableInteraction:!1},line:{spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:a,normalRangeMax:a,normalRangeColor:"#ccc",drawNormalOnTop:!1,chartRangeMin:a,chartRangeMax:a,chartRangeMinX:a,chartRangeMaxX:a,tooltipFormat:new v('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{y}}{{suffix}}')},bar:{barColor:"#3366cc",negBarColor:"#f44",stackedBarColor:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],zeroColor:a,nullColor:a,zeroAxis:!0,barWidth:4,barSpacing:1,chartRangeMax:a,chartRangeMin:a,chartRangeClip:!1,colorMap:a,tooltipFormat:new v('<span style="color: {{color}}">&#9679;</span> {{prefix}}{{value}}{{suffix}}')},tristate:{barWidth:4,barSpacing:1,posBarColor:"#6f6",negBarColor:"#f44",zeroBarColor:"#999",colorMap:{},tooltipFormat:new v('<span style="color: {{color}}">&#9679;</span> {{value:map}}'),tooltipValueLookups:{map:{"-1":"Loss",0:"Draw",1:"Win"}}},discrete:{lineHeight:"auto",thresholdColor:a,thresholdValue:0,chartRangeMax:a,chartRangeMin:a,chartRangeClip:!1,tooltipFormat:new v("{{prefix}}{{value}}{{suffix}}")},bullet:{targetColor:"#f33",targetWidth:3,performanceColor:"#33f",rangeColors:["#d3dafe","#a8b6ff","#7f94ff"],base:a,tooltipFormat:new v("{{fieldkey:fields}} - {{value}}"),tooltipValueLookups:{fields:{r:"Range",p:"Performance",t:"Target"}}},pie:{offset:0,sliceColors:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],borderWidth:0,borderColor:"#000",tooltipFormat:new v('<span style="color: {{color}}">&#9679;</span> {{value}} ({{percent.1}}%)')},box:{raw:!1,boxLineColor:"#000",boxFillColor:"#cdf",whiskerColor:"#000",outlierLineColor:"#333",outlierFillColor:"#fff",medianColor:"#f00",showOutliers:!0,outlierIQR:1.5,spotRadius:1.5,target:a,targetColor:"#4a2",chartRangeMax:a,chartRangeMin:a,tooltipFormat:new v("{{field:fields}}: {{value}}"),tooltipFormatFieldlistKey:"field",tooltipValueLookups:{fields:{lq:"Lower Quartile",med:"Median",uq:"Upper Quartile",lo:"Left Outlier",ro:"Right Outlier",lw:"Left Whisker",rw:"Right Whisker"}}}}},g='.jqstooltip { position: absolute;left: 0px;top: 0px;visibility: hidden;background: rgb(0, 0, 0) transparent;background-color: rgba(0,0,0,0.6);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000);-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000)";color: white;font: 10px arial, san serif;text-align: left;white-space: nowrap;padding: 5px;border: 1px solid white;z-index: 10000;}.jqsfield { color: white;font: 10px arial, san serif;text-align: left;}',u=function(){var M,N;return M=function(){this.init.apply(this,arguments)},arguments.length>1?(arguments[0]?(M.prototype=r.extend(new arguments[0],arguments[arguments.length-1]),M._super=arguments[0].prototype):M.prototype=arguments[arguments.length-1],arguments.length>2&&(N=Array.prototype.slice.call(arguments,1,-1),N.unshift(M.prototype),r.extend.apply(r,N))):M.prototype=arguments[0],M.prototype.cls=M,M},r.SPFormatClass=v=u({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function(M,N){this.format=M,this.fclass=N},render:function(T,U,V){var M=this,N=T,O,P,Q,R,S;return this.format.replace(this.fre,function(){var W;return P=arguments[1],Q=arguments[3],O=M.precre.exec(P),O?(S=O[2],P=O[1]):S=!1,R=N[P],R===a?"":Q&&U&&U[Q]?(W=U[Q],W.get?U[Q].get(R)||R:U[Q][R]||R):(B(R)&&(V.get("numberFormatter")?R=V.get("numberFormatter")(R):R=d(R,S,V.get("numberDigitGroupCount"),V.get("numberDigitGroupSep"),V.get("numberDecimalMark"))),R)})}}),r.spformat=function(M,N){return new v(M,N)},w=function(N,O,M){return N<O?O:N>M?M:N},x=function(O,M){var N;return M===2?(N=c.floor(O.length/2),O.length%2?O[N]:(O[N-1]+O[N])/2):O.length%2?(N=(O.length*M+M)/4,N%1?(O[c.floor(N)]+O[c.floor(N)-1])/2:O[N-1]):(N=(O.length*M+2)/4,N%1?(O[c.floor(N)]+O[c.floor(N)-1])/2:O[N-1])},y=function(M){var N;switch(M){case"undefined":M=a;break;case"null":M=null;break;case"true":M=!0;break;case"false":M=!1;break;default:N=parseFloat(M),M==N&&(M=N)}return M},z=function(N){var O,M=[];for(O=N.length;O--;){M[O]=y(N[O])}return M},A=function(P,Q){var M,N,O=[];for(M=0,N=P.length;M<N;M++){P[M]!==Q&&O.push(P[M])}return O},B=function(M){return !isNaN(parseFloat(M))&&isFinite(M)},d=function(P,Q,R,S,M){var N,O;P=(Q===!1?parseFloat(P).toString():P.toFixed(Q)).split(""),N=(N=r.inArray(".",P))<0?P.length:N,N<P.length&&(P[N]=M);for(O=N-R;O>0;O-=R){P.splice(O,0,S)}return P.join("")},C=function(O,P,M){var N;for(N=P.length;N--;){if(M&&P[N]===null){continue}if(P[N]!==O){return !1}}return !0},D=function(N){var O=0,M;for(M=N.length;M--;){O+=typeof N[M]=="number"?N[M]:0}return O},K=function(M){return r.isArray(M)?M:[M]},G=function(N){var M;b.createStyleSheet?b.createStyleSheet().cssText=N:(M=b.createElement("style"),M.type="text/css",b.getElementsByTagName("head")[0].appendChild(M),M[typeof b.body.style.WebkitAppearance=="string"?"innerText":"innerHTML"]=N)},r.fn.simpledraw=function(O,P,Q,R){var S,M;if(Q&&(S=this.data("_jqs_vcanvas"))){return S}if(r.fn.sparkline.canvas===!1){return !1}if(r.fn.sparkline.canvas===a){var N=b.createElement("canvas");if(!N.getContext||!N.getContext("2d")){if(!b.namespaces||!!b.namespaces.v){return r.fn.sparkline.canvas=!1,!1}b.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"),r.fn.sparkline.canvas=function(V,W,T,U){return new q(V,W,T)}}else{r.fn.sparkline.canvas=function(V,W,T,U){return new o(V,W,T,U)}}}return O===a&&(O=r(this).innerWidth()),P===a&&(P=r(this).innerHeight()),S=r.fn.sparkline.canvas(O,P,this,R),M=r(this).data("_jqs_mhandler"),M&&M.registerCanvas(S),S},r.fn.cleardraw=function(){var M=this.data("_jqs_vcanvas");M&&M.reset()},r.RangeMapClass=f=u({init:function(O){var P,M,N=[];for(P in O){O.hasOwnProperty(P)&&typeof P=="string"&&P.indexOf(":")>-1&&(M=P.split(":"),M[0]=M[0].length===0?-Infinity:parseFloat(M[0]),M[1]=M[1].length===0?Infinity:parseFloat(M[1]),M[2]=O[P],N.push(M))}this.map=O,this.rangelist=N||!1},get:function(P){var Q=this.rangelist,M,N,O;if((O=this.map[P])!==a){return O}if(Q){for(M=Q.length;M--;){N=Q[M];if(N[0]<=P&&N[1]>=P){return N[2]}}}return a}}),r.range_map=function(M){return new f(M)},h=u({init:function(N,O){var M=r(N);this.$el=M,this.options=O,this.currentPageX=0,this.currentPageY=0,this.el=N,this.splist=[],this.tooltip=null,this.over=!1,this.displayTooltips=!O.get("disableTooltips"),this.highlightEnabled=!O.get("disableHighlight")},registerSparkline:function(M){this.splist.push(M),this.over&&this.updateDisplay()},registerCanvas:function(M){var N=r(M.canvas);this.canvas=M,this.$canvas=N,N.mouseenter(r.proxy(this.mouseenter,this)),N.mouseleave(r.proxy(this.mouseleave,this)),N.click(r.proxy(this.mouseclick,this))},reset:function(M){this.splist=[],this.tooltip&&M&&(this.tooltip.remove(),this.tooltip=a)},mouseclick:function(M){var N=r.Event("sparklineClick");N.originalEvent=M,N.sparklines=this.splist,this.$el.trigger(N)},mouseenter:function(M){r(b.body).unbind("mousemove.jqs"),r(b.body).bind("mousemove.jqs",r.proxy(this.mousemove,this)),this.over=!0,this.currentPageX=M.pageX,this.currentPageY=M.pageY,this.currentEl=M.target,!this.tooltip&&this.displayTooltips&&(this.tooltip=new j(this.options),this.tooltip.updatePosition(M.pageX,M.pageY)),this.updateDisplay()},mouseleave:function(){r(b.body).unbind("mousemove.jqs");var Q=this.splist,M=Q.length,N=!1,O,P;this.over=!1,this.currentEl=null,this.tooltip&&(this.tooltip.remove(),this.tooltip=null);for(P=0;P<M;P++){O=Q[P],O.clearRegionHighlight()&&(N=!0)}N&&this.canvas.render()},mousemove:function(M){this.currentPageX=M.pageX,this.currentPageY=M.pageY,this.currentEl=M.target,this.tooltip&&this.tooltip.updatePosition(M.pageX,M.pageY),this.updateDisplay()},updateDisplay:function(){var S=this.splist,T=S.length,U=!1,V=this.$canvas.offset(),W=this.currentPageX-V.left,M=this.currentPageY-V.top,N,O,P,Q,R;if(!this.over){return}for(P=0;P<T;P++){O=S[P],Q=O.setRegionHighlight(this.currentEl,W,M),Q&&(U=!0)}if(U){R=r.Event("sparklineRegionChange"),R.sparklines=this.splist,this.$el.trigger(R);if(this.tooltip){N="";for(P=0;P<T;P++){O=S[P],N+=O.getCurrentRegionTooltip()}this.tooltip.setContent(N)}this.disableHighlight||this.canvas.render()}Q===null&&this.mouseleave()}}),j=u({sizeStyle:"position: static !important;display: block !important;visibility: hidden !important;float: left !important;",init:function(P){var M=P.get("tooltipClassname","jqstooltip"),N=this.sizeStyle,O;this.container=P.get("tooltipContainer")||b.body,this.tooltipOffsetX=P.get("tooltipOffsetX",10),this.tooltipOffsetY=P.get("tooltipOffsetY",12),r("#jqssizetip").remove(),r("#jqstooltip").remove(),this.sizetip=r("<div/>",{id:"jqssizetip",style:N,"class":M}),this.tooltip=r("<div/>",{id:"jqstooltip","class":M}).appendTo(this.container),O=this.tooltip.offset(),this.offsetLeft=O.left,this.offsetTop=O.top,this.hidden=!0,r(window).unbind("resize.jqs scroll.jqs"),r(window).bind("resize.jqs scroll.jqs",r.proxy(this.updateWindowDims,this)),this.updateWindowDims()},updateWindowDims:function(){this.scrollTop=r(window).scrollTop(),this.scrollLeft=r(window).scrollLeft(),this.scrollRight=this.scrollLeft+r(window).width(),this.updatePosition()},getSize:function(M){this.sizetip.html(M).appendTo(this.container),this.width=this.sizetip.width()+1,this.height=this.sizetip.height(),this.sizetip.remove()},setContent:function(M){if(!M){this.tooltip.css("visibility","hidden"),this.hidden=!0;return}this.getSize(M),this.tooltip.html(M).css({width:this.width,height:this.height,visibility:"visible"}),this.hidden&&(this.hidden=!1,this.updatePosition())},updatePosition:function(M,N){if(M===a){if(this.mousex===a){return}M=this.mousex-this.offsetLeft,N=this.mousey-this.offsetTop}else{this.mousex=M-=this.offsetLeft,this.mousey=N-=this.offsetTop}if(!this.height||!this.width||this.hidden){return}N-=this.height+this.tooltipOffsetY,M+=this.tooltipOffsetX,N<this.scrollTop&&(N=this.scrollTop),M<this.scrollLeft?M=this.scrollLeft:M+this.width>this.scrollRight&&(M=this.scrollRight-this.width),this.tooltip.css({left:M,top:N})},remove:function(){this.tooltip.remove(),this.sizetip.remove(),this.sizetip=this.tooltip=a,r(window).unbind("resize.jqs scroll.jqs")}}),i=function(){G(g)},r(i),H=[],r.fn.sparkline=function(N,M){return this.each(function(){var O=new r.fn.sparkline.options(this,M),P=r(this),Q,R;Q=function(){var S,T,U,V,W,X,Y;if(N==="html"||N===a){Y=this.getAttribute(O.get("tagValuesAttribute"));if(Y===a||Y===null){Y=P.html()}S=Y.replace(/(^\s*<!--)|(-->\s*$)|\s+/g,"").split(",")}else{S=N}T=O.get("width")==="auto"?S.length*O.get("defaultPixelsPerValue"):O.get("width");if(O.get("height")==="auto"){if(!O.get("composite")||!r.data(this,"_jqs_vcanvas")){V=b.createElement("span"),V.innerHTML="a",P.html(V),U=r(V).innerHeight()||r(V).height(),r(V).remove(),V=null}}else{U=O.get("height")}O.get("disableInteraction")?W=!1:(W=r.data(this,"_jqs_mhandler"),W?O.get("composite")||W.reset():(W=new h(this,O),r.data(this,"_jqs_mhandler",W)));if(O.get("composite")&&!r.data(this,"_jqs_vcanvas")){r.data(this,"_jqs_errnotify")||(alert("Attempted to attach a composite sparkline to an element with no existing sparkline"),r.data(this,"_jqs_errnotify",!0));return}X=new (r.fn.sparkline[O.get("type")])(this,S,O,T,U),X.render(),W&&W.registerSparkline(X)};if(r(this).html()&&!O.get("disableHiddenCheck")&&r(this).is(":hidden")||!r(this).parents("body").length){if(!O.get("composite")&&r.data(this,"_jqs_pending")){for(R=H.length;R;R--){H[R-1][0]==this&&H.splice(R-1,1)}}H.push([this,Q]),r.data(this,"_jqs_pending",!0)}else{Q.call(this)}})},r.fn.sparkline.defaults=t(),r.sparkline_display_visible=function(){var O,P,M,N=[];for(P=0,M=H.length;P<M;P++){O=H[P][0],r(O).is(":visible")&&!r(O).parents().is(":hidden")?(H[P][1].call(O),r.data(H[P][0],"_jqs_pending",!1),N.push(P)):!r(O).closest("html").length&&!r.data(O,"_jqs_pending")&&(r.data(H[P][0],"_jqs_pending",!1),N.push(P))}for(P=N.length;P;P--){H.splice(N[P-1],1)}},r.fn.sparkline.options=u({init:function(P,Q){var R,M,N,O;this.userOptions=Q=Q||{},this.tag=P,this.tagValCache={},M=r.fn.sparkline.defaults,N=M.common,this.tagOptionsPrefix=Q.enableTagOptions&&(Q.tagOptionsPrefix||N.tagOptionsPrefix),O=this.getTagSetting("type"),O===s?R=M[Q.type||N.type]:R=M[O],this.mergedOptions=r.extend({},N,R,Q)},getTagSetting:function(P){var Q=this.tagOptionsPrefix,R,M,N,O;if(Q===!1||Q===a){return s}if(this.tagValCache.hasOwnProperty(P)){R=this.tagValCache.key}else{R=this.tag.getAttribute(Q+P);if(R===a||R===null){R=s}else{if(R.substr(0,1)==="["){R=R.substr(1,R.length-2).split(",");for(M=R.length;M--;){R[M]=y(R[M].replace(/(^\s*)|(\s*$)/g,""))}}else{if(R.substr(0,1)==="{"){N=R.substr(1,R.length-2).split(","),R={};for(M=N.length;M--;){O=N[M].split(":",2),R[O[0].replace(/(^\s*)|(\s*$)/g,"")]=y(O[1].replace(/(^\s*)|(\s*$)/g,""))}}else{R=y(R)}}}this.tagValCache.key=R}return R},get:function(O,P){var M=this.getTagSetting(O),N;return M!==s?M:(N=this.mergedOptions[O])===a?P:N}}),r.fn.sparkline._base=u({disabled:!1,init:function(P,Q,M,N,O){this.el=P,this.$el=r(P),this.values=Q,this.options=M,this.width=N,this.height=O,this.currentRegion=a},initTarget:function(){var M=!this.options.get("disableInteraction");(this.target=this.$el.simpledraw(this.width,this.height,this.options.get("composite"),M))?(this.canvasWidth=this.target.pixelWidth,this.canvasHeight=this.target.pixelHeight):this.disabled=!0},render:function(){return this.disabled?(this.el.innerHTML="",!1):!0},getRegion:function(M,N){},setRegionHighlight:function(Q,R,M){var N=this.currentRegion,O=!this.options.get("disableHighlight"),P;return R>this.canvasWidth||M>this.canvasHeight||R<0||M<0?null:(P=this.getRegion(Q,R,M),N!==P?(N!==a&&O&&this.removeHighlight(),this.currentRegion=P,P!==a&&O&&this.renderHighlight(),!0):!1)},clearRegionHighlight:function(){return this.currentRegion!==a?(this.removeHighlight(),this.currentRegion=a,!0):!1},renderHighlight:function(){this.changeHighlight(!0)},removeHighlight:function(){this.changeHighlight(!1)},changeHighlight:function(M){},getCurrentRegionTooltip:function(){var Y=this.options,aa="",ab=[],ac,M,N,O,P,R,S,U,W,X,Z,Q,T,V;if(this.currentRegion===a){return""}ac=this.getCurrentRegionFields(),Z=Y.get("tooltipFormatter");if(Z){return Z(this,Y,ac)}Y.get("tooltipChartTitle")&&(aa+='<div class="jqs jqstitle">'+Y.get("tooltipChartTitle")+"</div>\n"),M=this.options.get("tooltipFormat");if(!M){return""}r.isArray(M)||(M=[M]),r.isArray(ac)||(ac=[ac]),S=this.options.get("tooltipFormatFieldlist"),U=this.options.get("tooltipFormatFieldlistKey");if(S&&U){W=[];for(R=ac.length;R--;){X=ac[R][U],(V=r.inArray(X,S))!=-1&&(W[V]=ac[R])}ac=W}N=M.length,T=ac.length;for(R=0;R<N;R++){Q=M[R],typeof Q=="string"&&(Q=new v(Q)),O=Q.fclass||"jqsfield";for(V=0;V<T;V++){if(!ac[V].isNull||!Y.get("tooltipSkipNull")){r.extend(ac[V],{prefix:Y.get("tooltipPrefix"),suffix:Y.get("tooltipSuffix")}),P=Q.render(ac[V],Y.get("tooltipValueLookups"),Y),ab.push('<div class="'+O+'">'+P+"</div>")}}}return ab.length?aa+ab.join("\n"):""},getCurrentRegionFields:function(){},calcHighlightColor:function(P,Q){var R=Q.get("highlightColor"),S=Q.get("highlightLighten"),T,M,N,O;if(R){return R}if(S){T=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(P)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(P);if(T){N=[],M=P.length===4?16:1;for(O=0;O<3;O++){N[O]=w(c.round(parseInt(T[O+1],16)*M*S),0,255)}return"rgb("+N.join(",")+")"}}return P}}),l={changeHighlight:function(P){var Q=this.currentRegion,M=this.target,N=this.regionShapes[Q],O;N&&(O=this.renderRegion(Q,P),r.isArray(O)||r.isArray(N)?(M.replaceWithShapes(N,O),this.regionShapes[Q]=r.map(O,function(R){return R.id})):(M.replaceWithShape(N,O),this.regionShapes[Q]=O.id))},render:function(){var P=this.values,Q=this.target,R=this.regionShapes,S,M,N,O;if(!this.cls._super.render.call(this)){return}for(N=P.length;N--;){S=this.renderRegion(N);if(S){if(r.isArray(S)){M=[];for(O=S.length;O--;){S[O].append(),M.push(S[O].id)}R[N]=M}else{S.append(),R[N]=S.id}}else{R[N]=null}}Q.render()}},r.fn.sparkline.line=n=u(r.fn.sparkline._base,{type:"line",init:function(P,Q,M,N,O){n._super.init.call(this,P,Q,M,N,O),this.vertices=[],this.regionMap=[],this.xvalues=[],this.yvalues=[],this.yminmax=[],this.hightlightSpotId=null,this.lastShapeId=null,this.initTarget()},getRegion:function(P,Q,M){var N,O=this.regionMap;for(N=O.length;N--;){if(O[N]!==null&&Q>=O[N][0]&&Q<=O[N][1]){return O[N][2]}}return a},getCurrentRegionFields:function(){var M=this.currentRegion;return{isNull:this.yvalues[M]===null,x:this.xvalues[M],y:this.yvalues[M],color:this.options.get("lineColor"),fillColor:this.options.get("fillColor"),offset:M}},renderHighlight:function(){var U=this.currentRegion,M=this.target,N=this.vertices[U],O=this.options,P=O.get("spotRadius"),Q=O.get("highlightSpotColor"),R=O.get("highlightLineColor"),S,T;if(!N){return}P&&Q&&(S=M.drawCircle(N[0],N[1],P,a,Q),this.highlightSpotId=S.id,M.insertAfterShape(this.lastShapeId,S)),R&&(T=M.drawLine(N[0],this.canvasTop,N[0],this.canvasTop+this.canvasHeight,R),this.highlightLineId=T.id,M.insertAfterShape(this.lastShapeId,T))},removeHighlight:function(){var M=this.target;this.highlightSpotId&&(M.removeShapeId(this.highlightSpotId),this.highlightSpotId=null),this.highlightLineId&&(M.removeShapeId(this.highlightLineId),this.highlightLineId=null)},scanValues:function(){var T=this.values,U=T.length,V=this.xvalues,M=this.yvalues,N=this.yminmax,O,P,Q,R,S;for(O=0;O<U;O++){P=T[O],Q=typeof T[O]=="string",R=typeof T[O]=="object"&&T[O] instanceof Array,S=Q&&T[O].split(":"),Q&&S.length===2?(V.push(Number(S[0])),M.push(Number(S[1])),N.push(Number(S[1]))):R?(V.push(P[0]),M.push(P[1]),N.push(P[1])):(V.push(O),T[O]===null||T[O]==="null"?M.push(null):(M.push(Number(P)),N.push(Number(P))))}this.options.get("xvalues")&&(V=this.options.get("xvalues")),this.maxy=this.maxyorg=c.max.apply(c,N),this.miny=this.minyorg=c.min.apply(c,N),this.maxx=c.max.apply(c,V),this.minx=c.min.apply(c,V),this.xvalues=V,this.yvalues=M,this.yminmax=N},processRangeOptions:function(){var N=this.options,O=N.get("normalRangeMin"),M=N.get("normalRangeMax");O!==a&&(O<this.miny&&(this.miny=O),M>this.maxy&&(this.maxy=M)),N.get("chartRangeMin")!==a&&(N.get("chartRangeClip")||N.get("chartRangeMin")<this.miny)&&(this.miny=N.get("chartRangeMin")),N.get("chartRangeMax")!==a&&(N.get("chartRangeClip")||N.get("chartRangeMax")>this.maxy)&&(this.maxy=N.get("chartRangeMax")),N.get("chartRangeMinX")!==a&&(N.get("chartRangeClipX")||N.get("chartRangeMinX")<this.minx)&&(this.minx=N.get("chartRangeMinX")),N.get("chartRangeMaxX")!==a&&(N.get("chartRangeClipX")||N.get("chartRangeMaxX")>this.maxx)&&(this.maxx=N.get("chartRangeMaxX"))},drawNormalRange:function(T,U,M,N,O){var P=this.options.get("normalRangeMin"),Q=this.options.get("normalRangeMax"),R=U+c.round(M-M*((Q-this.miny)/O)),S=c.round(M*(Q-P)/O);this.target.drawRect(T,R,N,S,a,this.options.get("normalRangeColor")).append()},render:function(){var M=this.options,N=this.target,O=this.canvasWidth,P=this.canvasHeight,Q=this.vertices,R=M.get("spotRadius"),S=this.regionMap,T,U,W,X,Z,ac,ag,al,ao,ar,ab,af,an,aa,ae,ai,am,ap,aq,Y,ad,ah,ak,V,aj;if(!n._super.render.call(this)){return}this.scanValues(),this.processRangeOptions(),ak=this.xvalues,V=this.yvalues;if(!this.yminmax.length||this.yvalues.length<2){return}X=Z=0,T=this.maxx-this.minx===0?1:this.maxx-this.minx,U=this.maxy-this.miny===0?1:this.maxy-this.miny,W=this.yvalues.length-1,R&&(O<R*4||P<R*4)&&(R=0);if(R){ad=M.get("highlightSpotColor")&&!M.get("disableInteraction");if(ad||M.get("minSpotColor")||M.get("spotColor")&&V[W]===this.miny){P-=c.ceil(R)}if(ad||M.get("maxSpotColor")||M.get("spotColor")&&V[W]===this.maxy){P-=c.ceil(R),X+=c.ceil(R)}if(ad||(M.get("minSpotColor")||M.get("maxSpotColor"))&&(V[0]===this.miny||V[0]===this.maxy)){Z+=c.ceil(R),O-=c.ceil(R)}if(ad||M.get("spotColor")||M.get("minSpotColor")||M.get("maxSpotColor")&&(V[W]===this.miny||V[W]===this.maxy)){O-=c.ceil(R)}}P--,M.get("normalRangeMin")!==a&&!M.get("drawNormalOnTop")&&this.drawNormalRange(Z,X,P,O,U),ag=[],al=[ag],aa=ae=null,ai=V.length;for(aj=0;aj<ai;aj++){ao=ak[aj],ab=ak[aj+1],ar=V[aj],af=Z+c.round((ao-this.minx)*(O/T)),an=aj<ai-1?Z+c.round((ab-this.minx)*(O/T)):O,ae=af+(an-af)/2,S[aj]=[aa||0,ae,aj],aa=ae,ar===null?aj&&(V[aj-1]!==null&&(ag=[],al.push(ag)),Q.push(null)):(ar<this.miny&&(ar=this.miny),ar>this.maxy&&(ar=this.maxy),ag.length||ag.push([af,X+P]),ac=[af,X+c.round(P-P*((ar-this.miny)/U))],ag.push(ac),Q.push(ac))}am=[],ap=[],aq=al.length;for(aj=0;aj<aq;aj++){ag=al[aj],ag.length&&(M.get("fillColor")&&(ag.push([ag[ag.length-1][0],X+P]),ap.push(ag.slice(0)),ag.pop()),ag.length>2&&(ag[0]=[ag[0][0],ag[1][1]]),am.push(ag))}aq=ap.length;for(aj=0;aj<aq;aj++){N.drawShape(ap[aj],M.get("fillColor"),M.get("fillColor")).append()}M.get("normalRangeMin")!==a&&M.get("drawNormalOnTop")&&this.drawNormalRange(Z,X,P,O,U),aq=am.length;for(aj=0;aj<aq;aj++){N.drawShape(am[aj],M.get("lineColor"),a,M.get("lineWidth")).append()}if(R&&M.get("valueSpots")){Y=M.get("valueSpots"),Y.get===a&&(Y=new f(Y));for(aj=0;aj<ai;aj++){ah=Y.get(V[aj]),ah&&N.drawCircle(Z+c.round((ak[aj]-this.minx)*(O/T)),X+c.round(P-P*((V[aj]-this.miny)/U)),R,a,ah).append()}}R&&M.get("spotColor")&&V[W]!==null&&N.drawCircle(Z+c.round((ak[ak.length-1]-this.minx)*(O/T)),X+c.round(P-P*((V[W]-this.miny)/U)),R,a,M.get("spotColor")).append(),this.maxy!==this.minyorg&&(R&&M.get("minSpotColor")&&(ao=ak[r.inArray(this.minyorg,V)],N.drawCircle(Z+c.round((ao-this.minx)*(O/T)),X+c.round(P-P*((this.minyorg-this.miny)/U)),R,a,M.get("minSpotColor")).append()),R&&M.get("maxSpotColor")&&(ao=ak[r.inArray(this.maxyorg,V)],N.drawCircle(Z+c.round((ao-this.minx)*(O/T)),X+c.round(P-P*((this.maxyorg-this.miny)/U)),R,a,M.get("maxSpotColor")).append())),this.lastShapeId=N.getLastShapeId(),this.canvasTop=X,N.render()}}),r.fn.sparkline.bar=p=u(r.fn.sparkline._base,l,{type:"bar",init:function(T,U,V,W,X){var Y=parseInt(V.get("barWidth"),10),Z=parseInt(V.get("barSpacing"),10),aa=V.get("chartRangeMin"),ab=V.get("chartRangeMax"),ac=V.get("chartRangeClip"),ad=Infinity,ae=-Infinity,af,ag,ah,ai,aj,ak,al,am,an,ao,ap,aq,M,N,O,P,Q,R,S,ar,at,au,av;p._super.init.call(this,T,U,V,W,X);for(ak=0,al=U.length;ak<al;ak++){ar=U[ak],af=typeof ar=="string"&&ar.indexOf(":")>-1;if(af||r.isArray(ar)){O=!0,af&&(ar=U[ak]=z(ar.split(":"))),ar=A(ar,null),ag=c.min.apply(c,ar),ah=c.max.apply(c,ar),ag<ad&&(ad=ag),ah>ae&&(ae=ah)}}this.stacked=O,this.regionShapes={},this.barWidth=Y,this.barSpacing=Z,this.totalBarWidth=Y+Z,this.width=W=U.length*Y+(U.length-1)*Z,this.initTarget(),ac&&(M=aa===a?-Infinity:aa,N=ab===a?Infinity:ab),aj=[],ai=O?[]:aj;var aw=[],ax=[];for(ak=0,al=U.length;ak<al;ak++){if(O){P=U[ak],U[ak]=S=[],aw[ak]=0,ai[ak]=ax[ak]=0;for(Q=0,R=P.length;Q<R;Q++){ar=S[Q]=ac?w(P[Q],M,N):P[Q],ar!==null&&(ar>0&&(aw[ak]+=ar),ad<0&&ae>0?ar<0?ax[ak]+=c.abs(ar):ai[ak]+=ar:ai[ak]+=c.abs(ar-(ar<0?ae:ad)),aj.push(ar))}}else{ar=ac?w(U[ak],M,N):U[ak],ar=U[ak]=y(ar),ar!==null&&aj.push(ar)}}this.max=aq=c.max.apply(c,aj),this.min=ap=c.min.apply(c,aj),this.stackMax=ae=O?c.max.apply(c,aw):aq,this.stackMin=ad=O?c.min.apply(c,aj):ap,V.get("chartRangeMin")!==a&&(V.get("chartRangeClip")||V.get("chartRangeMin")<ap)&&(ap=V.get("chartRangeMin")),V.get("chartRangeMax")!==a&&(V.get("chartRangeClip")||V.get("chartRangeMax")>aq)&&(aq=V.get("chartRangeMax")),this.zeroAxis=an=V.get("zeroAxis",!0),ap<=0&&aq>=0&&an?ao=0:an==0?ao=ap:ap>0?ao=ap:ao=aq,this.xaxisOffset=ao,am=O?c.max.apply(c,ai)+c.max.apply(c,ax):aq-ap,this.canvasHeightEf=an&&ap<0?this.canvasHeight-2:this.canvasHeight-1,ap<ao?(au=O&&aq>=0?ae:aq,at=(au-ao)/am*this.canvasHeight,at!==c.ceil(at)&&(this.canvasHeightEf-=2,at=c.ceil(at))):at=this.canvasHeight,this.yoffset=at,r.isArray(V.get("colorMap"))?(this.colorMapByIndex=V.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=V.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===a&&(this.colorMapByValue=new f(this.colorMapByValue))),this.range=am},getRegion:function(P,M,N){var O=c.floor(M/this.totalBarWidth);return O<0||O>=this.values.length?a:O},getCurrentRegionFields:function(){var P=this.currentRegion,Q=K(this.values[P]),M=[],N,O;for(O=Q.length;O--;){N=Q[O],M.push({isNull:N===null,value:N,color:this.calcColor(O,N,P),offset:P})}return M},calcColor:function(N,O,P){var Q=this.colorMapByIndex,R=this.colorMapByValue,S=this.options,T,M;return this.stacked?T=S.get("stackedBarColor"):T=O<0?S.get("negBarColor"):S.get("barColor"),O===0&&S.get("zeroColor")!==a&&(T=S.get("zeroColor")),R&&(M=R.get(O))?T=M:Q&&Q.length>P&&(T=Q[P]),r.isArray(T)?T[N%T.length]:T},renderRegion:function(af,ah){var O=this.values[af],Q=this.options,T=this.xaxisOffset,V=[],X=this.range,Z=this.stacked,ab=this.target,M=af*this.totalBarWidth,N=this.canvasHeightEf,P=this.yoffset,R,S,U,W,Y,aa,ac,ad,ae,ag;O=r.isArray(O)?O:[O],ac=O.length,ad=O[0],W=C(null,O),ag=C(T,O,!0);if(W){return Q.get("nullColor")?(U=ah?Q.get("nullColor"):this.calcHighlightColor(Q.get("nullColor"),Q),R=P>0?P-1:P,ab.drawRect(M,R,this.barWidth-1,0,U,U)):a}Y=P;for(aa=0;aa<ac;aa++){ad=O[aa];if(Z&&ad===T){if(!ag||ae){continue}ae=!0}X>0?S=c.floor(N*(c.abs(ad-T)/X))+1:S=1,ad<T||ad===T&&P===0?(R=Y,Y+=S):(R=P-S,P-=S),U=this.calcColor(aa,ad,af),ah&&(U=this.calcHighlightColor(U,Q)),V.push(ab.drawRect(M,R,this.barWidth-1,S-1,U,U))}return V.length===1?V[0]:V}}),r.fn.sparkline.tristate=F=u(r.fn.sparkline._base,l,{type:"tristate",init:function(O,P,Q,R,S){var M=parseInt(Q.get("barWidth"),10),N=parseInt(Q.get("barSpacing"),10);F._super.init.call(this,O,P,Q,R,S),this.regionShapes={},this.barWidth=M,this.barSpacing=N,this.totalBarWidth=M+N,this.values=r.map(P,Number),this.width=R=P.length*M+(P.length-1)*N,r.isArray(Q.get("colorMap"))?(this.colorMapByIndex=Q.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=Q.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===a&&(this.colorMapByValue=new f(this.colorMapByValue))),this.initTarget()},getRegion:function(O,M,N){return c.floor(M/this.totalBarWidth)},getCurrentRegionFields:function(){var M=this.currentRegion;return{isNull:this.values[M]===a,value:this.values[M],color:this.calcColor(this.values[M],M),offset:M}},calcColor:function(P,Q){var R=this.values,S=this.options,T=this.colorMapByIndex,M=this.colorMapByValue,N,O;return M&&(O=M.get(P))?N=O:T&&T.length>Q?N=T[Q]:R[Q]<0?N=S.get("negBarColor"):R[Q]>0?N=S.get("posBarColor"):N=S.get("zeroBarColor"),N},renderRegion:function(S,T){var U=this.values,V=this.options,W=this.target,M,N,O,P,Q,R;M=W.pixelHeight,O=c.round(M/2),P=S*this.totalBarWidth,U[S]<0?(Q=O,N=O-1):U[S]>0?(Q=0,N=O-1):(Q=O-1,N=2),R=this.calcColor(U[S],S);if(R===null){return}return T&&(R=this.calcHighlightColor(R,V)),W.drawRect(P,Q,this.barWidth-1,N-1,R,R)}}),r.fn.sparkline.discrete=E=u(r.fn.sparkline._base,l,{type:"discrete",init:function(Q,M,N,O,P){E._super.init.call(this,Q,M,N,O,P),this.regionShapes={},this.values=M=r.map(M,Number),this.min=c.min.apply(c,M),this.max=c.max.apply(c,M),this.range=this.max-this.min,this.width=O=N.get("width")==="auto"?M.length*2:this.width,this.interval=c.floor(O/M.length),this.itemWidth=O/M.length,N.get("chartRangeMin")!==a&&(N.get("chartRangeClip")||N.get("chartRangeMin")<this.min)&&(this.min=N.get("chartRangeMin")),N.get("chartRangeMax")!==a&&(N.get("chartRangeClip")||N.get("chartRangeMax")>this.max)&&(this.max=N.get("chartRangeMax")),this.initTarget(),this.target&&(this.lineHeight=N.get("lineHeight")==="auto"?c.round(this.canvasHeight*0.3):N.get("lineHeight"))},getRegion:function(O,M,N){return c.floor(M/this.itemWidth)},getCurrentRegionFields:function(){var M=this.currentRegion;return{isNull:this.values[M]===a,value:this.values[M],offset:M}},renderRegion:function(X,Z){var ab=this.values,M=this.options,N=this.min,O=this.max,P=this.range,R=this.interval,S=this.target,T=this.canvasHeight,U=this.lineHeight,V=T-U,W,Y,aa,Q;return Y=w(ab[X],N,O),Q=X*R,W=c.round(V-V*((Y-N)/P)),aa=M.get("thresholdColor")&&Y<M.get("thresholdValue")?M.get("thresholdColor"):M.get("lineColor"),Z&&(aa=this.calcHighlightColor(aa,M)),S.drawLine(Q,W,Q,W+U,aa)}}),r.fn.sparkline.bullet=I=u(r.fn.sparkline._base,{type:"bullet",init:function(O,P,Q,R,S){var T,M,N;I._super.init.call(this,O,P,Q,R,S),this.values=P=z(P),N=P.slice(),N[0]=N[0]===null?N[2]:N[0],N[1]=P[1]===null?N[2]:N[1],T=c.min.apply(c,P),M=c.max.apply(c,P),Q.get("base")===a?T=T<0?T:0:T=Q.get("base"),this.min=T,this.max=M,this.range=M-T,this.shapes={},this.valueShapes={},this.regiondata={},this.width=R=Q.get("width")==="auto"?"4.0em":R,this.target=this.$el.simpledraw(R,S,Q.get("composite")),P.length||(this.disabled=!0),this.initTarget()},getRegion:function(O,P,M){var N=this.target.getShapeAt(O,P,M);return N!==a&&this.shapes[N]!==a?this.shapes[N]:a},getCurrentRegionFields:function(){var M=this.currentRegion;return{fieldkey:M.substr(0,1),value:this.values[M.substr(1)],region:M}},changeHighlight:function(O){var P=this.currentRegion,M=this.valueShapes[P],N;delete this.shapes[M];switch(P.substr(0,1)){case"r":N=this.renderRange(P.substr(1),O);break;case"p":N=this.renderPerformance(O);break;case"t":N=this.renderTarget(O)}this.valueShapes[P]=N.id,this.shapes[N.id]=P,this.target.replaceWithShape(M,N)},renderRange:function(Q,M){var N=this.values[Q],O=c.round(this.canvasWidth*((N-this.min)/this.range)),P=this.options.get("rangeColors")[Q-2];return M&&(P=this.calcHighlightColor(P,this.options)),this.target.drawRect(0,0,O-1,this.canvasHeight-1,P,P)},renderPerformance:function(P){var M=this.values[1],N=c.round(this.canvasWidth*((M-this.min)/this.range)),O=this.options.get("performanceColor");return P&&(O=this.calcHighlightColor(O,this.options)),this.target.drawRect(0,c.round(this.canvasHeight*0.3),N-1,c.round(this.canvasHeight*0.4)-1,O,O)},renderTarget:function(R){var M=this.values[0],N=c.round(this.canvasWidth*((M-this.min)/this.range)-this.options.get("targetWidth")/2),O=c.round(this.canvasHeight*0.1),P=this.canvasHeight-O*2,Q=this.options.get("targetColor");return R&&(Q=this.calcHighlightColor(Q,this.options)),this.target.drawRect(N,O,this.options.get("targetWidth")-1,P-1,Q,Q)},render:function(){var O=this.values.length,P=this.target,M,N;if(!I._super.render.call(this)){return}for(M=2;M<O;M++){N=this.renderRange(M).append(),this.shapes[N.id]="r"+M,this.valueShapes["r"+M]=N.id}this.values[1]!==null&&(N=this.renderPerformance().append(),this.shapes[N.id]="p1",this.valueShapes.p1=N.id),this.values[0]!==null&&(N=this.renderTarget().append(),this.shapes[N.id]="t0",this.valueShapes.t0=N.id),P.render()}}),r.fn.sparkline.pie=L=u(r.fn.sparkline._base,{type:"pie",init:function(P,Q,R,S,M){var N=0,O;L._super.init.call(this,P,Q,R,S,M),this.shapes={},this.valueShapes={},this.values=Q=r.map(Q,Number),R.get("width")==="auto"&&(this.width=this.height);if(Q.length>0){for(O=Q.length;O--;){N+=Q[O]}}this.total=N,this.initTarget(),this.radius=c.floor(c.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(O,P,M){var N=this.target.getShapeAt(O,P,M);return N!==a&&this.shapes[N]!==a?this.shapes[N]:a},getCurrentRegionFields:function(){var M=this.currentRegion;return{isNull:this.values[M]===a,value:this.values[M],percent:this.values[M]/this.total*100,color:this.options.get("sliceColors")[M%this.options.get("sliceColors").length],offset:M}},changeHighlight:function(O){var P=this.currentRegion,M=this.renderSlice(P,O),N=this.valueShapes[P];delete this.shapes[N],this.target.replaceWithShape(N,M),this.valueShapes[P]=M.id,this.shapes[M.id]=P},renderSlice:function(V,X){var Z=this.target,ab=this.options,M=this.radius,N=ab.get("borderWidth"),O=ab.get("offset"),P=2*c.PI,Q=this.values,R=this.total,S=O?2*c.PI*(O/360):0,T,U,W,Y,aa;Y=Q.length;for(W=0;W<Y;W++){T=S,U=S,R>0&&(U=S+P*(Q[W]/R));if(V===W){return aa=ab.get("sliceColors")[W%ab.get("sliceColors").length],X&&(aa=this.calcHighlightColor(aa,ab)),Z.drawPieSlice(M,M,M-N,T,U,a,aa)}S=U}},render:function(){var P=this.target,Q=this.values,R=this.options,S=this.radius,M=R.get("borderWidth"),N,O;if(!L._super.render.call(this)){return}M&&P.drawCircle(S,S,c.floor(S-M/2),R.get("borderColor"),a,M).append();for(O=Q.length;O--;){Q[O]&&(N=this.renderSlice(O).append(),this.valueShapes[O]=N.id,this.shapes[N.id]=O)}P.render()}}),r.fn.sparkline.box=e=u(r.fn.sparkline._base,{type:"box",init:function(P,Q,M,N,O){e._super.init.call(this,P,Q,M,N,O),this.values=r.map(Q,Number),this.width=M.get("width")==="auto"?"4.0em":N,this.initTarget(),this.values.length||(this.disabled=1)},getRegion:function(){return 1},getCurrentRegionFields:function(){var M=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles[1]},{field:"uq",value:this.quartiles[2]}];return this.loutlier!==a&&M.push({field:"lo",value:this.loutlier}),this.routlier!==a&&M.push({field:"ro",value:this.routlier}),this.lwhisker!==a&&M.push({field:"lw",value:this.lwhisker}),this.rwhisker!==a&&M.push({field:"rw",value:this.rwhisker}),M},render:function(){var V=this.target,X=this.values,Z=X.length,aa=this.options,M=this.canvasWidth,N=this.canvasHeight,Q=aa.get("chartRangeMin")===a?c.min.apply(c,X):aa.get("chartRangeMin"),S=aa.get("chartRangeMax")===a?c.max.apply(c,X):aa.get("chartRangeMax"),T=0,U,W,Y,ab,ac,ad,ae,O,P,R,af;if(!e._super.render.call(this)){return}if(aa.get("raw")){aa.get("showOutliers")&&X.length>5?(W=X[0],U=X[1],ab=X[2],ac=X[3],ad=X[4],ae=X[5],O=X[6]):(U=X[0],ab=X[1],ac=X[2],ad=X[3],ae=X[4])}else{X.sort(function(ag,ah){return ag-ah}),ab=x(X,1),ac=x(X,2),ad=x(X,3),Y=ad-ab;if(aa.get("showOutliers")){U=ae=a;for(P=0;P<Z;P++){U===a&&X[P]>ab-Y*aa.get("outlierIQR")&&(U=X[P]),X[P]<ad+Y*aa.get("outlierIQR")&&(ae=X[P])}W=X[0],O=X[Z-1]}else{U=X[0],ae=X[Z-1]}}this.quartiles=[ab,ac,ad],this.lwhisker=U,this.rwhisker=ae,this.loutlier=W,this.routlier=O,af=M/(S-Q+1),aa.get("showOutliers")&&(T=c.ceil(aa.get("spotRadius")),M-=2*c.ceil(aa.get("spotRadius")),af=M/(S-Q+1),W<U&&V.drawCircle((W-Q)*af+T,N/2,aa.get("spotRadius"),aa.get("outlierLineColor"),aa.get("outlierFillColor")).append(),O>ae&&V.drawCircle((O-Q)*af+T,N/2,aa.get("spotRadius"),aa.get("outlierLineColor"),aa.get("outlierFillColor")).append()),V.drawRect(c.round((ab-Q)*af+T),c.round(N*0.1),c.round((ad-ab)*af),c.round(N*0.8),aa.get("boxLineColor"),aa.get("boxFillColor")).append(),V.drawLine(c.round((U-Q)*af+T),c.round(N/2),c.round((ab-Q)*af+T),c.round(N/2),aa.get("lineColor")).append(),V.drawLine(c.round((U-Q)*af+T),c.round(N/4),c.round((U-Q)*af+T),c.round(N-N/4),aa.get("whiskerColor")).append(),V.drawLine(c.round((ae-Q)*af+T),c.round(N/2),c.round((ad-Q)*af+T),c.round(N/2),aa.get("lineColor")).append(),V.drawLine(c.round((ae-Q)*af+T),c.round(N/4),c.round((ae-Q)*af+T),c.round(N-N/4),aa.get("whiskerColor")).append(),V.drawLine(c.round((ac-Q)*af+T),c.round(N*0.1),c.round((ac-Q)*af+T),c.round(N*0.9),aa.get("medianColor")).append(),aa.get("target")&&(R=c.ceil(aa.get("spotRadius")),V.drawLine(c.round((aa.get("target")-Q)*af+T),c.round(N/2-R),c.round((aa.get("target")-Q)*af+T),c.round(N/2+R),aa.get("targetColor")).append(),V.drawLine(c.round((aa.get("target")-Q)*af+T-R),c.round(N/2),c.round((aa.get("target")-Q)*af+T+R),c.round(N/2),aa.get("targetColor")).append()),V.render()}}),k=u({init:function(O,P,M,N){this.target=O,this.id=P,this.type=M,this.args=N},append:function(){return this.target.appendShape(this),this}}),m=u({_pxregex:/(\d+)(px)?\s*$/i,init:function(N,O,M){if(!N){return}this.width=N,this.height=O,this.target=M,this.lastShapeId=null,M[0]&&(M=M[0]),r.data(M,"_jqs_vcanvas",this)},drawLine:function(Q,R,M,N,O,P){return this.drawShape([[Q,R],[M,N]],O,P)},drawShape:function(O,P,M,N){return this._genShape("Shape",[O,P,M,N])},drawCircle:function(Q,R,M,N,O,P){return this._genShape("Circle",[Q,R,M,N,O,P])},drawPieSlice:function(Q,R,S,M,N,O,P){return this._genShape("PieSlice",[Q,R,S,M,N,O,P])},drawRect:function(Q,R,M,N,O,P){return this._genShape("Rect",[Q,R,M,N,O,P])},getElement:function(){return this.canvas},getLastShapeId:function(){return this.lastShapeId},reset:function(){alert("reset not implemented")},_insert:function(M,N){r(N).html(M)},_calculatePixelDims:function(O,P,M){var N;N=this._pxregex.exec(P),N?this.pixelHeight=N[1]:this.pixelHeight=r(M).height(),N=this._pxregex.exec(O),N?this.pixelWidth=N[1]:this.pixelWidth=r(M).width()},_genShape:function(N,O){var M=J++;return O.unshift(M),new k(this,M,N,O)},appendShape:function(M){alert("appendShape not implemented")},replaceWithShape:function(M,N){alert("replaceWithShape not implemented")},insertAfterShape:function(M,N){alert("insertAfterShape not implemented")},removeShapeId:function(M){alert("removeShapeId not implemented")},getShapeAt:function(N,O,M){alert("getShapeAt not implemented")},render:function(){alert("render not implemented")}}),o=u(m,{init:function(P,M,N,O){o._super.init.call(this,P,M,N),this.canvas=b.createElement("canvas"),N[0]&&(N=N[0]),r.data(N,"_jqs_vcanvas",this),r(this.canvas).css({display:"inline-block",width:P,height:M,verticalAlign:"top"}),this._insert(this.canvas,N),this._calculatePixelDims(P,M,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,this.interact=O,this.shapes={},this.shapeseq=[],this.currentTargetShapeId=a,r(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight})},_getContext:function(O,P,M){var N=this.canvas.getContext("2d");return O!==a&&(N.strokeStyle=O),N.lineWidth=M===a?1:M,P!==a&&(N.fillStyle=P),N},reset:function(){var M=this._getContext();M.clearRect(0,0,this.pixelWidth,this.pixelHeight),this.shapes={},this.shapeseq=[],this.currentTargetShapeId=a},_drawShape:function(O,P,Q,R,S){var T=this._getContext(Q,R,S),M,N;T.beginPath(),T.moveTo(P[0][0]+0.5,P[0][1]+0.5);for(M=1,N=P.length;M<N;M++){T.lineTo(P[M][0]+0.5,P[M][1]+0.5)}Q!==a&&T.stroke(),R!==a&&T.fill(),this.targetX!==a&&this.targetY!==a&&T.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=O)},_drawCircle:function(O,P,Q,R,S,T,M){var N=this._getContext(S,T,M);N.beginPath(),N.arc(P,Q,R,0,2*c.PI,!1),this.targetX!==a&&this.targetY!==a&&N.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=O),S!==a&&N.stroke(),T!==a&&N.fill()},_drawPieSlice:function(U,M,N,O,P,Q,R,S){var T=this._getContext(R,S);T.beginPath(),T.moveTo(M,N),T.arc(M,N,O,P,Q,!1),T.lineTo(M,N),T.closePath(),R!==a&&T.stroke(),S&&T.fill(),this.targetX!==a&&this.targetY!==a&&T.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=U)},_drawRect:function(Q,R,S,M,N,O,P){return this._drawShape(Q,[[R,S],[R+M,S],[R+M,S+N],[R,S+N],[R,S]],O,P)},appendShape:function(M){return this.shapes[M.id]=M,this.shapeseq.push(M.id),this.lastShapeId=M.id,M.id},replaceWithShape:function(O,P){var M=this.shapeseq,N;this.shapes[P.id]=P;for(N=M.length;N--;){M[N]==O&&(M[N]=P.id)}delete this.shapes[O]},replaceWithShapes:function(Q,R){var S=this.shapeseq,M={},N,O,P;for(O=Q.length;O--;){M[Q[O]]=!0}for(O=S.length;O--;){N=S[O],M[N]&&(S.splice(O,1),delete this.shapes[N],P=O)}for(O=R.length;O--;){S.splice(P,0,R[O].id),this.shapes[R[O].id]=R[O]}},insertAfterShape:function(O,P){var M=this.shapeseq,N;for(N=M.length;N--;){if(M[N]===O){M.splice(N+1,0,P.id),this.shapes[P.id]=P;return}}},removeShapeId:function(N){var O=this.shapeseq,M;for(M=O.length;M--;){if(O[M]===N){O.splice(M,1);break}}delete this.shapes[N]},getShapeAt:function(N,O,M){return this.targetX=O,this.targetY=M,this.render(),this.currentTargetShapeId},render:function(){var Q=this.shapeseq,R=this.shapes,S=Q.length,M=this._getContext(),N,O,P;M.clearRect(0,0,this.pixelWidth,this.pixelHeight);for(P=0;P<S;P++){N=Q[P],O=R[N],this["_draw"+O.type].apply(this,O.args)}this.interact||(this.shapes={},this.shapeseq=[])}}),q=u(m,{init:function(P,M,N){var O;q._super.init.call(this,P,M,N),N[0]&&(N=N[0]),r.data(N,"_jqs_vcanvas",this),this.canvas=b.createElement("span"),r(this.canvas).css({display:"inline-block",position:"relative",overflow:"hidden",width:P,height:M,margin:"0px",padding:"0px",verticalAlign:"top"}),this._insert(this.canvas,N),this._calculatePixelDims(P,M,this.canvas),this.canvas.width=this.pixelWidth,this.canvas.height=this.pixelHeight,O='<v:group coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'" style="position:absolute;top:0;left:0;width:'+this.pixelWidth+"px;height="+this.pixelHeight+'px;"></v:group>',this.canvas.insertAdjacentHTML("beforeEnd",O),this.group=r(this.canvas).children()[0],this.rendered=!1,this.prerender=""},_drawShape:function(Q,R,S,T,U){var V=[],W,X,Y,M,N,O,P;for(P=0,O=R.length;P<O;P++){V[P]=""+R[P][0]+","+R[P][1]}return W=V.splice(0,1),U=U===a?1:U,X=S===a?' stroked="false" ':' strokeWeight="'+U+'px" strokeColor="'+S+'" ',Y=T===a?' filled="false"':' fillColor="'+T+'" filled="true" ',M=V[0]===V[V.length-1]?"x ":"",N='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+Q+'" '+X+Y+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+W+" l "+V.join(", ")+" "+M+'e"> </v:shape>',N},_drawCircle:function(T,U,V,M,N,O,P){var Q,R,S;return U-=M,V-=M,Q=N===a?' stroked="false" ':' strokeWeight="'+P+'px" strokeColor="'+N+'" ',R=O===a?' filled="false"':' fillColor="'+O+'" filled="true" ',S='<v:oval  id="jqsshape'+T+'" '+Q+R+' style="position:absolute;top:'+V+"px; left:"+U+"px; width:"+M*2+"px; height:"+M*2+'px"></v:oval>',S},_drawPieSlice:function(V,X,Z,ab,M,N,O,P){var Q,R,S,T,U,W,Y,aa;if(M===N){return""}N-M===2*c.PI&&(M=0,N=2*c.PI),R=X+c.round(c.cos(M)*ab),S=Z+c.round(c.sin(M)*ab),T=X+c.round(c.cos(N)*ab),U=Z+c.round(c.sin(N)*ab);if(R===T&&S===U){if(N-M<c.PI){return""}R=T=X+ab,S=U=Z}return R===T&&S===U&&N-M<c.PI?"":(Q=[X-ab,Z-ab,X+ab,Z+ab,R,S,T,U],W=O===a?' stroked="false" ':' strokeWeight="1px" strokeColor="'+O+'" ',Y=P===a?' filled="false"':' fillColor="'+P+'" filled="true" ',aa='<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+V+'" '+W+Y+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+X+","+Z+" wa "+Q.join(", ")+' x e"> </v:shape>',aa)},_drawRect:function(Q,R,S,M,N,O,P){return this._drawShape(Q,[[R,S],[R,S+N],[R+M,S+N],[R+M,S],[R,S]],O,P)},reset:function(){this.group.innerHTML=""},appendShape:function(M){var N=this["_draw"+M.type].apply(this,M.args);return this.rendered?this.group.insertAdjacentHTML("beforeEnd",N):this.prerender+=N,this.lastShapeId=M.id,M.id},replaceWithShape:function(O,P){var M=r("#jqsshape"+O),N=this["_draw"+P.type].apply(this,P.args);M[0].outerHTML=N},replaceWithShapes:function(Q,R){var M=r("#jqsshape"+Q[0]),N="",O=R.length,P;for(P=0;P<O;P++){N+=this["_draw"+R[P].type].apply(this,R[P].args)}M[0].outerHTML=N;for(P=1;P<Q.length;P++){r("#jqsshape"+Q[P]).remove()}},insertAfterShape:function(O,P){var M=r("#jqsshape"+O),N=this["_draw"+P.type].apply(this,P.args);M[0].insertAdjacentHTML("afterEnd",N)},removeShapeId:function(M){var N=r("#jqsshape"+M);this.group.removeChild(N[0])},getShapeAt:function(O,P,M){var N=O.id.substr(8);return N},render:function(){this.rendered||(this.group.innerHTML=this.prerender,this.rendered=!0)}})})})(document,Math);
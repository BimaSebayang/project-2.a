/*!
 ColReorder 1.1.3
 Â©2010-2014 SpryMedia Ltd - datatables.net/license
*/
(function(i,l,g){function j(a){for(var b=[],c=0,d=a.length;c<d;c++){b[a[c]]=c}return b}function h(a,b,c){b=a.splice(b,1)[0];a.splice(c,0,b)}function k(a,c,e){for(var f=[],b=0,d=a.childNodes.length;b<d;b++){1==a.childNodes[b].nodeType&&f.push(a.childNodes[b])}c=f[c];null!==e?a.insertBefore(c,f[e]):a.appendChild(c)}i=function(a){a.fn.dataTableExt.oApi.fnColReorder=function(n,z,B){var E=a.fn.dataTable.Api?!0:!1,A,D,C,f,m=n.aoColumns.length,c,d;c=function(q,r,s){if(q[r]){var p=q[r].split("."),o=p.shift();isNaN(1*o)||(q[r]=s[1*o]+"."+p.join("."))}};if(z!=B){if(0>z||z>=m){this.oApi._fnLog(n,1,"ColReorder 'from' index is out of bounds: "+z)}else{if(0>B||B>=m){this.oApi._fnLog(n,1,"ColReorder 'to' index is out of bounds: "+B)}else{C=[];A=0;for(D=m;A<D;A++){C[A]=A}h(C,z,B);var e=j(C);A=0;for(D=n.aaSorting.length;A<D;A++){n.aaSorting[A][0]=e[n.aaSorting[A][0]]}if(null!==n.aaSortingFixed){A=0;for(D=n.aaSortingFixed.length;A<D;A++){n.aaSortingFixed[A][0]=e[n.aaSortingFixed[A][0]]}}A=0;for(D=m;A<D;A++){d=n.aoColumns[A];C=0;for(f=d.aDataSort.length;C<f;C++){d.aDataSort[C]=e[d.aDataSort[C]]}E&&(d.idx=e[d.idx])}E&&a.each(n.aLastSort,function(p,o){n.aLastSort[p].src=e[o.src]});A=0;for(D=m;A<D;A++){d=n.aoColumns[A],"number"==typeof d.mData?(d.mData=e[d.mData],n.oApi._fnColumnOptions(n,A,{})):a.isPlainObject(d.mData)&&(c(d.mData,"_",e),c(d.mData,"filter",e),c(d.mData,"sort",e),c(d.mData,"type",e),n.oApi._fnColumnOptions(n,A,{}))}if(n.aoColumns[z].bVisible){C=this.oApi._fnColumnIndexToVisible(n,z);f=null;for(A=B<z?B:B+1;null===f&&A<m;){f=this.oApi._fnColumnIndexToVisible(n,A),A++}c=n.nTHead.getElementsByTagName("tr");A=0;for(D=c.length;A<D;A++){k(c[A],C,f)}if(null!==n.nTFoot){c=n.nTFoot.getElementsByTagName("tr");A=0;for(D=c.length;A<D;A++){k(c[A],C,f)}}A=0;for(D=n.aoData.length;A<D;A++){null!==n.aoData[A].nTr&&k(n.aoData[A].nTr,C,f)}}h(n.aoColumns,z,B);h(n.aoPreSearchCols,z,B);A=0;for(D=n.aoData.length;A<D;A++){c=n.aoData[A],E?(c.anCells&&h(c.anCells,z,B),"dom"!==c.src&&a.isArray(c._aData)&&h(c._aData,z,B)):(a.isArray(c._aData)&&h(c._aData,z,B),h(c._anHidden,z,B))}A=0;for(D=n.aoHeader.length;A<D;A++){h(n.aoHeader[A],z,B)}if(null!==n.aoFooter){A=0;for(D=n.aoFooter.length;A<D;A++){h(n.aoFooter[A],z,B)}}E&&(new a.fn.dataTable.Api(n)).rows().invalidate();A=0;for(D=m;A<D;A++){a(n.aoColumns[A].nTh).off("click.DT"),this.oApi._fnSortAttachListener(n,n.aoColumns[A].nTh,A)}a(n.oInstance).trigger("column-reorder",[n,{iFrom:z,iTo:B,aiInvertMapping:e}])}}}};var b=function(e,f){var c;a.fn.dataTable.Api?c=(new a.fn.dataTable.Api(e)).settings()[0]:e.fnSettings?c=e.fnSettings():"string"===typeof e?a.fn.dataTable.fnIsDataTable(a(e)[0])&&(c=a(e).eq(0).dataTable().fnSettings()):e.nodeName&&"table"===e.nodeName.toLowerCase()?a.fn.dataTable.fnIsDataTable(e.nodeName)&&(c=a(e.nodeName).dataTable().fnSettings()):e instanceof jQuery?a.fn.dataTable.fnIsDataTable(e[0])&&(c=e.eq(0).dataTable().fnSettings()):c=e;if(c._colReorder){throw"ColReorder already initialised on table #"+c.nTable.id}var d=a.fn.dataTable.camelToHungarian;d&&(d(b.defaults,b.defaults,!0),d(b.defaults,f||{}));this.s={dt:null,init:a.extend(!0,{},b.defaults,f),fixed:0,fixedRight:0,reorderCallback:null,mouse:{startX:-1,startY:-1,offsetX:-1,offsetY:-1,target:-1,targetIndex:-1,fromIndex:-1},aoTargets:[]};this.dom={drag:null,pointer:null};this.s.dt=c;this.s.dt._colReorder=this;this._fnConstruct();c.oApi._fnCallbackReg(c,"aoDestroyCallback",a.proxy(this._fnDestroy,this),"ColReorder");return this};b.prototype={fnReset:function(){for(var d=[],e=0,c=this.s.dt.aoColumns.length;e<c;e++){d.push(this.s.dt.aoColumns[e]._ColReorder_iOrigCol)}this._fnOrderColumns(d);return this},fnGetCurrentOrder:function(){return this.fnOrder()},fnOrder:function(d){if(d===g){for(var d=[],e=0,c=this.s.dt.aoColumns.length;e<c;e++){d.push(this.s.dt.aoColumns[e]._ColReorder_iOrigCol)}return d}this._fnOrderColumns(j(d));return this},_fnConstruct:function(){var f=this,n=this.s.dt.aoColumns.length,e;this.s.init.iFixedColumns&&(this.s.fixed=this.s.init.iFixedColumns);this.s.fixedRight=this.s.init.iFixedColumnsRight?this.s.init.iFixedColumnsRight:0;this.s.init.fnReorderCallback&&(this.s.reorderCallback=this.s.init.fnReorderCallback);for(e=0;e<n;e++){e>this.s.fixed-1&&e<n-this.s.fixedRight&&this._fnMouseListener(e,this.s.dt.aoColumns[e].nTh),this.s.dt.aoColumns[e]._ColReorder_iOrigCol=e}this.s.dt.oApi._fnCallbackReg(this.s.dt,"aoStateSaveParams",function(p,m){f._fnStateSave.call(f,m)},"ColReorder_State");var d=null;this.s.init.aiOrder&&(d=this.s.init.aiOrder.slice());this.s.dt.oLoadedState&&("undefined"!=typeof this.s.dt.oLoadedState.ColReorder&&this.s.dt.oLoadedState.ColReorder.length==this.s.dt.aoColumns.length)&&(d=this.s.dt.oLoadedState.ColReorder);if(d){if(f.s.dt._bInitComplete){n=j(d),f._fnOrderColumns.call(f,n)}else{var c=!1;this.s.dt.aoDrawCallback.push({fn:function(){if(!f.s.dt._bInitComplete&&!c){c=true;var m=j(d);f._fnOrderColumns.call(f,m)}},sName:"ColReorder_Pre"})}}else{this._fnSetColumnIndexes()}},_fnOrderColumns:function(e){if(e.length!=this.s.dt.aoColumns.length){this.s.dt.oInstance.oApi._fnLog(this.s.dt,1,"ColReorder - array reorder does not match known number of columns. Skipping.")}else{for(var f=0,c=e.length;f<c;f++){var d=a.inArray(f,e);f!=d&&(h(e,d,f),this.s.dt.oInstance.fnColReorder(d,f))}(""!==this.s.dt.oScroll.sX||""!==this.s.dt.oScroll.sY)&&this.s.dt.oInstance.fnAdjustColumnSizing(!1);this.s.dt.oInstance.oApi._fnSaveState(this.s.dt);this._fnSetColumnIndexes();null!==this.s.reorderCallback&&this.s.reorderCallback.call(this)}},_fnStateSave:function(f){var o,c,e,p=this.s.dt.aoColumns;f.ColReorder=[];if(f.aaSorting){for(o=0;o<f.aaSorting.length;o++){f.aaSorting[o][0]=p[f.aaSorting[o][0]]._ColReorder_iOrigCol}var d=a.extend(!0,[],f.aoSearchCols);o=0;for(c=p.length;o<c;o++){e=p[o]._ColReorder_iOrigCol,f.aoSearchCols[e]=d[o],f.abVisCols[e]=p[o].bVisible,f.ColReorder.push(e)}}else{if(f.order){for(o=0;o<f.order.length;o++){f.order[o][0]=p[f.order[o][0]]._ColReorder_iOrigCol}d=a.extend(!0,[],f.columns);o=0;for(c=p.length;o<c;o++){e=p[o]._ColReorder_iOrigCol,f.columns[e]=d[o],f.ColReorder.push(e)}}}},_fnMouseListener:function(d,e){var c=this;a(e).on("mousedown.ColReorder",function(f){f.preventDefault();c._fnMouseDown.call(c,f,e)})},_fnMouseDown:function(f,n){var d=this,e=a(f.target).closest("th, td").offset(),c=parseInt(a(n).attr("data-column-index"),10);c!==g&&(this.s.mouse.startX=f.pageX,this.s.mouse.startY=f.pageY,this.s.mouse.offsetX=f.pageX-e.left,this.s.mouse.offsetY=f.pageY-e.top,this.s.mouse.target=this.s.dt.aoColumns[c].nTh,this.s.mouse.targetIndex=c,this.s.mouse.fromIndex=c,this._fnRegions(),a(l).on("mousemove.ColReorder",function(m){d._fnMouseMove.call(d,m)}).on("mouseup.ColReorder",function(m){d._fnMouseUp.call(d,m)}))},_fnMouseMove:function(f){if(null===this.dom.drag){if(5>Math.pow(Math.pow(f.pageX-this.s.mouse.startX,2)+Math.pow(f.pageY-this.s.mouse.startY,2),0.5)){return}this._fnCreateDragNode()}this.dom.drag.css({left:f.pageX-this.s.mouse.offsetX,top:f.pageY-this.s.mouse.offsetY});for(var n=!1,e=this.s.mouse.toIndex,d=1,c=this.s.aoTargets.length;d<c;d++){if(f.pageX<this.s.aoTargets[d-1].x+(this.s.aoTargets[d].x-this.s.aoTargets[d-1].x)/2){this.dom.pointer.css("left",this.s.aoTargets[d-1].x);this.s.mouse.toIndex=this.s.aoTargets[d-1].to;n=!0;break}}n||(this.dom.pointer.css("left",this.s.aoTargets[this.s.aoTargets.length-1].x),this.s.mouse.toIndex=this.s.aoTargets[this.s.aoTargets.length-1].to);this.s.init.bRealtime&&e!==this.s.mouse.toIndex&&(this.s.dt.oInstance.fnColReorder(this.s.mouse.fromIndex,this.s.mouse.toIndex),this.s.mouse.fromIndex=this.s.mouse.toIndex,this._fnRegions())},_fnMouseUp:function(){a(l).off("mousemove.ColReorder mouseup.ColReorder");null!==this.dom.drag&&(this.dom.drag.remove(),this.dom.pointer.remove(),this.dom.drag=null,this.dom.pointer=null,this.s.dt.oInstance.fnColReorder(this.s.mouse.fromIndex,this.s.mouse.toIndex),this._fnSetColumnIndexes(),(""!==this.s.dt.oScroll.sX||""!==this.s.dt.oScroll.sY)&&this.s.dt.oInstance.fnAdjustColumnSizing(!1),this.s.dt.oInstance.oApi._fnSaveState(this.s.dt),null!==this.s.reorderCallback&&this.s.reorderCallback.call(this))},_fnRegions:function(){var e=this.s.dt.aoColumns;this.s.aoTargets.splice(0,this.s.aoTargets.length);this.s.aoTargets.push({x:a(this.s.dt.nTable).offset().left,to:0});for(var f=0,c=0,d=e.length;c<d;c++){c!=this.s.mouse.fromIndex&&f++,e[c].bVisible&&this.s.aoTargets.push({x:a(e[c].nTh).offset().left+a(e[c].nTh).outerWidth(),to:f})}0!==this.s.fixedRight&&this.s.aoTargets.splice(this.s.aoTargets.length-this.s.fixedRight);0!==this.s.fixed&&this.s.aoTargets.splice(0,this.s.fixed)},_fnCreateDragNode:function(){var f=""!==this.s.dt.oScroll.sX||""!==this.s.dt.oScroll.sY,o=this.s.dt.aoColumns[this.s.mouse.targetIndex].nTh,c=o.parentNode,d=c.parentNode,p=d.parentNode,e=a(o).clone();this.dom.drag=a(p.cloneNode(!1)).addClass("DTCR_clonedTable").append(a(d.cloneNode(!1)).append(a(c.cloneNode(!1)).append(e[0]))).css({position:"absolute",top:0,left:0,width:a(o).outerWidth(),height:a(o).outerHeight()}).appendTo("body");this.dom.pointer=a("<div></div>").addClass("DTCR_pointer").css({position:"absolute",top:f?a("div.dataTables_scroll",this.s.dt.nTableWrapper).offset().top:a(this.s.dt.nTable).offset().top,height:f?a("div.dataTables_scroll",this.s.dt.nTableWrapper).height():a(this.s.dt.nTable).height()}).appendTo("body")},_fnDestroy:function(){var c,d;c=0;for(d=this.s.dt.aoDrawCallback.length;c<d;c++){if("ColReorder_Pre"===this.s.dt.aoDrawCallback[c].sName){this.s.dt.aoDrawCallback.splice(c,1);break}}a(this.s.dt.nTHead).find("*").off(".ColReorder");a.each(this.s.dt.aoColumns,function(e,f){a(f.nTh).removeAttr("data-column-index")});this.s=this.s.dt._colReorder=null},_fnSetColumnIndexes:function(){a.each(this.s.dt.aoColumns,function(c,d){a(d.nTh).attr("data-column-index",c)})}};b.defaults={aiOrder:null,bRealtime:!1,iFixedColumns:0,iFixedColumnsRight:0,fnReorderCallback:null};b.version="1.1.3";a.fn.dataTable.ColReorder=b;a.fn.DataTable.ColReorder=b;"function"==typeof a.fn.dataTable&&"function"==typeof a.fn.dataTableExt.fnVersionCheck&&a.fn.dataTableExt.fnVersionCheck("1.9.3")?a.fn.dataTableExt.aoFeatures.push({fnInit:function(c){var d=c.oInstance;c._colReorder?d.oApi._fnLog(c,1,"ColReorder attempted to initialise twice. Ignoring second"):(d=c.oInit,new b(c,d.colReorder||d.oColReorder||{}));return null},cFeature:"R",sFeature:"ColReorder"}):alert("Warning: ColReorder requires DataTables 1.9.3 or greater - www.datatables.net/download");a.fn.dataTable.Api&&(a.fn.dataTable.Api.register("colReorder.reset()",function(){return this.iterator("table",function(c){c._colReorder.fnReset()})}),a.fn.dataTable.Api.register("colReorder.order()",function(c){return c?this.iterator("table",function(d){d._colReorder.fnOrder(c)}):this.context.length?this.context[0]._colReorder.fnOrder():null}));return b};"function"===typeof define&&define.amd?define(["jquery","datatables"],i):"object"===typeof exports?i(require("jquery"),require("datatables")):jQuery&&!jQuery.fn.dataTable.ColReorder&&i(jQuery,jQuery.fn.dataTable)})(window,document);